!function(){var Ajax={settings:{},post:function(t){return new AjaxRequest("post",t)},get:function(t){return new AjaxRequest("get",t)}},AjaxRequest=function(t,e){this.p=this.extend({method:t,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}},e),this.p=this.extend(this.p,Ajax.settings),this.p.method=this.p.method.toUpperCase(),this.prepareData(),this.xhr=new XMLHttpRequest,this.xhr.open(this.p.method,this.p.url,this.p.async),this.setHeaders(),!1!==("function"!=typeof this.p.before||this.p.before(this.xhr))&&this.send()};AjaxRequest.prototype={extend:function(t,e){if(e)for(var i in e)t[i]=e[i];return t},prepareData:function(){"POST"!==this.p.method||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded"),"object"!=typeof this.p.data||this.isFormData()||(this.p.data=this.toParams(this.p.data)),"GET"===this.p.method&&(this.p.url=this.p.url+"?"+this.p.data)},setHeaders:function(){for(var t in this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||"XMLHttpRequest"),this.p.headers)this.xhr.setRequestHeader(t,this.p.headers[t])},isFormData:function(){return"undefined"!=typeof window.FormData&&this.p.data instanceof window.FormData},isComplete:function(){return!(this.xhr.status<200||this.xhr.status>=300&&304!==this.xhr.status)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){if(this.isComplete()){var t=this.xhr.response;t=this.parseJson(t)||t,"function"==typeof this.p.success&&this.p.success(t,this.xhr)}else"function"==typeof this.p.error&&this.p.error(this.xhr.statusText)},parseJson:function(t){try{t=(t=t.replace(/^\[/,"")).replace(/\]$/,"");var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1},toParams:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}};var DomCache=[0],DomExpando="data"+ +new Date,DomDisplayCache={},Dom=function(t,e){return this.parse(t,e)};Dom.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)},Dom.prototype={get dom(){return!0},get length(){return this.nodes.length},parse:function(t,e){var i;if(t){if(t.dom)return this.nodes=t.nodes,t;i="string"!=typeof t?t.nodeType&&11===t.nodeType?t.childNodes:t.nodeType||t===window?[t]:t:/^\s*<(\w+|!)[^>]*>/.test(t)?this.create(t):this._query(t,e)}else i=[];this.nodes=this._slice(i)},create:function(t){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(t))return[document.createElement(RegExp.$1)];var e=[],i=document.createElement("div"),n=i.childNodes;i.innerHTML=t;for(var s=0,r=n.length;s<r;s++)e.push(n[s]);return e},add:function(t){this.nodes=this.nodes.concat(this._toArray(t))},get:function(t){return this.nodes[t||0]||!1},getAll:function(){return this.nodes},eq:function(t){return new Dom(this.nodes[t])||!1},first:function(){return new Dom(this.nodes[0])||!1},last:function(){return new Dom(this.nodes[this.nodes.length-1])||!1},contents:function(){return this.get().childNodes},each:function(t){for(var e=this.nodes.length,i=0;i<e;i++)t.call(this,this.nodes[i].dom?this.nodes[i].get():this.nodes[i],i);return this},is:function(t){return this.filter(t).length>0},filter:function(t){return void 0===t?this:new Dom(this.nodes.filter("function"==typeof t?t:function(e){return t instanceof Node?t===e:t&&t.dom?-1!==t.nodes.indexOf(e):(e.matches=e.matches||e.msMatchesSelector||e.webkitMatchesSelector,1===e.nodeType&&e.matches(t||"*"))}))},not:function(t){return this.filter(function(e){return!new Dom(e).is(t||!0)})},find:function(t){var e=[];return this.each(function(i){for(var n=this._query(t||"*",i),s=0;s<n.length;s++)e.push(n[s])}),new Dom(e)},children:function(t){var e=[];return this.each(function(t){if(t.children)for(var i=t.children,n=0;n<i.length;n++)e.push(i[n])}),new Dom(e).filter(t)},parent:function(t){var e=[];return this.each(function(t){t.parentNode&&e.push(t.parentNode)}),new Dom(e).filter(t)},parents:function(t,e){e=this._getContext(e);var i=[];return this.each(function(n){for(var s=n.parentNode;s&&s!==e;)t?new Dom(s).is(t)&&i.push(s):i.push(s),s=s.parentNode}),new Dom(i)},closest:function(t,e){e=this._getContext(e);var i=[],n=(t=t.dom?t.get():t)&&t.nodeType;return this.each(function(s){do{if(n&&s===t||new Dom(s).is(t))return i.push(s)}while((s=s.parentNode)&&s!==e)}),new Dom(i)},next:function(){return new Dom(this.get().nextSibling)},nextElement:function(){return new Dom(this.get().nextElementSibling)},prev:function(){return new Dom(this.get().previousSibling)},prevElement:function(){return new Dom(this.get().previousElementSibling)},css:function(t,e){if(void 0===e&&"object"!=typeof t){var i=this.get();return"width"===t||"height"===t?i.style?this._getHeightOrWidth(t,i,!1)+"px":void 0:i.style?getComputedStyle(i,null)[t]:void 0}return this.each(function(i){var n={};for(var s in"object"==typeof t?n=t:n[t]=e,n)i.style&&(i.style[s]=n[s])})},attr:function(t,e,i){return i=i?"data-":"",void 0===e&&"object"!=typeof t?3!==this.get().nodeType?"checked"===t?this.get().checked:this.get().getAttribute(i+t):void 0:this.each(function(n){var s={};for(var r in"object"==typeof t?s=t:s[t]=e,s)3!==n.nodeType&&("checked"===r&&!1===s[r]?n.removeAttribute(r):n.setAttribute(i+r,s[r]))})},data:function(t,e){if(void 0===t){var i=/^data\-(.+)$/,n=this.get().attributes,s={};for(var r in n)i.test(n[r].nodeName)&&(s[t=(t=n[r].nodeName.match(i)[1]).replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})]=this._isNumber(n[r].value)?parseFloat(n[r].value):n[r].value);return s}return this.attr(t,e,!0)},val:function(t){if(void 0===t){var e=this.get();return e.type&&"checkbox"===e.type?e.checked:e.value}return this.each(function(e){e.value=t})},removeAttr:function(t){return this.each(function(e){t.split(" ").forEach(function(t){3!==e.nodeType&&e.removeAttribute(t)})})},removeData:function(t){return this.each(function(e){t.split(" ").forEach(function(t){3!==e.nodeType&&e.removeAttribute("data-"+t)})})},dataset:function(t,e){return this.each(function(i){DomCache[this.dataindex(i)][t]=e})},dataget:function(t){return DomCache[this.dataindex(this.get())][t]},dataindex:function(t){var e=t[DomExpando];return e||(e=t[DomExpando]=DomCache.length,DomCache[e]={}),e},addClass:function(t){return this._eachClass(t,"add")},removeClass:function(t){return this._eachClass(t,"remove")},toggleClass:function(t){return this._eachClass(t,"toggle")},hasClass:function(t){return this.nodes.some(function(e){return!!e.classList&&e.classList.contains(t)})},empty:function(){return this.each(function(t){return t.innerHTML=""})},html:function(t){return void 0===t?this.get().innerHTML||"":this.empty().append(t)},text:function(t){return void 0===t?this.get().textContent||"":this.each(function(e){e.textContent=t})},after:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("afterend",t);else for(var i=t instanceof Node?[t]:this._toArray(t).reverse(),n=0;n<i.length;n++)e.parentNode.insertBefore(i[n],e.nextSibling);return e})},before:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("beforebegin",t);else for(var i=t instanceof Node?[t]:this._toArray(t),n=0;n<i.length;n++)e.parentNode.insertBefore(i[n],e);return e})},append:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("beforeend",t);else for(var i=t instanceof Node?[t]:this._toArray(t),n=0;n<i.length;n++)e.appendChild(i[n]);return e})},prepend:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("afterbegin",t);else for(var i=t instanceof Node?[t]:this._toArray(t).reverse(),n=0;n<i.length;n++)e.insertBefore(i[n],e.firstChild);return e})},wrap:function(t){return this._inject(t,function(t,e){var i="string"==typeof t?this.create(t)[0]:t instanceof Node?t:this._toArray(t)[0];return e.parentNode&&e.parentNode.insertBefore(i,e),i.appendChild(e),new Dom(i)})},unwrap:function(){return this.each(function(t){var e=new Dom(t);return e.replaceWith(e.contents())})},replaceWith:function(t){return this._inject(t,function(t,e){for(var i=document.createDocumentFragment(),n="string"==typeof t?this.create(t):t instanceof Node?[t]:this._toArray(t),s=0;s<n.length;s++)i.appendChild(n[s]);var r=i.childNodes[0];return e.parentNode.replaceChild(i,e),r})},remove:function(){return this.each(function(t){t.parentNode&&t.parentNode.removeChild(t)})},clone:function(t){var e=[];return this.each(function(i){var n=this._clone(i);t&&(n=this._cloneEvents(i,n)),e.push(n)}),new Dom(e)},show:function(){return this.each((function(t){if(t.style){if("none"!==this._getRealDisplay(t))return;var e=t.getAttribute("displayOld");if(t.style.display=e||"","none"===this._getRealDisplay(t)){var i,n=t.nodeName,s=document.body;if(DomDisplayCache[n])i=DomDisplayCache[n];else{var r=document.createElement(n);s.appendChild(r),"none"===(i=this._getRealDisplay(r))&&(i="block"),s.removeChild(r),DomDisplayCache[n]=i}t.setAttribute("displayOld",i),t.style.display=i}}}).bind(this))},hide:function(){return this.each(function(t){t.style&&(t.getAttribute("displayOld")||""===t.style.display||t.setAttribute("displayOld",t.style.display),t.style.display="none")})},scrollTop:function(t){var e=this.get(),i=e===window,n=9===e.nodeType?document.documentElement||document.body.parentNode||document.body:e;if(void 0===t)return i?window.pageYOffset:n.scrollTop;i?window.scrollTo(0,t):n.scrollTop=t},offset:function(){return this._getDim("Offset")},position:function(){return this._getDim("Position")},width:function(t,e){return this._getSize("width","Width",t,e)},height:function(t,e){return this._getSize("height","Height",t,e)},outerWidth:function(){return this._getInnerOrOuter("width","outer")},outerHeight:function(){return this._getInnerOrOuter("height","outer")},innerWidth:function(){return this._getInnerOrOuter("width","inner")},innerHeight:function(){return this._getInnerOrOuter("height","inner")},click:function(){return this._triggerEvent("click")},focus:function(){return this._triggerEvent("focus")},trigger:function(t){return this.each(function(e){for(var i=t.split(" "),n=0;n<i.length;n++){var s;try{s=new window.CustomEvent(i[n],{bubbles:!0,cancelable:!0})}catch(t){(s=document.createEvent("CustomEvent")).initCustomEvent(i[n],!0,!0)}e.dispatchEvent(s)}})},on:function(t,e,i){return this.each(function(n){for(var s=t.split(" "),r=0;r<s.length;r++){var o=this._getEventName(s[r]),a=this._getEventNamespace(s[r]);e=i?this._getOneHandler(e,t):e,n.addEventListener(o,e),n._e=n._e||{},n._e[a]=n._e[a]||{},n._e[a][o]=n._e[a][o]||[],n._e[a][o].push(e)}})},one:function(t,e){return this.on(t,e,!0)},off:function(t,e){return this.each(void 0===t?function(t){this._offEvent(t,!1,!1,e,function(t,e,i,n){return!0})}:function(i){for(var n=t.split(" "),s=0;s<n.length;s++){var r=this._getEventName(n[s]),o=this._getEventNamespace(n[s]);this._offEvent(i,r,o,e,"_events"===o?function(t,e,i,n){return t===i}:r||"_events"===o?function(t,e,i,n){return t===i&&e===n}:function(t,e,i,n){return e===n})}})},serialize:function(t){for(var e={},i=this.get().elements,n=0;n<i.length;n++){var s=i[n];if((!/(checkbox|radio)/.test(s.type)||s.checked)&&s.name&&!s.disabled&&"file"!==s.type){if("select-multiple"===s.type)for(var r=0;r<s.options.length;r++){var o=s.options[r];o.selected&&(e[s.name]=o.value)}e[s.name]=s.value}}return t?e:this._toParams(e)},ajax:function(t,e){if("undefined"!=typeof AjaxRequest){var i=this.attr("method")||"post",n={url:this.attr("action"),data:this.serialize(),success:t,error:e};return new AjaxRequest(i,n)}},_queryContext:function(t,e){return 3!==(e=this._getContext(e)).nodeType&&"function"==typeof e.querySelectorAll?e.querySelectorAll(t):[]},_query:function(t,e){if(e)return this._queryContext(t,e);if(/^[.#]?[\w-]*$/.test(t)){if("#"===t[0]){var i=document.getElementById(t.slice(1));return i?[i]:[]}return"."===t[0]?document.getElementsByClassName(t.slice(1)):document.getElementsByTagName(t)}return document.querySelectorAll(t)},_getContext:function(t){return(t="string"==typeof t?document.querySelector(t):t)&&t.dom?t.get():t||document},_inject:function(t,e){for(var i=this.nodes.length,n=[];i--;){t="function"==typeof t?t.call(this,this.nodes[i]):t;var s=0===i?t:this._clone(t),r=e.call(this,s,this.nodes[i]);r&&n.push(r.dom?r.get():r)}return new Dom(n)},_cloneEvents:function(t,e){var i=t._e;if(i)for(var n in e._e=i,i._events)for(var s=0;s<i._events[n].length;s++)e.addEventListener(n,i._events[n][s]);return e},_clone:function(t){if("undefined"!=typeof t)return"string"==typeof t?t:t instanceof Node?t.cloneNode(!0):"length"in t?[].map.call(this._toArray(t),function(t){return t.cloneNode(!0)}):t},_slice:function(t){return t&&0!==t.length?t.length?[].slice.call(t.nodes||t):[t]:[]},_eachClass:function(t,e){return this.each(function(i){t&&t.split(" ").forEach(function(t){i.classList&&i.classList[e](t)})})},_triggerEvent:function(t){var e=this.get();return e&&3!==e.nodeType&&e[t](),this},_getOneHandler:function(t,e){var i=this;return function(){t.apply(this,arguments),i.off(e)}},_getEventNamespace:function(t){var e=t.split("."),i=e[1]?e[1]:"_events";return e[2]?i+e[2]:i},_getEventName:function(t){return t.split(".")[0]},_offEvent:function(t,e,i,n,s){for(var r in t._e)for(var o in t._e[r])if(s(o,r,e,i))for(var a=t._e[r][o],l=0;l<a.length;l++)"undefined"!=typeof n&&a[l].toString()!==n.toString()||(t.removeEventListener(o,a[l]),t._e[r][o].splice(l,1),0===t._e[r][o].length&&delete t._e[r][o],0===Object.keys(t._e[r]).length&&delete t._e[r])},_getInnerOrOuter:function(t,e){return this[t](void 0,e)},_getDocSize:function(t,e){var i=t.body,n=t.documentElement;return Math.max(i["scroll"+e],i["offset"+e],n["client"+e],n["scroll"+e],n["offset"+e])},_getSize:function(t,e,i,n){if(void 0===i){var s=this.get();return i=3===s.nodeType?0:9===s.nodeType?this._getDocSize(s,e):s===window?window["inner"+e]:this._getHeightOrWidth(t,s,n||"normal"),Math.round(i)}return this.each((function(e){i=parseFloat(i),i+=this._adjustResultHeightOrWidth(t,e,n||"normal"),new Dom(e).css(t,i+"px")}).bind(this))},_getHeightOrWidth:function(t,e,i){var n=t.charAt(0).toUpperCase()+t.slice(1),s=getComputedStyle(e,null),r=new Dom(e),o=r.parents().filter(function(t){return"none"===getComputedStyle(t,null).display&&t});if("none"===s.display&&o.add(e),0!==o.length){var a="visibility: hidden !important; display: block !important;",l=[],u=0;o.each(function(t){var e=new Dom(t),i=e.attr("style");l.push(i),e.attr("style",i?i+";"+a:a)}),u=r.get()["offset"+n]-this._adjustResultHeightOrWidth(t,e,i),o.each(function(t,e){var i=new Dom(t);void 0===l[e]?i.removeAttr("style"):i.attr("style",l[e])})}else u=e["offset"+n]-this._adjustResultHeightOrWidth(t,e,i);return u},_adjustResultHeightOrWidth:function(t,e,i){if(!e||!1===i)return 0;var n=0,s=getComputedStyle(e,null),r="border-box"===s.boxSizing;return"height"===t?(("inner"===i||"normal"===i&&r)&&(n+=(parseFloat(s.borderTopWidth)||0)+(parseFloat(s.borderBottomWidth)||0)),"outer"===i&&(n-=(parseFloat(s.marginTop)||0)+(parseFloat(s.marginBottom)||0))):(("inner"===i||"normal"===i&&r)&&(n+=(parseFloat(s.borderLeftWidth)||0)+(parseFloat(s.borderRightWidth)||0)),"outer"===i&&(n-=(parseFloat(s.marginLeft)||0)+(parseFloat(s.marginRight)||0))),n},_getDim:function(t){var e=this.get();return 3===e.nodeType?{top:0,left:0}:this["_get"+t](e)},_getPosition:function(t){return{top:t.offsetTop,left:t.offsetLeft}},_getOffset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.documentElement,s=i.defaultView;return{top:e.top+s.pageYOffset-n.clientTop,left:e.left+s.pageXOffset-n.clientLeft}},_toArray:function(t){if(t instanceof NodeList){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}return void 0===t?[]:t.dom?t.nodes:t},_toParams:function(t){var e="";for(var i in t)e+="&"+this._encodeUri(i)+"="+this._encodeUri(t[i]);return e.replace(/^&/,"")},_encodeUri:function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_isNumber:function(t){return!isNaN(parseFloat(t))},_getRealDisplay:function(t){return t.currentStyle?t.currentStyle.display:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue("display"):void 0}};var uuid=0,$R=function(t,e){return RedactorApp(t,e,[].slice.call(arguments,2))};$R.version="3.0",$R.options={},$R.modules={},$R.services={},$R.classes={},$R.plugins={},$R.mixins={},$R.modals={},$R.lang={},$R.dom=function(t,e){return new Dom(t,e)},$R.ajax=Ajax,$R.Dom=Dom,$R.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37},$R.env={plugin:"plugins",module:"modules",service:"services",class:"classes",mixin:"mixins"},"undefined"!=typeof jQuery&&(jQuery.fn.redactor=function(t){return RedactorApp(this.toArray(),t,[].slice.call(arguments,1))});var RedactorApp=function(t,e,i){for(var n,s=Array.isArray(t)?t:t&&t.nodeType?[t]:document.querySelectorAll(t),r="string"==typeof e||"function"==typeof e,o=[],a=0;a<s.length;a++){var l=s[a],u=$R.dom(l);if((n=u.dataget("redactor"))||r||(u.dataset("redactor",n=new App(l,e,uuid)),uuid++),n&&r){var h,c="destroy"===e;"function"==typeof(e=c?"stop":e)?h=e.apply(n,i):(i.unshift(e),h=n.api.apply(n,i)),void 0!==h&&o.push(h),c&&u.dataset("redactor",!1)}}return 0===o.length||1===o.length?0===o.length?n:o[0]:o};$R.add=function(t,e,i){if("undefined"!=typeof $R.env[t])if(i.translations&&($R.lang=$R.extend(!0,{},$R.lang,i.translations)),i.modals&&($R.modals=$R.extend(!0,{},$R.modals,i.modals)),"mixin"===t)$R[$R.env[t]][e]=i;else{var n=function(){};if(n.prototype=i,i.mixins)for(var s=0;s<i.mixins.length;s++)$R.inherit(n,$R.mixins[i.mixins[s]]);$R[$R.env[t]][e]=n}},$R.create=function(t){var e=t.split("."),i=[].slice.call(arguments,1),n="classes";"undefined"!=typeof $R.env[e[0]]&&(n=$R.env[e[0]],t=e.slice(1).join("."));var s=new $R[n][t];return s.init&&s.init.apply(s,i)||s},$R.inherit=function(t,e){var i=function(){};i.prototype=e;var n=new i;for(var s in t.prototype)t.prototype.__lookupGetter__(s)?n.__defineGetter__(s,t.prototype.__lookupGetter__(s)):n[s]=t.prototype[s];return t.prototype=n,t.prototype.super=e,t},$R.error=function(t){throw t},$R.extend=function(){var t={},e=!1,i=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);for(var s=function(i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=e&&"[object Object]"===Object.prototype.toString.call(i[n])?$R.extend(!0,t[n],i[n]):i[n])};i<n;i++)s(arguments[i]);return t},$R.opts={animation:!0,lang:"en",direction:"ltr",spellcheck:!0,structure:!1,scrollTarget:!1,styles:!0,stylesClass:"redactor-styles",placeholder:!1,source:!0,showSource:!1,inline:!1,breakline:!1,markup:"p",enterKey:!0,clickToEdit:!1,clickToSave:!1,clickToCancel:!1,focus:!1,focusEnd:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:[],callbacks:{},preClass:!1,preSpaces:4,tabindex:!1,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveData:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarContext:!0,air:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,formattingHide:!1,buttons:["html","format","bold","italic","deleted","lists","image","file","link"],buttonsTextLabeled:!1,buttonsAdd:[],buttonsAddFirst:[],buttonsAddAfter:!1,buttonsAddBefore:!1,buttonsHide:[],buttonsHideOnMobile:[],imageUpload:!1,imageUploadParam:"file",imageData:!1,imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",fileUpload:!1,fileUploadParam:"file",fileData:!1,fileAttachment:!1,uploadData:!1,dragUpload:!0,multipleUpload:!0,clipboardUpload:!0,uploadBase64:!1,accessToken:void 0,linkTarget:!1,linkNewTab:!1,linkNofollow:!1,linkSize:30,linkValidation:!0,cleanOnEnter:!0,cleanInlineOnEnter:!1,paragraphize:!0,removeScript:!0,removeNewLines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},pastePlainText:!1,pasteLinkTarget:!1,pasteImages:!0,pasteLinks:!0,pasteClean:!0,pasteKeepStyle:[],pasteKeepClass:[],pasteKeepAttrs:["td","th"],pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["a","img","br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i","abbr"],activeButtons:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},activeButtonsAdd:{},activeButtonsObservers:{},autoparse:!0,autoparseStart:!0,autoparsePaste:!0,autoparseLinks:!0,autoparseImages:!0,autoparseVideo:!0,shortcodes:{"p.":{format:"p"},"quote.":{format:"blockquote"},"pre.":{format:"pre"},"h1.":{format:"h1"},"h2.":{format:"h2"},"h3.":{format:"h3"},"h4.":{format:"h4"},"h5.":{format:"h5"},"h6.":{format:"h6"},"1.":{format:"ol"},"*.":{format:"ul"}},shortcodesAdd:!1,shortcuts:{"ctrl+shift+m, meta+shift+m":{api:"module.inline.clearformat"},"ctrl+b, meta+b":{api:"module.inline.format",args:"b"},"ctrl+i, meta+i":{api:"module.inline.format",args:"i"},"ctrl+h, meta+h":{api:"module.inline.format",args:"sup"},"ctrl+l, meta+l":{api:"module.inline.format",args:"sub"},"ctrl+k, meta+k":{api:"module.link.open"},"ctrl+alt+0, meta+alt+0":{api:"module.block.format",args:"p"},"ctrl+alt+1, meta+alt+1":{api:"module.block.format",args:"h1"},"ctrl+alt+2, meta+alt+2":{api:"module.block.format",args:"h2"},"ctrl+alt+3, meta+alt+3":{api:"module.block.format",args:"h3"},"ctrl+alt+4, meta+alt+4":{api:"module.block.format",args:"h4"},"ctrl+alt+5, meta+alt+5":{api:"module.block.format",args:"h5"},"ctrl+alt+6, meta+alt+6":{api:"module.block.format",args:"h6"},"ctrl+shift+7, meta+shift+7":{api:"module.list.toggle",args:"ol"},"ctrl+shift+8, meta+shift+8":{api:"module.list.toggle",args:"ul"}},shortcutsAdd:!1,bufferLimit:100,emptyHtml:"<p></p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small","abbr"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","table","tbody","thead","tfoot","tr","th","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],regex:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi},input:!0,zindex:!1,modes:{inline:{pastePlainText:!0,pasteImages:!1,enterKey:!1,toolbar:!1,autoparse:!1,source:!1,showSource:!1,styles:!1,air:!1},original:{styles:!1}}},$R.lang.en={format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline",superscript:"Superscript",subscript:"Subscript","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U","superscript-abbr":"Sup","subscript-abbr":"Sub",lists:"Lists","link-insert":"Insert Link","link-edit":"Edit Link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line",upload:"Upload","upload-label":"Drop files here or click to upload","accessibility-help-label":"Rich text editor",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center",undo:"Undo",redo:"Redo"},$R.buttons={html:{title:"HTML",icon:!0,api:"module.source.toggle"},undo:{title:"## undo ##",icon:!0,api:"module.buffer.undo"},redo:{title:"## redo ##",icon:!0,api:"module.buffer.redo"},format:{title:"## format ##",icon:!0,dropdown:{p:{title:"## paragraph ##",api:"module.block.format",args:{tag:"p"}},blockquote:{title:"## quote ##",api:"module.block.format",args:{tag:"blockquote"}},pre:{title:"## code ##",api:"module.block.format",args:{tag:"pre"}},h1:{title:"## heading1 ##",api:"module.block.format",args:{tag:"h1"}},h2:{title:"## heading2 ##",api:"module.block.format",args:{tag:"h2"}},h3:{title:"## heading3 ##",api:"module.block.format",args:{tag:"h3"}},h4:{title:"## heading4 ##",api:"module.block.format",args:{tag:"h4"}},h5:{title:"## heading5 ##",api:"module.block.format",args:{tag:"h5"}},h6:{title:"## heading6 ##",api:"module.block.format",args:{tag:"h6"}}}},bold:{title:"## bold-abbr ##",icon:!0,tooltip:"## bold ##",api:"module.inline.format",args:{tag:"b"}},italic:{title:"## italic-abbr ##",icon:!0,tooltip:"## italic ##",api:"module.inline.format",args:{tag:"i"}},deleted:{title:"## deleted-abbr ##",icon:!0,tooltip:"## deleted ##",api:"module.inline.format",args:{tag:"del"}},underline:{title:"## underline-abbr ##",icon:!0,tooltip:"## underline ##",api:"module.inline.format",args:{tag:"u"}},sup:{title:"## superscript-abbr ##",icon:!0,tooltip:"## superscript ##",api:"module.inline.format",args:{tag:"sup"}},sub:{title:"## subscript-abbr ##",icon:!0,tooltip:"## subscript ##",api:"module.inline.format",args:{tag:"sub"}},lists:{title:"## lists ##",icon:!0,observe:"list",dropdown:{observe:"list",unorderedlist:{title:"&bull; ## unorderedlist ##",api:"module.list.toggle",args:"ul"},orderedlist:{title:"1. ## orderedlist ##",api:"module.list.toggle",args:"ol"},outdent:{title:"< ## outdent ##",api:"module.list.outdent"},indent:{title:"> ## indent ##",api:"module.list.indent"}}},ul:{title:"&bull; ## bulletslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ul"},ol:{title:"1. ## numberslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ol"},outdent:{title:"## outdent ##",icon:!0,api:"module.list.outdent",observe:"list"},indent:{title:"## indent ##",icon:!0,api:"module.list.indent",observe:"list"},image:{title:"## image ##",icon:!0,api:"module.image.open"},file:{title:"## file ##",icon:!0,api:"module.file.open"},link:{title:"## link ##",icon:!0,observe:"link",dropdown:{observe:"link",link:{title:"## link-insert ##",api:"module.link.open"},unlink:{title:"## unlink ##",api:"module.link.unlink"}}},line:{title:"## horizontalrule ##",icon:!0,api:"module.line.insert"}};var App=function(t,e,i){this.module={},this.plugin={},this.instances={},this.started=!1,this.stopped=!1,this.uuid=i,this.rootElement=t,this.rootOpts=e,this.keycodes=$R.keycodes,this.namespace="redactor",this.$win=$R.dom(window),this.$doc=$R.dom(document),this.$body=$R.dom("body"),this.opts=$R.create("service.options",e,t),this.lang=$R.create("service.lang",this),this.buildServices(),this.buildModules(),this.buildPlugins(),this.start()};App.prototype={start:function(){this.stopped=!1,this.broadcast("start"),this.broadcast("startcode"),this.opts.clickToEdit?this.broadcast("startclicktoedit"):(this.broadcast("enable"),this.opts.showSource&&this.broadcast("startcodeshow"),this.broadcast("enablefocus")),this.broadcast("started"),this.started=!0},stop:function(){this.started=!1,this.stopped=!0,this.broadcast("stop"),this.broadcast("disable"),this.broadcast("stopped")},isStarted:function(){return this.started},isStopped:function(){return this.stopped},buildServices:function(){var t=["opts","lang"],e=["uuid","keycodes","opts","lang","$win","$doc","$body"],i=[];for(var n in $R.services)-1===t.indexOf(n)&&(this[n]=$R.create("service."+n,this),i.push(n),e.push(n));for(var s=0;s<i.length;s++)for(var r=i[s],o=0;o<e.length;o++){var a=e[o];r!==a&&(this[r][a]=this[a])}},buildModules:function(){for(var t in $R.modules)this.module[t]=$R.create("module."+t,this),this.instances[t]=this.module[t]},buildPlugins:function(){for(var t=this.opts.plugins,e=0;e<t.length;e++){var i=t[e];"undefined"!=typeof $R.plugins[i]&&(this.plugin[i]=$R.create("plugin."+i,this),this.instances[i]=this.plugin[i])}},isReadOnly:function(){return this.editor.getElement().hasClass("redactor-read-only")},enableReadOnly:function(){this.broadcast("enablereadonly"),this.component.clearActive(),this.toolbar.disableButtons()},disableReadOnly:function(){this.broadcast("disablereadonly"),this.toolbar.enableButtons()},callMessageHandler:function(t,e,i){var n=e.split(".");if(1===n.length)"function"==typeof t["on"+e]&&t["on"+e].apply(t,i);else{n[0]="on"+n[0];var s=this.utils.checkProperty(t,n);"function"==typeof s&&s.apply(t,i)}},broadcast:function(t){var e=[].slice.call(arguments,1);for(var i in this.instances)this.callMessageHandler(this.instances[i],t,e);return this.callback.trigger(t,e)},on:function(t,e){this.callback.add(t,e)},off:function(t,e){this.callback.remove(t,e)},api:function(t){if((this.isStarted()||"start"===t)&&(!this.isReadOnly()||"disableReadOnly"===t)){this.broadcast("state");var e=[].slice.call(arguments,1),i=t.split("."),n="on"===i[0]||"off"===i[0],s=!n&&2===i.length,r="plugin"===i[0],o="module"===i[0];if(1===i.length){if("function"==typeof this[i[0]])return this.callInstanceMethod(this,i[0],e)}else{if(n)return"on"===i[0]?this.on(i[1],e[0]):this.off(i[1],e[0]||void 0);if(s){if(this.isInstanceExists(this,i[0]))return this.callInstanceMethod(this[i[0]],i[1],e);$R.error(new Error('Service "'+i[0]+'" not found'))}else if(r){if(this.isInstanceExists(this.plugin,i[1]))return this.callInstanceMethod(this.plugin[i[1]],i[2],e);$R.error(new Error('Plugin "'+i[1]+'" not found'))}else if(o){if(this.isInstanceExists(this.module,i[1]))return this.callInstanceMethod(this.module[i[1]],i[2],e);$R.error(new Error('Module "'+i[1]+'" not found'))}}}},isInstanceExists:function(t,e){return"undefined"!=typeof t[e]},callInstanceMethod:function(t,e,i){if("function"==typeof t[e])return t[e].apply(t,i)}},$R.add("mixin","formatter",{buildArgs:function(t){this.args={class:t.class||!1,style:t.style||!1,attr:t.attr||!1},this.args.class||this.args.style||this.args.attr||(this.args=!1)},applyArgs:function(t,e){return this.args?this[this.type](this.args,!1,t,e):this._clearAll(t,e)},clearClass:function(t,e){this.selection.save();var i=e?$R.dom(e):this.getElements(t,!0);return i.removeAttr("class"),this.selection.restore(),i.getAll()},clearStyle:function(t,e){this.selection.save();var i=e?$R.dom(e):this.getElements(t,!0);return i.removeAttr("style"),this.selection.restore(),i.getAll()},clearAttr:function(t,e){this.selection.save();var i=e?$R.dom(e):this.getElements(t,!0);return this._removeAllAttr(i),this.selection.restore(),i.getAll()},set:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);return t.class&&(s.removeAttr("class"),s.addClass(t.class)),t.style&&(s.removeAttr("style"),s.css(t.style),s.each(function(t){var e=$R.dom(t);e.attr("data-redactor-style-cache",e.attr("style"))})),t.attr&&(this._removeAllAttr(s),s.attr(t.attr)),this._getNodes(s,n)},toggle:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);if(t.class&&s.toggleClass(t.class),t.style){var r=t.style;s.each((function(t){var e=$R.dom(t);for(var i in r){var n=r[i],s=e.css(i);s=this.utils.isRgb(s)?this.utils.rgb2hex(s):s.replace(/"/g,""),n=this.utils.isRgb(n)?this.utils.rgb2hex(n):n.replace(/"/g,""),s=this.utils.hex2long(s);var o="string"==typeof(n=this.utils.hex2long(n))?n.toLowerCase():n,a="string"==typeof s?s.toLowerCase():s;e.css(i,o===a?"":n)}this._convertStyleQuotes(e),this.utils.removeEmptyAttr(t,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style"))}).bind(this))}return t.attr&&(r=t.attr,s.each(function(t){var e=$R.dom(t);for(var i in r)e.attr(i)?e.removeAttr(i):e.attr(i,r[i])})),this._getNodes(s,n)},add:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);if(t.class&&s.addClass(t.class),t.style){var r=t.style;s.each((function(t){var e=$R.dom(t);e.css(r),e.attr("data-redactor-style-cache",e.attr("style")),this._convertStyleQuotes(e)}).bind(this))}return t.attr&&s.attr(t.attr),this._getNodes(s,n)},remove:function(t,e,i,n){!1!==n&&this.selection.save();var s=i?$R.dom(i):this.getElements(e);if(t.class&&s.removeClass(t.class),t.style){var r=t.style;s.each((function(t){var e=$R.dom(t);e.css(r,""),this.utils.removeEmptyAttr(t,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style"))}).bind(this))}return t.attr&&s.removeAttr(t.attr),this._getNodes(s,n)},_getNodes:function(t,e){for(var i=t.getAll(),n=i.length-1,s=0;s<i.length;s++){if(s===n){var r=$R.dom(i[s]);3!==i[s].nodeType&&this.inspector.isBlockTag(i[s].tagName)&&r.hasClass("redactor-textnodes-wrapper")}i[s]=this._clearWrapperClass(i[s])}return!1!==e&&this.selection.restore(),i},_removeAllAttr:function(t){t.each(function(t){for(var e=t.attributes.length;e-- >0;){var i=t.attributes[e],n=i.name;"style"!==n&&"class"!==n&&t.removeAttributeNode(i)}})},_convertStyleQuotes:function(t){var e=t.attr("style");e&&t.attr("style",e.replace(/"/g,"'"))},_clearAll:function(t,e){!1!==e&&this.selection.save();for(var i=0;i<t.length;i++)for(var n=t[i];n.attributes.length>0;)n.removeAttribute(n.attributes[0].name);return!1!==e&&this.selection.restore(),t},_clearWrapperClass:function(t){return t.classList.remove("redactor-textnodes-wrapper"),""===t.getAttribute("class")&&t.removeAttribute("class"),t}}),$R.add("mixin","dom",$R.Dom.prototype),$R.add("mixin","component",{get cmnt(){return!0}}),$R.add("service","options",{init:function(t,e){var i=$R.dom(e);return $R.extend({},$R.opts,e?i.data():{},$R.options,t)}}),$R.add("service","lang",{init:function(t){this.app=t,this.opts=t.opts,this.vars=this._build(this.opts.lang)},rebuild:function(t){this.opts.lang=t,this.vars=this._build(t)},extend:function(t){this.vars=$R.extend(this.vars,t)},parse:function(t){if(void 0===t)return"";var e=t.match(/## (.*?) ##/g);if(e)for(var i=0;i<e.length;i++){var n=e[i].replace(/^##\s/g,"").replace(/\s##$/g,"");t=t.replace(e[i],this.get(n))}return t},get:function(t){return"undefined"!=typeof this.vars[t]?this.vars[t]:""},_build:function(t){var e=$R.lang.en;return"en"!==t&&(e=void 0!==$R.lang[t]?$R.lang[t]:e),e}}),$R.add("service","callback",{init:function(t){this.app=t,this.opts=t.opts,this.callbacks={},this.opts.callbacks&&this._set(this.opts.callbacks,"")},stop:function(){this.callbacks={}},add:function(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)},remove:function(t,e){if(void 0===e)delete this.callbacks[t];else{for(var i=0;i<this.callbacks[t].length;i++)this.callbacks[t].splice(i,1);0===Object.keys(this.callbacks[t]).length&&delete this.callbacks[t]}},trigger:function(t,e){var i=this._loop(t,e,this.callbacks);return"undefined"==typeof i?e[0]:i},_set:function(t,e){for(var i in t){var n=""===e?i:e+"."+i;"object"==typeof t[i]?this._set(t[i],n):(this.callbacks[n]=[],this.callbacks[n].push(t[i]))}},_loop:function(t,e,i){var n;for(var s in i)if(t===s)for(var r=0;r<i[s].length;r++)n=i[s][r].apply(this.app,e);return n}}),$R.add("service","animate",{init:function(t){this.animationOpt=t.opts.animation},start:function(t,e,i,n){var s={duration:!1,iterate:!1,delay:!1,timing:!1,prefix:"redactor-"};return s="function"==typeof i?s:$R.extend(s,i),new $R.AnimatePlay(t,e,s,n="function"==typeof i?i:n,this.animationOpt)},stop:function(t,e){this.$el=$R.dom(t),this.$el.removeClass("redactor-animated"),e=this.$el.attr("redactor-animate-effect"),this.$el.removeClass(e),this.$el.removeAttr("redactor-animate-effect");var i=this.$el.attr("redactor-animate-hide");i&&this.$el.addClass(i).removeAttr("redactor-animate-hide"),this.$el.off("animationend webkitAnimationEnd")}}),$R.AnimatePlay=function(t,e,i,n,s){return this.hidableEffects=["fadeOut","flipOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"],this.prefixes=["","-webkit-"],this.$el=$R.dom(t),this.$body=$R.dom("body"),this.callback=n,this.animation=s?e:this.buildAnimationOff(e),this.defaults=i,"slideUp"===this.animation&&this.$el.height(this.$el.height()),this.isInanimate()?this.inanimate():this.animate()},$R.AnimatePlay.prototype={buildAnimationOff:function(t){return this.isHidable(t)?"hide":"show"},buildHideClass:function(){return"redactor-animate-hide"},isInanimate:function(){return"show"===this.animation||"hide"===this.animation},isAnimated:function(){return this.$el.hasClass("redactor-animated")},isHidable:function(t){return-1!==this.hidableEffects.indexOf(t)},inanimate:function(){var t;return this.defaults.timing="linear","show"===this.animation?(t=this.buildHideClass(),this.$el.attr("redactor-animate-hide",t),this.$el.removeClass(t)):(t=this.$el.attr("redactor-animate-hide"),this.$el.addClass(t).removeAttr("redactor-animate-hide")),"function"==typeof this.callback&&this.callback(this),this},animate:function(){var t=this.defaults.delay?this.defaults.delay:0;return setTimeout((function(){if(this.$body.addClass("no-scroll-x"),this.$el.addClass("redactor-animated"),!this.$el.attr("redactor-animate-hide")){var t=this.buildHideClass();this.$el.attr("redactor-animate-hide",t),this.$el.removeClass(t)}this.$el.addClass(this.defaults.prefix+this.animation),this.$el.attr("redactor-animate-effect",this.defaults.prefix+this.animation),this.set(this.defaults.duration+"s",this.defaults.iterate,this.defaults.timing),this.complete()}).bind(this),1e3*t),this},set:function(t,e,i){for(var n=this.prefixes.length;n--;)!1===t&&""!==t||this.$el.css(this.prefixes[n]+"animation-duration",t),!1===e&&""!==e||this.$el.css(this.prefixes[n]+"animation-iteration-count",e),!1===i&&""!==i||this.$el.css(this.prefixes[n]+"animation-timing-function",i)},clean:function(){this.$body.removeClass("no-scroll-x"),this.$el.removeClass("redactor-animated"),this.$el.removeClass(this.defaults.prefix+this.animation),this.$el.removeAttr("redactor-animate-effect"),this.set("","","")},complete:function(){this.$el.one("animationend webkitAnimationEnd",(function(t){if(this.$el.hasClass(this.defaults.prefix+this.animation)&&this.clean(),this.isHidable(this.animation)){var e=this.$el.attr("redactor-animate-hide");this.$el.addClass(e).removeAttr("redactor-animate-hide")}"slideUp"===this.animation&&this.$el.height(""),"function"==typeof this.callback&&this.callback(this.$el)}).bind(this))}},$R.add("service","caret",{init:function(t){this.app=t},set:function(t){this.editor.focus(),this.component.clearActive();var e=$R.dom(t).get(),i=this.selection.getRange();i&&e&&(this.utils.isEmpty(e)?this.setAtStart(e):(i.collapse(!1),i.selectNodeContents(e),this.selection.setRange(i)))},setStart:function(t){this._setCaret("Start",t)},setAtStart:function(t){var e=document.createRange(),i=this.inspector.parse(t);if(this._isInPage(t)){if(e.setStart(t,0),e.collapse(!0),this.utils.isEmpty(t)||i.isInline()){var n=this._createTextNode();e.insertNode(n),e.selectNodeContents(n),e.collapse(!1)}this.selection.setRange(e)}},setEnd:function(t){this._setCaret("End",t)},setAtEnd:function(t){var e=this.inspector.parse(t).getTag(),i=document.createRange();if(this._isInPage(t)){if("a"===e){var n=document.createTextNode("\u200b");t.appendChild(n),i.setStartBefore(n),i.collapse(!0)}else i.selectNodeContents(t),i.collapse(!1);this.selection.setRange(i)}},setBefore:function(t){this._setCaret("Before",t)},setAtBefore:function(t){var e=this.inspector.parse(t),i=document.createRange();if(this._isInPage(t)){if(i.setStartBefore(t),i.collapse(!0),this.utils.isEmpty(t)&&e.isInline()){var n=this._createTextNode();t.appendChild(n)}this.selection.setRange(i)}},setAfter:function(t){this._setCaret("After",t)},setAtAfter:function(t){var e=document.createRange();if(this._isInPage(t)){e.setStartAfter(t),e.collapse(!0);var i=this._createTextNode();e.insertNode(i),e.selectNodeContents(i),e.collapse(!1),this.selection.setRange(e)}},setAtPrev:function(t){var e=t.previousSibling;e&&(e=3===e.nodeType&&this._isEmptyTextNode(e)?e.previousElementSibling:e)&&this.setEnd(e)},setAtNext:function(t){var e=t.nextSibling;e&&(e=3===e.nodeType&&this._isEmptyTextNode(e)?e.nextElementSibling:e)&&this.setStart(e)},isStart:function(t){return this._isStartOrEnd("First",t)},isEnd:function(t){return this._isStartOrEnd("Last",t)},_setCaret:function(t,e){var i=this.inspector.parse(e),n=i.getNode();n&&(this.component.clearActive(),this["_set"+t](n,i,i.getTag()))},_setStart:function(t,e,i){if(e.isText())return this.editor.focus(),this.setAtStart(t);if("ul"===i||"ol"===i){t=e.findFirstNode("li");var n=this.utils.getFirstElement(t),s=this.inspector.parse(n);if(n&&s.isComponent())return this.setStart(s.getComponent())}else if("dl"===i)t=e.findFirstNode("dt");else{if("br"===i||"hr"===i)return this.setBefore(t);if("td"===i||"th"===i){var r=e.getFirstElement(t);if(r)return this.setStart(r)}else{if("table"===i)return this.setStart(e.findFirstNode("th, td"));if(e.isComponentType("code")&&!e.isFigcaption()){var o=e.findLastNode("pre, code");return this.editor.focus(),this.setAtStart(o)}if("figure"===i&&e.isComponentType("table")){var a=e.getTable(),l=this.inspector.parse(a);return this.setStart(l.findFirstNode("th, td"))}if(!e.isComponentType("table")&&e.isComponent()&&!e.isFigcaption())return this.component.setActive(t)}}this.editor.focus(),this._setStartInline(t)||this.setAtStart(t)},_setEnd:function(t,e,i){if(e.isText())return this.editor.focus(),this.setAtEnd(t);if("ul"===i||"ol"===i){t=e.findLastNode("li");var n=this.utils.getLastElement(t),s=this.inspector.parse(n);if(n&&s.isComponent())return this.setEnd(s.getComponent())}else if("dl"===i)t=e.findLastNode("dd");else{if("br"===i||"hr"===i)return this.setAfter(t);if("td"===i||"th"===i){var r=e.getLastElement();if(r)return this.setEnd(r)}else{if("table"===i)return this.setEnd(e.findLastNode("th, td"));if(e.isComponentType("code")&&!e.isFigcaption()){var o=e.findLastNode("pre, code");return this.editor.focus(),this.setAtEnd(o)}if("figure"===i&&e.isComponentType("table")){var a=e.getTable(),l=this.inspector.parse(a);return this.setEnd(l.findLastNode("th, td"))}if(!e.isComponentType("table")&&e.isComponent()&&!e.isFigcaption())return this.component.setActive(t)}}if(this.editor.focus(),!this._setEndInline(t)){if(this.utils.isEmpty(t))return this.setStart(t);this.setAtEnd(t)}},_setBefore:function(t,e,i){return e.isInline()?this.setAtBefore(t):e.isFirstTableCell()?this.setAtPrev(e.getComponent()):"td"===i||"th"===i?this.setAtPrev(t):e.isFirstListItem()?this.setAtPrev(e.getList()):e.isFigcaption()?this.setStart(e.getComponent()):e.isComponent()?this.setAtPrev(e.getComponent()):e.isBlock()?this.setAtPrev(t):(this.editor.focus(),void this.setAtBefore(t))},_setAfter:function(t,e,i){return e.isInline()?this.setAtAfter(t):e.isLastTableCell()?this.setAtNext(e.getComponent()):"td"===i||"th"===i?this.setAtNext(t):e.isFirstListItem()?this.setAtNext(e.getList()):e.isComponent()?this.setAtNext(e.getComponent()):e.isBlock()?this.setAtNext(t):(this.editor.focus(),void this.setAtAfter(t))},_setStartInline:function(t){var e=this._hasInlineChild(t,"first");if(e)return this.setStart(e),!0},_setEndInline:function(t){var e=this._hasInlineChild(t,"last");if(e)return this.setEnd(e),!0},_isStartOrEnd:function(t,e){var i=this.editor.getElement(),n="undefined"==typeof e,s=n?i.get():$R.dom(e).get(),r=!n&&this.inspector.parse(s);if(s=n?s:this._isStartOrEndNode(s,r,t),r&&r.isComponent()&&!r.isComponentEditable())return!0;r&&r.isComponentEditable()||this.editor.focus();var o=this.offset.get(s,!0),a=!1;if("First"===t)a=o&&0===o.start;else{var l=this.offset.get(s,!0,!0);a=o&&o.end===l}return a},_isStartOrEndNode:function(t,e,i){return e.isTable()?t=e["find"+i+"Node"]("th, td"):e.isList()?t=e["find"+i+"Node"]("li"):e.isComponentType("code")&&(t=e.findLastNode("pre, code")),t},_isInPage:function(t){return!(!t||!t.nodeType)&&t!==document.body&&document.body.contains(t)},_hasInlineChild:function(t,e){var i=this.inspector.parse(t),n="first"===e?i.getFirstNode():i.getLastNode();if(n&&3!==n.nodeType&&this.inspector.isInlineTag(n.tagName))return n},_getPrevBlock:function(t){for(;t=t.previousSibling;)if(3!==t.nodeType&&"BR"!==t.tagName)return t;return!1},_getNextBlock:function(t){for(;t=t.nextSibling;)if(3!==t.nodeType&&"BR"!==t.tagName)return t;return!1},_isEmptyTextNode:function(t){return""===t.textContent.trim().replace(/\n/,"").replace(/[\u200B-\u200D\uFEFF]/g,"")},_createTextNode:function(){return document.createTextNode("\u200b")}}),$R.add("service","selection",{init:function(t){this.app=t},is:function(){var t=this.get();if(t){var e=this.inspector.parse(t.anchorNode);return e.isInEditor()||e.isEditor()}return!1},isCollapsed:function(){var t=this.get(),e=this.getRange();return!(!t||!t.isCollapsed)||!(!e||0!==e.toString().length)},isBackwards:function(){var t=!1,e=this.get();if(e&&!e.isCollapsed){var i=document.createRange();i.setStart(e.anchorNode,e.anchorOffset),i.setEnd(e.focusNode,e.focusOffset),t=i.collapsed,i.detach()}return t},isIn:function(t){var e=$R.dom(t).get(),i=this.getCurrent();return!(!i||!e)&&e.contains(i)},isText:function(){var t=this.get();if(t){var e=this.getBlock(t.anchorNode),i=this.getBlocks();if(this.component.isActive())return!1;if(0!==i.length)return!1;if(e&&this.inspector.isTableCellTag(e.tagName)||!1===e)return!0}return!1},isAll:function(t){if(this.isCollapsed())return!1;var e=this.editor.getElement(),i="undefined"==typeof t,n=(t=t||e.get(),!i&&this.inspector.parse(t));if(i&&this.editor.isEmpty())return!1;if(n&&n.isComponent()&&!n.isComponentEditable()&&this.component.isActive(t))return!0;if(!i){var s=n.isComponentType("code"),r=n.isTable();if(s||n.isPre()||r){var o=(t=s?n.getComponentCodeElement():t).textContent.trim().replace(/\t/g,"").replace(/\u200B/g,""),a=this.getText().trim().replace(/\t/g,"");return(o=r?o.replace(/\s+/g,""):o)===(r?a.replace(/\s+/g,""):a)}}var l=this.getRange();return!!l&&this._containsInRange(l,t)},hasNonEditable:function(){var t=this.getHtml(),e=$R.dom("<div>").html(t);return!this.isCollapsed()&&0!==e.find(".non-editable").length},setRange:function(t){var e=window.getSelection();e.removeAllRanges(),e.addRange(t)},setAll:function(t){var e=this.editor.getElement(),i="undefined"==typeof t;if(t=t||e.get(),i)e.prepend(this.marker.build("start")),e.append(this.marker.build("end")),this.component.clearActive(),this.restoreMarkers();else{var n=this.inspector.parse(t);if(n.isComponentType("code"))this.editor.saveScroll(),(t=n.getComponentCodeElement()).focus(),this.component.clearActive(),this._selectNodeAll(t),this.editor.restoreScroll();else if(n.isFigcaption()||!n.isComponent()||n.isComponentEditable()){this.editor.focus(),t=n.isComponentType("table")?n.getTable():t;var s=this.editor.getFirstNode();s&&3!==s.nodeType&&"FIGURE"===s.tagName&&this.component.setActive(s),this.component.clearActive(),this._selectNodeAll(t)}else this.component.setActive(t)}},get:function(){var t=window.getSelection();return t.rangeCount>0?t:null},getRange:function(){var t=this.get();return t&&t.getRangeAt(0)?t.getRangeAt(0):null},getTextBeforeCaret:function(t){t="undefined"==typeof t?1:t;var e=this.editor.getElement().get(),i=this.getRange(),n=!1;return i&&((i=i.cloneRange()).collapse(!0),i.setStart(e,0),n=i.toString().slice(-t)),n},getPosition:function(){this.get();var t=this.getRange(),e=0,i=0,n=0,s=0;if(window.getSelection&&t.getBoundingClientRect){var r=(t=t.cloneRange()).getBoundingClientRect();n=r.right-r.left,s=r.bottom-r.top,e=r.top,i=r.left}return{top:e,left:i,width:n,height:s}},getCurrent:function(){return this.component.getActive()||this._getCurrent()},getParent:function(){var t=this.getCurrent();if(t){var e=t.parentNode;return!this.inspector.parse(e).isEditor()&&e}return!1},getElement:function(t){for(var e=t||this.getCurrent();e;){var i=this.inspector.parse(e);if(i.isElement()&&i.isInEditor())return e;e=e.parentNode}return!1},getInline:function(t){for(var e=t||this.getCurrent(),i=!1;e;)this._isInlineNode(e)&&(i=e),e=e.parentNode;return i},getInlineFirst:function(t){for(var e=t||this.getCurrent();e;){if(this._isInlineNode(e))return e;e=e.parentNode}return!1},getInlineAll:function(t){for(var e=t||this.getCurrent(),i=[];e;)this._isInlineNode(e)&&i.push(e),e=e.parentNode;return i},getBlock:function(t){for(var e=t||this.getCurrent();e;){var i=this.inspector.parse(e);if(this.inspector.isBlockTag(e.tagName)&&i.isInEditor(e))return e;e=e.parentNode}return!1},getBlocks:function(t){for(var e,i=this.getNodes(),n=[],s=0;s<i.length;s++)(e=this.getBlock(i[s]))&&!this._isInNodesArray(n,e)&&this._filterBlock(e,t)&&n.push(e);return t&&t.tags?this._filterNodesByTags(n,t.tags):n},getInlines:function(t){for(var e=this.getNodes(),i=[],n=0;n<e.length;n++)if(t&&t.all)for(var s=e[n];s;)this._isInlineNode(s)&&i.push(s),s=s.parentNode;else(s=this.getInline(e[n]))&&i.push(s);var r=[];for(n=0;n<i.length;n++)(s=i[n])&&!this._isInNodesArray(r,s)&&this._filterInline(s,t)&&r.push(s);return t&&t.tags?this._filterNodesByTags(r,t.tags):r},getInlinesAllSelected:function(t){if(this.isAll())return[];var e=this.getInlines({all:!0}),i=this.getTextNodes({inline:!1}),n=this.getText().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=[];if(0!==i.length)return s;if(""===n)s=e;else if(e.length>1)for(var r=0;r<e.length;r++)this._isTextSelected(e[r],n)&&s.push(e[r]);else 1===e.length&&this._isTextSelected(e[0],n)&&(s=e);return t&&t.tags?this._filterNodesByTags(s,t.tags):s},getElements:function(t){var e=this.getNodes({textnodes:!1}),i=this.getBlock();e=0===e.length&&i?[i]:e;for(var n=[],s=0;s<e.length;s++)if(!this._isInNodesArray(n,e[s])){var r=!0;t&&t.tags&&-1===t.tags.indexOf(e[s].tagName.toLowerCase())&&(r=!1),r&&n.push(e[s])}return n},getTextNodes:function(t,e){var i=this.getNodes(),n=this.getRange(),s=(this.getBlocks(t),this.getHtml(!1));if(this.isText()&&""!==s&&t&&t.wrap)try{var r=$R.dom("<div>");return r.addClass("redactor-textnodes-wrapper"),r.html(s),n.surroundContents(r.get()),[r.get()]}catch(t){}for(var o=[],a=0;a<i.length;a++){var l=this.getBlock(i[a]);if(e&&l&&"TD"!==l.tagName&&"TH"!==l.tagName)this._filterBlock(l,t)&&(this._isInNodesArray(o,l)||(t&&t.tags?-1!==t.tags.indexOf(l.tagName.toLowerCase())&&o.push(l):o.push(l)));else if(3===i[a].nodeType||t&&t.wrap&&this.inspector.isInlineTag(i[a].tagName)){var u=!0;if(t&&t.first&&l&&(!t.cells||!(l&&"TD"===l.tagName||"TH"===l.tagName))&&(u=!1),t&&!1===t.inline&&this.getInline(i[a])&&(u=!1),u)if(t&&t.wrap){var h=this._getTextNodesWalker(i[a],n),c=this._wrapTextNodes(h);o.push(c)}else o.push(i[a])}}return o},getBlocksAndTextNodes:function(t){return this.getTextNodes(t,!0)},getNodes:function(t){var e=[],i=this.component.getActive();if(i)e=this._getNodesComponent(i);else if(this.isCollapsed()){var n=this.getCurrent();e=this.utils.isEmpty(n)?[this.getParent()]:[this.getCurrent()]}else this.is()&&!i&&(e=this._getNodesWalker());return e=this._filterServicesNodes(e),e=this._filterEditor(e),e=t&&t.tags?this._filterNodesByTags(e,t.tags):e,e=t&&t.textnodes?this._filterNodesTexts(e):e,t&&!t.textnodes?this._filterNodesElements(e):e},getText:function(){var t=this.get();return t?t.toString().replace(/\u200B/g,""):""},getHtml:function(t){var e="",i=this.get();if(i){for(var n=document.createElement("div"),s=i.rangeCount,r=0;r<s;++r)n.appendChild(i.getRangeAt(r).cloneContents());e=n.innerHTML,e=!1!==t?this.cleaner.output(e):e}return e},clear:function(){this.component.clearActive(),this.get().removeAllRanges()},collapseToStart:function(){var t=this.get();t&&!t.isCollapsed&&t.collapseToStart()},collapseToEnd:function(){var t=this.get();t&&!t.isCollapsed&&t.collapseToEnd()},save:function(){this._clearSaved();var t=this.component.getActive(),e=this.getCurrent(),i=this.inspector.parse(e).getTable();if(e&&i&&this.isAll(i))this.savedTable=i;else if(t)this.savedComponent=t;else{var n=this.editor.getElement().get(),s=this.getRange();this.saved={start:this._getNodeOffset(n,s.startContainer)+this._getTotalOffsets(s.startContainer,s.startOffset),end:this._getNodeOffset(n,s.endContainer)+this._getTotalOffsets(s.endContainer,s.endOffset)}}},restore:function(){if(this.saved||this.savedTable||this.savedComponent){if(this.editor.saveScroll(),this.savedTable)return this.setAll(this.savedTable),void this._clearSaved();if(this.savedComponent)return this.component.setActive(this.savedComponent),this._clearSaved(),void this.editor.restoreScroll();this.editor.focus();var t=this.editor.getElement().get(),e=this.getRange(),i=this._getNodeAndOffsetAt(t,this.saved.start),n=this._getNodeAndOffsetAt(t,this.saved.end);e.setStart(i.node,i.offset),e.setEnd(n.node,n.offset),this.setRange(e),this.editor.restoreScroll(),this._clearSaved()}},saveMarkers:function(){this.marker.remove(),this.marker.insert()},restoreMarkers:function(){this.editor.saveScroll(),this.editor.focus();var t=this.marker.find("start"),e=this.marker.find("end"),i=this.getRange();t&&e?this._setMarkerBoth(i,t,e):t&&this._setMarkerStart(i,t),this.editor.restoreScroll()},_getCurrent:function(){var t=this.get();if(t&&this.is()){var e=t.anchorNode;return this.inspector.parse(e).isEditor()?e.firstChild:e}return!1},_getNodesComponent:function(t){var e=this.getCurrent(),i=this.inspector.parse(e);return i.isFigcaption()?[i.getFigcaption()]:[t]},_getNodesWalker:function(){var t=[],e=this.getRange(),i=e.startContainer,n=e.endContainer,s=this.editor.getElement();if(i===s.get())t=this.isAll()?this.utils.getChildNodes(s):[];else if(i==n)t=[i];else{for(;i&&i!=n;)t.push(i=this._getNextNode(i));for(i=e.startContainer;i&&i!=e.commonAncestorContainer;)t.unshift(i),i=i.parentNode;if(0!==t.length){var r=t[0].parentNode;r&&t.unshift(r)}}return t},_getNextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},_getTextNodesWalker:function(t,e){var i=[],n=t.nextSibling,s=e.endContainer;return(i=this._getTextNodesSiblings("prev",t.previousSibling,e.startContainer,i)).push(t),this._getTextNodesSiblings("next",n,s,i)},_getTextNodesSiblings:function(t,e,i,n){for(;e;){if(void 0===e||"BR"===e.tagName||this.inspector.isBlockTag(e.tagName))return n;if("prev"===t){if(n.unshift(e),i===e)return n}else if(n.push(e),i===e)return n;e="prev"===t?e.previousSibling:e.nextSibling}return n},_wrapTextNodes:function(t){var e=$R.dom(t[t.length-1]),i=$R.dom("<div>");e.after(i),i.addClass("redactor-textnodes-wrapper"),i.append(t);var n=i.next(),s=n.get();return s&&"BR"===s.tagName?n.remove():n.hasClass("redactor-selection-marker")&&i.append(n),i.get()},_isTextSelected:function(t,e){var i=t.textContent.replace(/\u200B/g,"");return e===i||-1!==i.search(e)||-1!==e.search(new RegExp("^"+i))||-1!==e.search(new RegExp(i+"$"))},_isInNodesArray:function(t,e){return-1!==t.indexOf(e)},_filterEditor:function(t){for(var e=[],i=0;i<t.length;i++)this.inspector.parse(t[i]).isInEditor()&&e.push(t[i]);return e},_filterServicesNodes:function(t){for(var e=[],i=0;i<t.length;i++){var n=$R.dom(t[i]);t[i]&&3===t[i].nodeType&&this.utils.isEmpty(t[i])||n.hasClass("redactor-script-tag")||n.hasClass("redactor-component-caret")||n.hasClass("redactor-selection-marker")||e.push(t[i])}return e},_filterInline:function(t,e){var i=!0;return $R.dom(t).hasClass("redactor-selection-marker")&&(i=!1),e&&e.inside&&(window.getSelection().containsNode(t,!0)||(i=!1)),i},_filterBlock:function(t,e){var i=$R.dom(t),n=!0;if(e&&e.first){var s=i.parent().get();i.parent().hasClass("redactor-in")||e.cells&&s&&("TD"===s.tagName||"TH"===s.tagName)||(n=!1)}return n},_filterNodesTexts:function(t){for(var e=[],i=0;i<t.length;i++)3===t[i].nodeType&&e.push(t[i]);return e},_filterNodesElements:function(t){for(var e=[],i=0;i<t.length;i++)3!==t[i].nodeType&&e.push(t[i]);return e},_filterNodesByTags:function(t,e){for(var i=[],n=0;n<t.length;n++)if(3!==t[n].nodeType){var s=t[n].tagName.toLowerCase();-1!==e.indexOf(s.toLowerCase())&&i.push(t[n])}return i},_isInlineNode:function(t){var e=this.inspector.parse(t);return this.inspector.isInlineTag(t.tagName)&&e.isInEditor()},_containsInRange:function(t,e){for(var i,n,s,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return NodeFilter.FILTER_ACCEPT}},!1);s=r.nextNode();)i||(i=s),n=s;var o=t.cloneRange();return i?(o.setStart(i,0),o.setEnd(n,n.length)):o.selectNodeContents(e),t.compareBoundaryPoints(Range.START_TO_START,o)<1&&t.compareBoundaryPoints(Range.END_TO_END,o)>-1},_selectNodeAll:function(t){var e=this.getRange();e&&(e.selectNodeContents(t),this.setRange(e))},_setMarkerBoth:function(t,e,i){(t=this._createMarkersRange(t)).setStartBefore(e),t.setEndBefore(i),e.parentNode.removeChild(e),i.parentNode.removeChild(i),this.setRange(t)},_setMarkerStart:function(t,e){t=this._createMarkersRange(t);var i=e.nextSibling;i&&3!==i.nodeType&&"BR"===i.tagName?t.setStartBefore(i):i?(t.setStart(i,0),t.setEnd(i,0)):t.setEndBefore(e),e.parentNode.removeChild(e),this.setRange(t)},_createMarkersRange:function(t){return t||(t=this.editor.getElement().get().ownerDocument.createRange()),t},_clearSaved:function(){this.saved=!1,this.savedTable=!1,this.savedComponent=!1},_getNodeOffset:function(t,e){for(var i=0,n=t,s=[];;){if(n===e)return i;if(n.firstChild)n!==t&&(i+=1),s.push(n),n=n.firstChild;else if(s.length>0&&n.nextSibling)i+=3===n.nodeType?n.nodeValue.length+1:1,n=n.nextSibling;else for(i+=3===n.nodeType?n.nodeValue.length+1:1;;){if(s.length<=1)return i;var r=s.pop();if(r.nextSibling){n=r.nextSibling;break}}}},_getTotalOffsets:function(t,e){if(3==t.nodeType)return e;if(1==t.nodeType){for(var i=0,n=0;n<e;n++)i+=this._calculateNodeOffset(t.childNodes[n]);return i}return 0},_calculateNodeOffset:function(t){var e=0;if(e+=3===t.nodeType?t.nodeValue.length+1:1,t.childNodes)for(var i=0;i<t.childNodes.length;i++)e+=this._calculateNodeOffset(t.childNodes[i]);return e},_getNodeAndOffsetAt:function(t,e){for(var i=t,n=[];;){if(e<=0)return{node:i,offset:0};if(3==i.nodeType&&e<=i.nodeValue.length)return{node:i,offset:Math.min(e,i.nodeValue.length)};if(i.firstChild)i!==t&&(e-=1),n.push(i),i=i.firstChild;else if(n.length>0&&i.nextSibling)e-=3===i.nodeType?i.nodeValue.length+1:1,i=i.nextSibling;else for(;;){if(n.length<=1)return 3==i.nodeType?{node:i,offset:Math.min(e,i.nodeValue.length)}:{node:i,offset:0};var s=n.pop();if(s.nextSibling){e-=3===i.nodeType?i.nodeValue.length+1:1,i=s.nextSibling;break}}}}}),$R.add("service","element",{init:function(t){this.app=t,this.rootElement=t.rootElement,this.$element={},this.type="inline"},start:function(){this._build(),this._buildType()},isType:function(t){return t===this.type},getType:function(){return this.type},getElement:function(){return this.$element},_build:function(){this.$element=$R.dom(this.rootElement)},_buildType:function(){var t=this.$element.get().tagName;this.type="TEXTAREA"===t?"textarea":this.type,this.type="DIV"===t?"div":this.type,this.type=this.opts.inline?"inline":this.type}}),$R.add("service","editor",{init:function(t){this.app=t,this.scrolltop=!1,this.pasting=!1},start:function(){this._build()},focus:function(){this.isFocus()||this._isContenteditableFocus()||(this.saveScroll(),this.$editor.focus(),this.restoreScroll())},startFocus:function(){this.caret.setStart(this.getFirstNode())},endFocus:function(){this.caret.setEnd(this.getLastNode())},isPasting:function(){return this.pasting},enablePasting:function(){this.pasting=!0},disablePasting:function(){this.pasting=!1},saveScroll:function(){this.scrolltop=this._getScrollTarget().scrollTop()},restoreScroll:function(){!1!==this.scrolltop&&(this._getScrollTarget().scrollTop(this.scrolltop),this.scrolltop=!1)},disableNonEditables:function(){this.$noneditables=this.$editor.find("[contenteditable=false]"),this.$noneditables.attr("contenteditable",!0)},enableNonEditables:function(){this.$noneditables&&setTimeout((function(){this.$noneditables.attr("contenteditable",!1)}).bind(this),1)},getFirstNode:function(){return this.$editor.contents()[0]},getLastNode:function(){var t=this.$editor.contents();return t[t.length-1]},isSourceMode:function(){return this.source.getElement().hasClass("redactor-source-open")},isEmpty:function(){return this.utils.isEmptyHtml(this.$editor.html())},isFocus:function(){var t=$R.dom(document.activeElement);return 0!==this.$editor.find(".redactor-component-active").length||0!==t.closest(".redactor-in-"+this.uuid).length},getElement:function(){return this.$editor},_build:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?"<div>":t.get();this.$editor=$R.dom(e)},_getScrollTarget:function(){return this.opts.scrollTarget?$R.dom(this.opts.scrollTarget):this.$doc},_isContenteditableFocus:function(){var t=this.selection.getBlock();return 0!==(t?$R.dom(t).closest("[contenteditable=true]").not(".redactor-in"):[]).length}}),$R.add("service","container",{init:function(t){this.app=t},start:function(){this._build()},getElement:function(){return this.$container},_build:function(){var t=this.element.isType("inline")?"<span>":"<div>";this.$container=$R.dom(t)}}),$R.add("service","source",{init:function(t){this.app=t,this.$source={},this.content=""},start:function(){this._build(),this._buildName(),this._buildStartedContent()},getElement:function(){return this.$source},getCode:function(){return this.$source.val()},getName:function(){return this.$source.attr("name")},getStartedContent:function(){return this.content},setCode:function(t){return this.insertion.set(t)},isNameGenerated:function(){return this.name},_build:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?t.get():"<textarea>";this.$source=$R.dom(e)},_buildName:function(){var t=this.element.getElement();this.name=t.attr("name"),this.$source.attr("name",this.name?this.name:"content-"+this.uuid)},_buildStartedContent:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?t.val():t.html();this.content=e.trim()}}),$R.add("service","statusbar",{init:function(t){this.app=t,this.$statusbar={},this.items=[]},start:function(){this.$statusbar=$R.dom("<ul>")},add:function(t,e){return this.update(t,e)},update:function(t,e){var i;return"undefined"!=typeof this.items[t]?i=this.items[t]:(i=$R.dom("<li>"),this.$statusbar.append(i),this.items[t]=i),i.html(e)},get:function(t){return!!this.items[t]&&this.items[t]},remove:function(t){this.items[t]&&(this.items[t].remove(),delete this.items[t])},getItems:function(){return this.items},removeItems:function(){this.items={},this.$statusbar.html("")},getElement:function(){return this.$statusbar}}),$R.add("service","toolbar",{init:function(t){this.app=t,this.dropdownOpened=!1,this.buttonsObservers={}},start:function(){this.is()&&(this.opts.activeButtons=this.opts.activeButtonsAdd?this._extendActiveButtons():this.opts.activeButtons,this.create())},stopObservers:function(){this.buttonsObservers={}},create:function(){this.$wrapper=$R.dom("<div>"),this.$toolbar=$R.dom("<div>")},observe:function(){for(var t in this.setButtonsInactive(),this.buttonsObservers){var e=this.buttonsObservers[t],i=this.getButton(t);this.app.broadcast("button."+e+".observe",i)}var n=this.opts.activeButtons,s=this.selection.getInlinesAllSelected(),r=this._inlinesToTags(s);for(var o in n)-1!==r.indexOf(o)&&(i=this.getButton(n[o])).setActive()},is:function(){return!(!this.opts.toolbar||this.detector.isMobile()&&this.opts.air)},isAir:function(){return this.$toolbar.hasClass("redactor-air")},isFixed:function(){return this.$toolbar.hasClass("redactor-toolbar-fixed")},isContextBar:function(){return this.$body.find("#redactor-context-toolbar-"+this.uuid).hasClass("open")},getElement:function(){return this.$toolbar},getWrapper:function(){return this.$wrapper},getDropdown:function(){return this.dropdownOpened},getButton:function(t){var e=this._findButton(".re-"+t);return 0!==e.length&&e.dataget("data-button-instance")},getButtons:function(){var t=[];return this._findButtons().each(function(e){var i=$R.dom(e);t.push(i.dataget("data-button-instance"))}),t},getButtonsKeys:function(){var t=[];return this._findButtons().each(function(e){var i=$R.dom(e);t.push(i.attr("data-name"))}),t},addButton:function(t,e,i,n){i=i||"end";var s=$R.create("toolbar.button",this.app,t,e);return e.observe&&(this.opts.activeButtonsObservers[t]={observe:e.observe,button:s}),"first"===i?this.$toolbar.prepend(s):"after"===i?n.after(s):"before"===i?n.before(s):this.$toolbar.append(s),s},addButtonFirst:function(t,e){return this.addButton(t,e,"first")},addButtonAfter:function(t,e,i){var n=this.getButton(t);return n?this.addButton(e,i,"after",n):this.addButton(e,i)},addButtonBefore:function(t,e,i){var n=this.getButton(t);return n?this.addButton(e,i,"before",n):this.addButton(e,i)},addButtonObserver:function(t,e){this.buttonsObservers[t]=e},setDropdown:function(t){this.dropdownOpened=t},setButtonsInactive:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].setInactive()},setButtonsActive:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].setActive()},disableButtons:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].disable()},enableButtons:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].enable()},_findButton:function(t){return this.$toolbar.find(t)},_findButtons:function(){return this.$toolbar.find(".re-button")},_extendActiveButtons:function(){return $R.extend({},this.opts.activeButtons,this.opts.activeButtonsAdd)},_inlinesToTags:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].tagName.toLowerCase());return e}}),$R.add("class","toolbar.button",{mixins:["dom"],init:function(t,e,i){this.app=t,this.opts=t.opts,this.lang=t.lang,this.$body=t.$body,this.toolbar=t.toolbar,this.detector=t.detector,this.obj=i,this.name=e,this.dropdown=!1,this.tooltip=!1,this._init()},isActive:function(){return this.hasClass("redactor-button-active")},isDisabled:function(){return this.hasClass("redactor-button-disabled")},hasIcon:function(){return this.obj.icon&&!this.opts.buttonsTextLabeled},setDropdown:function(t){this.obj.dropdown=t,this.obj.message=!1,this.dropdown=$R.create("toolbar.dropdown",this.app,this.name,this.obj.dropdown),this.attr("data-dropdown",!0)},setMessage:function(t,e){this.obj.message=t,this.obj.args=e,this.obj.dropdown=!1},setApi:function(t,e){this.obj.api=t,this.obj.args=e,this.obj.dropdown=!1},setTitle:function(t){this.obj.title=this.lang.parse(t),this.obj.tooltip=this.obj.title,this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip}),this.attr("data-icon")||this.html(this.obj.title)},setTooltip:function(t){this.obj.tooltip=this.lang.parse(t),this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip})},setIcon:function(t){this.opts.buttonsTextLabeled||(this.obj.icon=!0,this.$icon=$R.dom(t),this.html(""),this.append(this.$icon),this.attr("data-icon",!0),this.addClass("re-button-icon"),this.setTooltip(this.obj.title),this._buildTooltip())},setActive:function(){this.addClass("redactor-button-active")},setInactive:function(){this.removeClass("redactor-button-active")},hideTooltip:function(){this.$body.find(".re-button-tooltip").remove()},getDropdown:function(){return this.dropdown},disable:function(){this.addClass("redactor-button-disabled")},enable:function(){this.removeClass("redactor-button-disabled")},toggle:function(t){t&&t.preventDefault(),this.isDisabled()||(this.obj.dropdown?this.dropdown.toggle(t):this.obj.api?this.app.api(this.obj.api,this.obj.args,this.name):this.obj.message&&this.app.broadcast(this.obj.message,this.obj.args,this.name),this.hideTooltip())},_init:function(){this._parseTitle(),this._parseTooltip(),this._build(),this._buildCallback(),this._buildAttributes(),this._buildObserver(),this.hasIcon()?(this._buildIcon(),this._buildTooltip()):this.html(this.obj.title)},_parseTooltip:function(){this.obj.tooltip=this.obj.tooltip?this.lang.parse(this.obj.tooltip):this.obj.title},_parseTitle:function(){this.obj.title=this.lang.parse(this.obj.title)},_build:function(){this.parse("<a>"),this.addClass("re-button re-"+this.name),this.attr("data-name",this.name),this.dataset("data-button-instance",this),this.obj.dropdown&&this.setDropdown(this.obj.dropdown)},_buildCallback:function(){this.on("click",this.toggle.bind(this))},_buildAttributes:function(){this.attr({href:"#",alt:this.obj.tooltip,rel:this.name,role:"button","aria-label":this.obj.tooltip,tabindex:"-1"})},_buildObserver:function(){"undefined"!=typeof this.obj.observe&&this.toolbar.addButtonObserver(this.name,this.obj.observe)},_buildIcon:function(){var t=this.obj.icon,e=/(<([^>]+)>)/gi.test(t);this.$icon=$R.dom(e?t:"<i>"),e||this.$icon.addClass("re-icon-"+this.name),this.append(this.$icon),this.attr("data-icon",!0),this.addClass("re-button-icon")},_buildTooltip:function(){this.detector.isDesktop()&&(this.tooltip=$R.create("toolbar.button.tooltip",this.app,this))}}),$R.add("class","toolbar.button.tooltip",{mixins:["dom"],init:function(t,e){this.app=t,this.$body=t.$body,this.toolbar=t.toolbar,this.$button=e,this.created=!1,this._init()},open:function(){if(!this.$button.hasClass("redactor-button-disabled")&&!this.$button.hasClass("redactor-button-active")){this.created=!0,this.parse("<span>"),this.addClass("re-button-tooltip"),this.toolbar.getWrapper(),this.$body.append(this),this.html(this.$button.attr("alt"));var t=this.$button.offset(),e=this.$button.height(),i=this.$button.width();this.css({top:t.top+e+4+"px",left:t.left+i/2-this.width()/2+"px",position:"absolute"}),this.show()}},close:function(){this.created&&!this.$button.hasClass("redactor-button-disabled")&&(this.remove(),this.created=!1)},_init:function(){this.$button.on("mouseover",this.open.bind(this)),this.$button.on("mouseout",this.close.bind(this))}}),$R.add("class","toolbar.dropdown",{mixins:["dom"],init:function(t,e,i){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$doc=t.$doc,this.$body=t.$body,this.animate=t.animate,this.toolbar=t.toolbar,this.name=e,this.started=!1,this.items=i,this.$items=[]},toggle:function(t){this.started||this._build(),this.isOpened()&&this.isActive()?this.close(!1):this.open(t)},isOpened:function(){var t=this.$body.find(".redactor-dropdown-"+this.uuid+".open");return 0!==t.length&&t.attr("data-name")===this.name},isActive:function(){return 0!==this.$body.find("#redactor-dropdown-"+this.uuid+"-"+this.name+".open").length},getName:function(){return this.attr("data-name")},getItem:function(t){return this.$items[t]},getItemsByClass:function(t){var e=[];for(var i in this.$items)this.$items[i].hasClass(t)&&e.push(this.$items[i]);return e},open:function(t){this._closeAll(),this.$btn=this.toolbar.getButton(this.name),this.app.broadcast("dropdown.open",t,this,this.$btn),this.toolbar.setDropdown(this),this.show(),this.removeClass("redactor-animate-hide"),this.addClass("open"),this._observe(),this.$btn.hideTooltip(),this.$btn.setActive(),this.$doc.on("keyup.redactor.dropdown-"+this.uuid,this._handleKeyboard.bind(this)),this.$doc.on("click.redactor.dropdown-"+this.uuid+" touchstart.redactor.dropdown-"+this.uuid,this.close.bind(this)),this.updatePosition(),this.app.broadcast("dropdown.opened",t,this,this.$btn)},close:function(t,e){if(t){var i=$R.dom(t.target);if(this._isButton(t)||i.hasClass("redactor-dropdown-not-close")||i.hasClass("redactor-dropdown-item-disabled"))return void t.preventDefault()}this.app.broadcast("dropdown.close",this,this.$btn),this.toolbar.setDropdown(!1),this.$btn.setInactive(),!1===e?this._close():this.animate.start(this,"fadeOut",this._close.bind(this))},updatePosition:function(){var t=this.toolbar.isFixed(),e=this.$btn.offset();e.top=t?this.$btn.position().top:e.top;var i=this.$btn.height();this.css({position:t?"fixed":"absolute",top:e.top+i+2+"px",left:e.left+0+"px"})},_build:function(){this.parse("<div>"),this.attr("id","redactor-dropdown-"+this.uuid+"-"+this.name),this.attr("data-name",this.name),this.addClass("redactor-dropdown redactor-dropdown-"+this.uuid+" redactor-dropdown-"+this.name),this.dataset("data-dropdown-instance",this),this.items.dom||"string"==typeof this.items?this._buildDom():this._buildItems(),this.$body.append(this),this.started=!0},_buildDom:function(){this.html("").append($R.dom(this.items))},_buildItems:function(){for(var t in this.items="format"===this.name?this._buildFormattingItems():this.items,this.items){var e=this.items[t];if("observe"===t)this.attr("data-observe",this.items[t]);else{var i=$R.create("toolbar.dropdown.item",this.app,t,e,this);this.$items[t]=i,this.append(i)}}},_buildFormattingItems:function(){for(var t in this.items)-1===this.opts.formatting.indexOf(t)&&delete this.items[t];if(this.opts.formattingHide)for(var t in this.items)-1!==this.opts.formattingHide.indexOf(t)&&delete this.items[t];if(this.opts.formattingAdd)for(var t in this.opts.formattingAdd)this.items[t]=this.opts.formattingAdd[t];return this.items},_handleKeyboard:function(t){27===t.which&&this.close()},_isButton:function(t){return $R.dom(t.target).closest(".re-button").get()===this.$btn.get()},_close:function(){this.$btn.setInactive(),this.$doc.off(".redactor.dropdown-"+this.uuid),this.removeClass("open"),this.addClass("redactor-animate-hide"),this.app.broadcast("dropdown.closed",this,this.$btn)},_closeAll:function(){this.$body.find(".redactor-dropdown-"+this.uuid+".open").each(function(t){$R.dom(t).dataget("data-dropdown-instance")._close()})},_observe:function(){var t=this.attr("data-observe");t&&this.app.broadcast("dropdown."+t+".observe",this)}}),$R.add("class","toolbar.dropdown.item",{mixins:["dom"],init:function(t,e,i,n){this.app=t,this.lang=t.lang,this.dropdown=n,this.name=e,this.obj=i,this._init()},setTitle:function(t){this.$span.html(t)},getTitle:function(){return this.$span.html()},enable:function(){this.removeClass("redactor-dropdown-item-disabled")},disable:function(){this.addClass("redactor-dropdown-item-disabled")},toggle:function(t){t&&t.preventDefault(),this.hasClass("redactor-dropdown-item-disabled")||(this.obj.message?this.app.broadcast(this.obj.message,this.obj.args,this.name):this.obj.api&&this.app.api(this.obj.api,this.obj.args,this.name))},_init:function(){this.parse("<a>"),this.attr("href","#"),this.addClass("redactor-dropdown-item-"+this.name),this.obj.classname&&this.addClass(this.obj.classname),this.attr("data-name",this.name),this.on("click",this.toggle.bind(this)),this.$span=$R.dom("<span>"),this.append(this.$span),this.setTitle(this.lang.parse(this.obj.title))}}),$R.add("service","cleaner",{init:function(t){this.app=t,this.opts=t.opts,this.storedComponents=[],this.deniedTags=["font","html","head","link","title","body","meta","applet"],this.reComments=/<!--[\s\S]*?-->/gi,this.reSpacedEmpty=/^(||\s||<br\s?\/?>||&nbsp;)$/i,this.reScriptTag=/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,this.reBreaklineLast="<br\\s?/?>(\\s|\\n)?</("+this.opts.blockTags.join("|")+")>"},input:function(t){return t=this.encodePreCode(t),t=$R.create("cleaner.figure",this.app).convert(t),this.opts.breakline&&(t=t.replace(/<br\s?\/?>\n/gi,"\n"),t=this._replaceNlToBr(t)),t=this.storeComponents(t),t=this.replaceTags(t,this.opts.replaceTags),t=this._setSpanAttr(t),t=this._setStyleCache(t),t=this.removeTags(t,this.deniedTags),t=this._removeLastBlockBreaklineInHtml(t),t=this.opts.removeScript?this._removeScriptTag(t):this._replaceScriptTag(t),t=this.opts.removeComments?this.removeComments(t):t,t=this._isSpacedEmpty(t)?this.opts.emptyHtml:t,t=this.restoreComponents(t),this._cleanWrapped(t)},output:function(t,e){return t=this.removeInvisibleSpaces(t),this._isSpacedEmpty(t)?"":(t=this.removeServiceTagsAndAttrs(t,e),t=this.storeComponents(t),t=this.removeSpanWithoutAttributes(t),t=this.removeFirstBlockBreaklineInHtml(t),t=this.removeLastBlockBreaklineInHtml(t),t=this.opts.removeScript?t:this._unreplaceScriptTag(t),t=this.opts.preClass?this._setPreClass(t):t,t=this.opts.linkNofollow?this._setLinkNofollow(t):t,t=this.opts.removeNewLines?this.cleanNewLines(t):t,t=this.restoreComponents(t),t=$R.create("cleaner.figure",this.app).unconvert(t),t=this.removeEmptyAttributes(t,["style","class","rel","alt","title"]),t=this.cleanSpacesInPre(t),t=this.tidy(t))},paste:function(t){var e=this.deniedTags.concat(["iframe"]);t=(t=(t=this.removeTags(t,e)).replace(new RegExp("<!doctype([\\s\\S]+?)>","gi"),"")).replace(new RegExp("<style([\\s\\S]+?)</style>","gi"),"");var i=this._isHtmlMsWord(t);if(t=this._cleanGDocs(t),t=i?this._cleanMsWord(t):t,!this.opts.pasteClean)return t;if(this.opts.pastePlainText)return this.pastePlainText(t);var n=this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);t=this.removeTagsExcept(t,n),t=this.opts.pasteLinks?t:this.removeTags(t,["a"]),t=this.opts.pasteImages?t:this.removeTags(t,["img"]);var s=this._buildWrapper(t),r=s.find("*"),o=0!==this.opts.pasteKeepStyle.length?","+this.opts.pasteKeepStyle.join(","):"";r.not("[data-redactor-style-cache]"+o).removeAttr("style");var a=0!==this.opts.pasteKeepClass.length?","+this.opts.pasteKeepClass.join(","):"";r.not("[data-redactor-style-cache]"+a).removeAttr("class");var l=0!==this.opts.pasteKeepAttrs.length?","+this.opts.pasteKeepAttrs.join(","):"";return r.not("img, a, [data-redactor-style-cache]"+l).each(function(t){for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name)}),this.opts.pasteLinks&&!1!==this.opts.pasteLinkTarget&&s.find("a").attr("target",this.opts.pasteLinkTarget),s.find("[data-redactor-style-cache]").each(function(t){var e=t.getAttribute("data-redactor-style-cache");t.setAttribute("style",e)}),s.find("span").each(function(t){0===t.attributes.length&&$R.dom(t).unwrap()}),s.find(this.opts.inlineTags.join(",")).each((function(t){0===t.attributes.length&&this.utils.isEmptyHtml(t.innerHTML)&&$R.dom(t).unwrap()}).bind(this)),s.find("ul, ol").each(function(t){var e=t.previousSibling;if(e&&"LI"===e.tagName){var i=$R.dom(e);i.find("p").unwrap(),i.append(t)}}),t=(t=(t=(t=(t=this._getWrapperHtml(s)).replace(/<li><p>/gi,"<li>")).replace(/<\/p><\/li>/gi,"</li>")).replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>"),i&&(t=(t=t.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")),t},pastePlainText:function(t){return t=this.opts.pasteLinks?this.storeLinks(t):t,t=this.opts.pasteImages?this.storeImages(t):t,t=this.getPlainText(t),t=this.replaceNlToBr(t),t=this.element.isType("inline")?this.removeBr(t):t,t=this.opts.pasteLinks?this.restoreLinks(t):t,this.opts.pasteImages?this.restoreImages(t):t},tidy:function(t){return t},paragraphize:function(t){return $R.create("cleaner.paragraphize",this.app).convert(t)},getFlatText:function(t){var e=$R.dom("<div>");return t.nodeType||t.dom?e.append(t):(t=(t=t.toString()).trim(),e.html(t)),void 0===(t=e.get().textContent||e.get().innerText||"")?"":t},replaceTags:function(t,e){if(e){var i=this,n=Object.keys(e),s=this._buildWrapper(t);s.find(n.join(",")).each(function(t){i.utils.replaceToTag(t,e[t.tagName.toLowerCase()])}),t=this._getWrapperHtml(s)}return t},replaceNbspToSpaces:function(t){return t.replace("&nbsp;"," ")},replaceBlocksToBr:function(t){return t.replace(/<\/div>|<\/li>|<\/td>|<\/p>|<\/H[1-6]>/gi,"<br>")},cleanNewLines:function(t){return t.replace(/\r?\n/g,"")},cleanSpacesInPre:function(t){return t.replace("&nbsp;&nbsp;&nbsp;&nbsp;","    ")},removeInvisibleSpaces:function(t){return(t=t.replace(/\u200B/g,"")).replace(/&#x200b;/gi,"")},removeNl:function(t){return(t=t.replace(/\n/g," ")).replace(/\s{2,}/g,"s")},removeBrAtEnd:function(t){return(t=t.replace(/<br\s?\/?>$/gi," ")).replace(/<br\s?\/?><li/gi,"<li")},removeTags:function(t,e){return t.replace(e?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,e?function(t,i){return-1===e.indexOf(i.toLowerCase())?t:""}:"")},removeTagsExcept:function(t,e){return void 0===e?t.replace(/(<([^>]+)>)/gi,""):t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,i){return-1===e.indexOf(i.toLowerCase())?"":t})},removeComments:function(t){return t.replace(this.reComments,"")},removeServiceTagsAndAttrs:function(t,e){var i=this._buildWrapper(t);return!1!==e&&i.find(".redactor-selection-marker").each(function(t){var e=$R.dom(t);return""===e.text().replace(/\u200B/g,"")?e.remove():e.unwrap()}),i.find("[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),this._getWrapperHtml(i)},removeSpanWithoutAttributes:function(t){var e=this._buildWrapper(t);return e.find("span").removeAttr("data-redactor-span data-redactor-style-cache").each(function(t){0===t.attributes.length&&$R.dom(t).unwrap()}),this._getWrapperHtml(e)},removeFirstBlockBreaklineInHtml:function(t){return t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")},removeLastBlockBreaklineInHtml:function(t){return t.replace(new RegExp(this.reBreaklineLast,"gi"),"</$2>")},removeEmptyAttributes:function(t,e){for(var i=this._buildWrapper(t),n=0;n<e.length;n++)i.find("["+e[n]+'=""]').removeAttr(e[n]);return this._getWrapperHtml(i)},encodeHtml:function(t){return t=(t=(t=(t=(t=(t=t.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," ")).replace(/\u201d/g,'"')).replace(/\u201c/g,'"')).replace(/\u2018/g,"'")).replace(/\u2019/g,"'"),t=(t=this.encodeEntities(t)).replace(/\$/g,"&#36;"),this.opts.preSpaces&&(t=t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),t},encodePreCode:function(t){var e=t.match(new RegExp("<code(.*?)>(.*?)<pre(.*?)>(.*?)</pre>(.*?)</code>","gi"));if(null!==e)for(var i=0;i<e.length;i++){var n=e[i].match(new RegExp("<pre(.*?)>([\\w\\W]*?)</pre>","i"));t=t.replace(n[0],this.encodeEntities(n[0]))}var s=this._buildWrapper(t);return s.find("code code").replaceWith(this._encodeOuter.bind(this)),s.find("code pre").replaceWith(this._encodeOuter.bind(this)),s.find("pre pre").replaceWith(this._encodeOuter.bind(this)),s.find("code, pre").each(this._encodePreCodeLine.bind(this)),t=this._getWrapperHtml(s),this._decodeMarkers(t)},encodeEntities:function(t){return(t=this.decodeEntities(t)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodePhpCode:function(t){return(t=(t=t.replace("<?php","&lt;?php")).replace("<?","&lt;?")).replace("?>","?&gt;")},decodeEntities:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},storeComponents:function(t){this.storedComponents=[];var e=t.match(/<figure(.*?)>([\w\W]*?)<\/figure>/gi);if(e)for(var i=0;i<e.length;i++)this.storedComponents[i]=e[i],t=t.replace(e[i],"####figure"+i+"####");return t},restoreComponents:function(t){if(this.storedComponents)for(var e=0;e<this.storedComponents.length;e++)t=t.replace("####figure"+e+"####",this.storedComponents[e]);return t},_cleanWrapped:function(t){return(t=(t=t.replace(new RegExp("<p><figure([\\w\\W]*?)</figure></p>","gi"),"<figure$1</figure>")).replace(new RegExp("<figure([\\w\\W]*?)</figure>([^>]+)</p>","gi"),"</p><figure$1</figure><p>$2<p>")).replace(new RegExp("<figure([\\w\\W]*?)</figure></p>","gi"),"</p><figure$1</figure>")},_cleanGDocs:function(t){return(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")},_cleanMsWord:function(t){return(t=(t=(t=(t=(t=(t=t.replace(/<o:p[^>]*>/gi,"")).replace(/<\/o:p>/gi,"")).replace(/<!--[\s\S]*?-->/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"")).replace(/>&nbsp;<\/p>/gi,"></p>")).replace(/<p[^>]*><\/p>/gi,"")).replace(/\n/g," ")},_isSpacedEmpty:function(t){return-1!==t.search(this.reSpacedEmpty)},_isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_setSpanAttr:function(t){var e=this._buildWrapper(t);return e.find("span").attr("data-redactor-span",!0),this._getWrapperHtml(e)},_setStyleCache:function(t){var e=this._buildWrapper(t);return e.find("[style]").each(function(t){var e=$R.dom(t);e.attr("data-redactor-style-cache",e.attr("style"))}),this._getWrapperHtml(e)},_setPreClass:function(t){var e=this._buildWrapper(t);return e.find("pre").addClass(this.opts.preClass),this._getWrapperHtml(e)},_setLinkNofollow:function(t){var e=this._buildWrapper(t);return e.find("a").attr("rel","nofollow"),this._getWrapperHtml(e)},_replaceScriptTag:function(t){return t.replace(this.reScriptTag,'<pre class="redactor-script-tag" $1>$2</pre>')},_unreplaceScriptTag:function(t){return t.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>")},_replaceBrToNl:function(t){return t.replace(/<br\s?\/?>/gi,"\n")},_replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},_removeLastBlockBreaklineInHtml:function(t){return t.replace(new RegExp(this.reBreaklineLast,"gi"),"</$2>")},_removeScriptTag:function(t){return t.replace(this.reScriptTag,"")},_buildWrapper:function(t){return $R.dom("<div>").html(t)},_getWrapperHtml:function(t){var e=t.html();return t.remove(),e},_decodeMarkers:function(t){return t.replace(/&lt;span id="selection-marker-(start|end)" class="redactor-selection-marker"&gt;\u200b&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">\u200b</span>')},_encodeOuter:function(t){return this.encodeEntities(t.outerHTML)},_encodePreCodeLine:function(t){var e=t.firstChild;if("PRE"!=t.tagName||!e||"CODE"!==e.tagName){var i=this.decodeEntities(t.innerHTML);i=i.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,"\n"),i=this.opts.preSpaces?i.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" ")):i,t.textContent=i}}}),$R.add("class","cleaner.figure",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils},convert:function(t){var e=this._buildWrapper(t);return e.find("img").each(this._convertImage.bind(this)),e.find("hr").each(this._convertLine.bind(this)),e.find("form").each(this._convertForm.bind(this)),e.find("table").each(this._convertTable.bind(this)),e.find("iframe").each(this._convertIframe.bind(this)),e.find("figure pre").each(this._convertCode.bind(this)),e.find("[data-redactor-type=variable]").addClass("redactor-component"),e.find("figure").not(".redactor-component, .redactor-figure-code").each(this._convertWidget.bind(this)),e.find("figure pre").each(this._setContenteditableCode.bind(this)),e.find(".redactor-component, .non-editable").attr("contenteditable",!1),e.find("td, th, figcaption").attr("contenteditable",!0),e.find(".redactor-component, figcaption").attr("tabindex","-1"),this._getWrapperHtml(e)},unconvert:function(t){var e=this._buildWrapper(t);return e.find("th, td, figcaption, figure, pre, code, .redactor-component").removeAttr("contenteditable"),e.find("figcaption, figure, pre, code, .redactor-component").removeAttr("tabindex"),e.find("[data-redactor-type=variable]").removeClass("redactor-component"),e.find("figure[data-redactor-type=line]").unwrap(),e.find("figure[data-redactor-type=form]").each(this._unconvertForm.bind(this)),e.find("figure[data-redactor-type=image]").removeAttr("rel").each(this._unconvertImagesInLists.bind(this)),e.find(".non-editable").removeAttr("contenteditable"),e.find("figure").removeClass("redactor-component redactor-component-active").each(this._removeTypes.bind(this)),e.find("span.redactor-component-caret").remove(),this._getWrapperHtml(e)},_convertImage:function(t){var e=$R.dom(t);if(!this._isNonEditable(e)){var i=e.closest("a"),n=e.closest("figure");0===n.children().not("a, img, br, figcaption").length&&(0===n.length&&(n=0!==i.length?i.wrap("<figure>"):e.wrap("<figure>")),this._setFigure(n,"image"))}},_convertLine:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"line")}},_convertForm:function(t){if(!this._isNonEditable(t)){var e=this.utils.replaceToTag(t,"figure");this._setFigure(e,"form")}},_convertTable:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"table")}},_convertIframe:function(t){if(!this._isNonEditable(t)){var e=t.getAttribute("src"),i=e&&(e.match(this.opts.regex.youtube)||e.match(this.opts.regex.vimeo)),n=this._wrapFigure(t);i&&this._setFigure(n,"video")}},_convertCode:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"code")}},_convertWidget:function(t){if(!this._isNonEditable(t)){var e=$R.dom(t);e.addClass("redactor-component"),e.attr("data-redactor-type","widget")}},_unconvertForm:function(t){this.utils.replaceToTag(t,"form")},_unconvertImagesInLists:function(t){var e=$R.dom(t);0!==e.closest("li").length&&e.unwrap()},_removeTypes:function(t){var e=t.getAttribute("data-redactor-type");e&&-1!==["image","widget","line","video","code","form","table"].indexOf(e)&&t.removeAttribute("data-redactor-type")},_wrapFigure:function(t){var e=$R.dom(t),i=e.closest("figure");return 0===i.length?e.wrap("<figure>"):i},_setFigure:function(t,e){t.addClass("redactor-component"),t.attr("data-redactor-type",e)},_setContenteditableCode:function(t){if(!this._isNonEditable(t)){var e=$R.dom(t),i=e.children("code").first();(0!==i.length?i:e).attr("contenteditable",!0).attr("tabindex","-1")}},_isNonEditable:function(t){return 0!==$R.dom(t).closest(".non-editable").length},_buildWrapper:function(t){return $R.dom("<div>").html(t)},_getWrapperHtml:function(t){var e=t.html();return t.remove(),e}}),$R.add("class","cleaner.paragraphize",{init:function(t){this.app=t,this.opts=t.opts,this.element=t.element,this.paragraphizeTags=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"]},convert:function(t){if(!0===this.opts.breakline||!1===this.opts.paragraphize||this.element.isType("inline"))return t;if(this._isEmptyHtml(t))return this.opts.emptyHtml;var e=[],i=this.opts.markup,n=this._buildWrapper(t);n.find(this.paragraphizeTags.join(", ")).each(function(t,i){var n=document.createTextNode("#####replace"+i+"#####\n\n");e.push(t.outerHTML),t.parentNode.replaceChild(n,t)}),t=(t=(t=(t=(t=(t=(t="<"+i+">"+(t=(t=(t=(t=(t=(t=(t=(t=(t=this._getWrapperHtml(n)).replace("<br>","\n")).replace(/\r\n/g,"xparagraphmarkerz")).replace(/\n/g,"xparagraphmarkerz")).replace(/\r/g,"xparagraphmarkerz")).replace(/\s+/g," ")).trim()).replace(/xparagraphmarkerzxparagraphmarkerz/gi,"</"+i+"><"+i+">")).replace(/xparagraphmarkerz/gi,"<br>"))+"</"+i+">").replace(new RegExp("<br\\s?/?></"+i+">","gi"),"</"+i+">")).replace(new RegExp("<"+i+"><br\\s?/?>","gi"),"<"+i+">")).replace(new RegExp("<br\\s?/?><"+i+">","gi"),"<"+i+">")).replace(new RegExp("<"+i+"></"+i+">$","gi"),"")).replace(new RegExp("<p>#####replace(.*?)#####</p>","gi"),"#####replace$1#####")).replace(new RegExp("<p>(.*?)#####replace(.*?)#####\\s?</p>","gi"),"<p>$1</p>#####replace$2#####");for(var s=0;s<e.length;s++)t=t.replace("#####replace"+s+"#####",e[s]);return t},_isEmptyHtml:function(t){return""===t||"<p></p>"===t||"<div></div>"===t},_buildWrapper:function(t){return $R.dom("<div>").html(t)},_getWrapperHtml:function(t){var e=t.html();return t.remove(),e}}),$R.add("service","detector",{init:function(t){this.app=t,this.userAgent=navigator.userAgent.toLowerCase()},isWebkit:function(){return/webkit/.test(this.userAgent)},isFirefox:function(){return this.userAgent.indexOf("firefox")>-1},isIe:function(t){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((e=RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent))||(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),e);var e},isMobile:function(){return/(iPhone|iPod|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}),$R.add("service","offset",{init:function(t){this.app=t,this.saved=!1},get:function(t,e,i){var n=this.editor.getElement(),s=void 0===t||t===n.get(),r=s?n.get():$R.dom(t).get(),o=!!s||this.selection.isIn(r);return!!(r&&this.selection.is()&&o)&&(e?this._getTrimmedOffset(r,s,i):this._getOffset(r))},set:function(t,e){if(e){var i=this.inspector.parse(e);if(i.isComponent()&&!i.isComponentEditable())return this.component.setActive(e)}this.editor.focus();var n=this.editor.getElement(),s="undefined"==typeof e,r=s?n.get():$R.dom(e).get();s&&this.editor.disableNonEditables(),t.end=void 0===t.end?t.start:t.end,this._setOffset(r,t.start,t.end),s&&this.editor.enableNonEditables()},_setOffset:function(t,e,i){var n=0,s=document.createRange();s.setStart(t,0),s.collapse(!0);for(var r,o=[t],a=!1,l=!1;!l&&(r=o.pop());)if(3===r.nodeType){var u=n+r.length;!a&&e>=n&&e<=u&&(s.setStart(r,e-n),a=!0),a&&i>=n&&i<=u&&(s.setEnd(r,i-n),l=!0),n=u}else for(var h=r.childNodes.length;h--;)o.push(r.childNodes[h]);this.selection.setRange(s)},_getOffset:function(t){var e=!1,i=t.ownerDocument||t.document,n=i.defaultView||i.parentWindow;if(n.getSelection().rangeCount>0){var s=n.getSelection().getRangeAt(0),r=s.toString().length,o=s.cloneRange();o.selectNodeContents(t),o.setEnd(s.endContainer,s.endOffset);var a=o.toString().length;e={start:a-r,end:a}}return e},_getTrimmedOffset:function(t,e,i){var n,s=t.ownerDocument||t.document,r=s.defaultView||s.parentWindow,o=(r.getSelection(),r.getSelection().getRangeAt(0)),a=o.toString().length,l=o.cloneRange();l.selectNodeContents(t),!0!==i&&l.setEnd(o.endContainer,o.endOffset),n=l.toString().replace(/[\u200B-\u200D\uFEFF]/g,"").length;for(var u=this._getOffsetWalker(o,a,t,i),h=0;u.nextNode();)h++;!e&&i&&h>0&&h--;var c=n+h;return i?c:{start:c-a,end:c}},_getOffsetWalker:function(t,e,i,n){var s=["br","hr","img","iframe","source","embed","input","param","track"];return document.createTreeWalker(i,NodeFilter.SHOW_ALL,function(i){var r=document.createRange();return r.selectNode(i),3!==i.nodeType&&0===e&&-1!==s.indexOf(i.tagName.toLowerCase())?n?NodeFilter.FILTER_ACCEPT:r.compareBoundaryPoints(Range.END_TO_END,t)<1?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT:NodeFilter.FILTER_REJECT},!1)}}),$R.add("service","inspector",{init:function(t){this.app=t},parse:function(t){return $R.create("inspector.parser",this.app,this,t)},isText:function(t){if("string"==typeof t&&!/^\s*<(\w+|!)[^>]*>/.test(t))return!0;var e=$R.dom(t).get();return e&&3===e.nodeType},isInlineTag:function(t,e){var i=this._extendTags(this.opts.inlineTags,e);return this._isTag(t)&&-1!==i.indexOf(t.toLowerCase())},isBlockTag:function(t,e){var i=this._extendTags(this.opts.blockTags,e);return this._isTag(t)&&-1!==i.indexOf(t.toLowerCase())},isTableCellTag:function(t){return-1!==["td","th"].indexOf(t.toLowerCase())},isHeadingTag:function(t){return-1!==["h1","h2","h3","h4","h5","h6"].indexOf(t.toLowerCase())},_isTag:function(t){return void 0!==t&&t},_extendTags:function(t,e){if(t=t.concat(t),e)for(var i=0;i<e.length;i++)t.push(e[i]);return t}}),$R.add("class","inspector.parser",{init:function(t,e,i){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.editor=t.editor,this.selection=t.selection,this.inspector=e,this.el=i,this.$el=$R.dom(this.el),this.node=this.$el.get(),this.$component=this.$el.closest(".redactor-component")},isEditor:function(){return this.node===this.editor.getElement().get()},isInEditor:function(){return 0!==this.$el.parents(".redactor-in-"+this.uuid).length},isComponent:function(){return 0!==this.$component.length},isComponentType:function(t){return this.getComponentType()===t},isComponentActive:function(){return this.isComponent()&&this.$component.hasClass("redactor-component-active")},isComponentEditable:function(){var t=this.getComponentType();return this.isComponent()&&-1!==["code","table"].indexOf(t)},isFigcaption:function(){return this.getFigcaption()},isPre:function(){return this.getPre()},isCode:function(){var t=this.$el.closest("code"),e=t.parent("pre");return 0!==t.length&&0===e.length},isList:function(){return this.getList()},isFirstListItem:function(){return this._getLastOrFirstListItem("first")},isLastListItem:function(){return this._getLastOrFirstListItem("last")},isFirstTableCell:function(){return this._getLastOrFirstTableCell("first")},isLastTableCell:function(){return this._getLastOrFirstTableCell("last")},isTable:function(){return this.isComponentType("table")||this.getTable()},isHeading:function(){return this.getHeading()},isBlockquote:function(){return this.getBlockquote()},isDl:function(){return this.getDl()},isParagraph:function(){return this.getParagraph()},isLink:function(){return this.getLink()},isFile:function(){return this.getFile()},isText:function(){return this.inspector.isText(this.el)},isInline:function(){var t=this.opts.inlineTags;return!!this.isElement()&&-1!==t.indexOf(this.node.tagName.toLowerCase())},isBlock:function(){var t=this.opts.blockTags;return!!this.isElement()&&-1!==t.indexOf(this.node.tagName.toLowerCase())},isElement:function(){return this.node&&this.node.nodeType&&3!==this.node.nodeType},hasParent:function(t){return 0!==this.$el.closest(t.join(",")).length},getNode:function(){return this.node},getTag:function(){return!!this.isElement()&&this.node.tagName.toLowerCase()},getComponent:function(){return!!this.isComponent()&&this.$component.get()},getComponentType:function(){return!!this.isComponent()&&this.$component.attr("data-redactor-type")},getFirstNode:function(){return this.utils.getFirstNode(this.node)},getLastNode:function(){return this.utils.getLastNode(this.node)},getFirstElement:function(){return this.utils.getFirstElement(this.node)},getLastElement:function(){return this.utils.getLastElement(this.node)},getFigcaption:function(){return this._getClosestNode("figcaption")},getPre:function(){return this._getClosestNode("pre")},getCode:function(){return this._getClosestNode("code")},getList:function(){return this._getClosestNode("ul, ol")},getListItem:function(){return this._getClosestNode("li")},getTable:function(){return this.getComponentType("table")?this.$component.find("table").get():this._getClosestNode("table")},getTableCell:function(){var t=this.$el.closest("td, th");return 0!==t.length&&t.get()},getComponentCodeElement:function(){return!!this.isComponentType("code")&&this.$component.find("pre code, pre").last().get()},getImageElement:function(){return!!this.isComponentType("image")&&this.$component.find("img").get()},getParagraph:function(){return this._getClosestNode("p")},getHeading:function(){return this._getClosestNode("h1, h2, h3, h4, h5, h6")},getDl:function(){return this._getClosestNode("dl")},getBlockquote:function(){return this._getClosestNode("blockquote")},getLink:function(){var t=this.isComponent();if(this.isComponentType("table")||!t){var e=this._getClosestElement("a");return!(!e||e.attr("data-file"))&&e.get()}return!1},getFile:function(){var t=this.isComponent();if(this.isComponentType("table")||!t){var e=this._getClosestElement("a");return!(!e||!e.attr("data-file"))&&e.get()}return!1},findFirstNode:function(t){return this.$el.find(t).first().get()},findLastNode:function(t){return this.$el.find(t).last().get()},_getLastOrFirstListItem:function(t){var e=this.getList(),i=this.getTag();if(e&&"li"===i){var n=$R.dom(e).find("li")[t]().get();if(n&&this.node===n)return!0}return!1},_getLastOrFirstTableCell:function(t){var e=this.getTable(),i=this.getTag();if(e&&("td"===i||"th"===i)){var n=$R.dom(e).find("td, th")[t]().get();if(n&&this.node===n)return!0}return!1},_getClosestNode:function(t){var e=this.$el.closest(t);return 0!==e.length&&e.get()},_getClosestElement:function(t){var e=this.$el.closest(t);return 0!==e.length&&e}}),$R.add("service","marker",{init:function(t){this.app=t},build:function(t){var e=document.createElement("span");return e.id="selection-marker-"+this._getPos(t),e.className="redactor-selection-marker",e.innerHTML=this.opts.invisibleSpace,e},buildHtml:function(t){return this.build(t).outerHTML},insert:function(){if(!this.selection.isAll())return this.editor.focus(),this.selection.isCollapsed()?this.insertStart():this.insertBoth();var t=this.editor.getElement();t.prepend(this.build("start")),t.append(this.build("end"))},insertStart:function(){var t=this.selection.getRange();if(t){var e=this.build("start"),i=t.startContainer,n=t.startOffset,s=t.cloneRange();return s.setStart(i,n),s.collapse(!0),s.insertNode(e),e}},insertEnd:function(){var t=this.selection.getRange();if(t){var e=this.build("end"),i=t.cloneRange();return i.collapse(!1),i.insertNode(e),e}},insertBoth:function(){var t=this.selection.getRange();if(t){var e=this.build("start"),i=this.build("end"),n=t.startContainer,s=t.startOffset,r=t.cloneRange();r.collapse(!1),r.insertNode(i),r.setStart(n,s),r.collapse(!0),r.insertNode(e)}},find:function(t,e){var i=this.editor.getElement(),n=(e||i).find("span#selection-marker-"+this._getPos(t));return 0!==n.length&&n.get()},remove:function(){var t=this.find("start"),e=this.find("end");if(t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e),t||e){var i=this.selection.getElement();this.utils.normalizeTextNodes(i)}},_getPos:function(t){return void 0===t?"start":t}}),$R.add("service","component",{init:function(t){this.app=t,this.activeClass="redactor-component-active"},create:function(t,e){return $R.create(t+".component",this.app,e)},build:function(t){var e,i=$R.dom(t).attr("data-redactor-type");return i&&(e=this.create(i,t)),e||t},remove:function(t,e){var i=$R.dom(t).closest(".redactor-component"),n=i.attr("data-redactor-type"),s=this._findSiblings(i,"previousSibling"),r=this._findSiblings(i,"nextSibling");!1!==this.app.broadcast(n+".delete",i)&&(i.remove(),this.app.broadcast(n+".deleted",i),this.app.broadcast("contextbar.close"),this.app.broadcast("imageresizer.stop"),!1!==e&&(r?this.caret.setStart(r):s?this.caret.setEnd(s):this.editor.startFocus()))},isActive:function(t){return t?$R.dom(t).hasClass(this.activeClass):0!==this._find().length},getActive:function(){var t=this._find();return 0!==t.length&&t.get()},setActive:function(t){this.clearActive(),this.editor.focus();var e=this.inspector.parse(t),i=e.getComponent(),n=$R.dom(i);if(!e.isFigcaption()){var s=n.find(".redactor-component-caret");0===s.length&&(s=this._buildCaret(),n.prepend(s)),this.caret.setAtStart(s.get())}n.addClass(this.activeClass)},clearActive:function(){this._find().removeClass(this.activeClass)},setOnEvent:function(t,e){this.clearActive();var i=this.inspector.parse(t.target);i.isFigcaption()||i.isComponentEditable()||i.isComponent()&&(this.setActive(t.target),!0!==e&&t.preventDefault())},executeScripts:function(){for(var $editor=this.editor.getElement(),scripts=$editor.find("[data-redactor-type]").find("script").getAll(),i=0;i<scripts.length;i++)if(""!=scripts[i].src){var src=scripts[i].src;this.$doc.find('head script[src="'+src+'"]').remove();var tag=document.createElement("script");tag.src=src,document.getElementsByTagName("head")[0].appendChild(tag)}else eval(scripts[i].innerHTML)},_find:function(){return this.editor.getElement().find("."+this.activeClass)},_findSiblings:function(t,e){for(var i=t.get();i=i[e];){var n=!1;if(3!==i.nodeType||this.opts.breakline||(n=""===i.textContent.trim()),!n&&"BR"!==i.tagName)return i}},_buildCaret:function(){var t=$R.dom("<span>");return t.addClass("redactor-component-caret"),t.attr("contenteditable",!0),t}}),$R.add("service","insertion",{init:function(t){this.app=t},set:function(t,e){return t=!1!==e?this.cleaner.input(t):t,t=!1!==e?this.cleaner.paragraphize(t):t,this.editor.getElement().html(t),this.editor.endFocus(),t},insertNode:function(t,e){this.editor.focus();var i=this.utils.isFragment(t)?t:this.utils.createFragment(t);return this._collapseSelection(),this._insertFragment(i),this._setCaret(e,i),this._sendNodes(i.nodes)},insertBreakLine:function(){return this.insertNode(document.createElement("br"),"after")},insertNewline:function(){return this.insertNode(document.createTextNode("\n"),"after")},insertText:function(t){return this.insertHtml(this.cleaner.getFlatText(t))},insertChar:function(t){return this.insertNode(t,"after")},insertRaw:function(t){return this.insertHtml(t,!1)},insertToPoint:function(t,e){var i,n=this.marker.build("start"),s=!1,r=t.clientX,o=t.clientY;if(document.caretPositionFromPoint){var a=document.caretPositionFromPoint(r,o),l=document.getSelection();this.inspector.parse(a.offsetNode).isInEditor()&&((i=l.getRangeAt(0)).setStart(a.offsetNode,a.offset),i.collapse(!0),i.insertNode(n),s=!0)}else document.caretRangeFromPoint&&(i=document.caretRangeFromPoint(r,o),this.inspector.parse(i.startContainer).isInEditor()&&(i.insertNode(n),s=!0));return s?(this.component.clearActive(),this.selection.restoreMarkers(),this.insertHtml(e)):[]},insertToOffset:function(t,e){return this.offset.set({start:t,end:t}),this.insertHtml(e)},insertHtml:function(t,e){if(this.opts.input){var i=this.utils.parseHtml(t);if(this.selection.isAll())return this._insertToAllSelected(i);var n=this.selection.isCollapsed(),s=this.selection.isText(),r=this._getCurrent(),o=this.inspector.parse(r);this._collapseSelection(),i=this._getCleanedInput(i,o,e);var a,l=this._isFigure(i.html),u=this._isComponentSpan(i.html),h=this.inspector.isText(i.html);if(this.editor.isEmpty())return this._insertToEmptyEditor(i.html);if(o.isComponent()&&!o.isComponentEditable())return this._insertToWidget(r,o,i.html);if(u)return this.insertNode(i.nodes,"end");if(l&&!s&&!o.isList()){if(o.isInline())return this._insertToInline(r,i);var c=this.utils.createFragment(i.html);return this._splitNode(r,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes)}if(o.isCode())return this._insertToCode(i,r,e);if(o.isPre())return this._insertToPre(i,e);if(o.isHeading()||o.isFigcaption())return i.html=!1!==e?this.cleaner.removeTagsExcept(i.html,["a"]):i.html,i.html=!1!==e?this.cleaner.replaceNbspToSpaces(i.html):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(h)return!s&&"br"!==this.opts.markup&&this._hasBlocksAndImages(i.nodes)?(i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this._splitNode(r,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes)):this.insertNode(i.nodes,"end");if(!n&&!l)return i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(o.isInline()&&!this._isPlainHtml(i.html))return this._insertToInline(r,i);if(o.isBlockquote()||o.isDl())return(a=this.opts.inlineTags).concat(["br"]),i.html=!1!==e?this.cleaner.replaceBlocksToBr(i.html):i.html,i.html=!1!==e?this.cleaner.removeTagsExcept(i.html,a):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(o.isParagraph())return this._isPlainHtml(i.html)?this.insertNode(i.nodes,"end"):(i.html=!1!==e?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this._splitNode(r,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes));if(o.isList()&&(a=(a=this.opts.inlineTags).concat(["br","li","ul","ol","img"]),i.html=!1!==e?this.cleaner.replaceBlocksToBr(i.html):i.html,i.html=!1!==e?this.cleaner.removeTagsExcept(i.html,a):i.html,i.html=!1!==e?this.cleaner.removeBrAtEnd(i.html):i.html,c=this.utils.createFragment(i.html),data.nodes=c.nodes,this._containsTags(i.html,["ul","ol","li"]))){var d=this.selection.getElement(r);return d&&"LI"===d.tagName&&this.caret.isStart(d)?(i.nodes=$R.dom(c.nodes).unwrap("ul, ol").getAll(),$R.dom(d).before(i.nodes),this.caret.setEnd(i.nodes[i.nodes.length-1]),this._sendNodes(i.nodes)):this._isPlainHtml(i.html)?this.insertNode(c,"end"):(c=this._buildList(i,d,c),this._splitNode(r,c,!0),this.caret.setEnd(c.last),this._sendNodes(c.nodes))}return this.insertNode(i.nodes,"end")}},_insertToAllSelected:function(t){var e=this.set(t.html),i=this.utils.parseHtml(e);return this._sendNodes(i.nodes)},_insertToEmptyEditor:function(t){t=this.cleaner.paragraphize(t);var e=this.utils.createFragment(t),i=this.editor.getElement();return i.html(""),i.append(e.frag),this.caret.setEnd(e.last),this._sendNodes(e.nodes)},_insertToInline:function(t,e){var i=this.utils.createFragment(e.html);return this._splitNode(t,i,!1,!0),this.caret.setEnd(i.last),this._sendNodes(i.nodes)},_insertToCode:function(t,e,i){t.html=!1!==i?this.cleaner.encodeHtml(t.html):t.html,t.html=!1!==i?this.cleaner.removeNl(t.html):t.html;var n=this.utils.createFragment(t.html),s=this.insertNode(n,"end");return this.utils.normalizeTextNodes(e),s},_insertToPre:function(t,e){t.html=!1!==e?this.cleaner.encodeHtml(t.html):t.html;var i=this.utils.createFragment(t.html);return this.insertNode(i,"end")},_insertToWidget:function(t,e,i){i=this._isComponentSpan(i)?i:this.cleaner.paragraphize(i);var n=this.utils.createFragment(i),s=e.getComponent(),r=$R.dom(s);return r.after(n.frag),r.remove(),this.caret.setEnd(n.last),this._sendNodes(n.nodes)},_insertFragment:function(t){var e=this.selection.getRange();e&&(e.deleteContents(),e.insertNode(t.frag))},_sendNodes:function(t){for(var e=0;e<t.length;e++){var i=t[e],n=3!==i.nodeType&&i.getAttribute("data-redactor-type");n&&this.app.broadcast(n+".inserted",this.component.build(i))}return this.app.broadcast("inserted",t),this.component.executeScripts(),t},_splitNode:function(t,e,i,n){e=this.utils.isFragment(e)?e.frag:e;var s=n?this.selection.getInline(t):this.selection.getBlock(t),r=$R.dom(s);if(!n&&this.utils.isEmptyHtml(s.innerHTML))return r.after(e),r.remove(),e;var o=r.get().tagName.toLowerCase(),a=this.caret.isEnd(s),l=this.caret.isStart(s);if(!a&&!l){var u=this._extractHtmlFromCaret(n),h=$R.dom("<"+o+" />");h=this.utils.cloneAttributes(s,h),r.after(h.append(u))}if(l)return r.before(e);if(i)return r.append(e);e=r.after(e);var c=r.html();return""===(c=(c=c.replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,""))&&r.remove(),e},_extractHtmlFromCaret:function(t,e){var i=this.selection.getRange();if(i&&(e=e||(t?this.selection.getInline():this.selection.getBlock()))){var n=i.cloneRange();return n.selectNodeContents(e),n.setStart(i.endContainer,i.endOffset),n.extractContents()}},_setCaret:function(t,e){var i=this._isLastInline(e);t?this.caret["set"+this.utils.ucfirst(t=i&&"end"===t?"after":t)](e.last):!1!==t&&i&&this.caret.setAfter(e.last)},_isLastInline:function(t){return!!t.last&&this.inspector.parse(t.last).isInline()},_getCleanedInput:function(t,e,i){var n=e.isCode()||e.isPre();return t.html=n||!1===i?t.html:this.cleaner.input(t.html),n||!1===i?t:this.utils.parseHtml(t.html)},_getCurrent:function(){var t=this.selection.getCurrent();return t||(this.editor.startFocus(),t=this.selection.getCurrent()),t},_getContainer:function(t){return $R.dom(this.utils.createTmpContainer(t))},_buildList:function(t,e,i){var n=t.nodes[0];if(n&&3!==n.nodeType&&"li"===n.tagName){var s=$R.dom(e).get().tagName.toLowerCase(),r=$R.dom("<"+s+" />");return r.append(i.nodes),this.utils.createFragment(r.get().outerHTML)}return i},_containsTags:function(t,e){return 0!==this._getContainer(t).find(e.join(",")).length},_collapseSelection:function(){},_hasFigureOrTable:function(t){return 0!==this._getContainer(t).find("figure, table").length},_hasBlocks:function(t){return 0!==this._getContainer(t).find(this.opts.blockTags.join(",")).length},_hasBlocksAndImages:function(t){return 0!==this._getContainer(t).find(this.opts.blockTags.join(",")+",img").length},_isPlainHtml:function(t){return 0===this._getContainer(t).find(this.opts.blockTags.join(",")+", img").length},_isFigure:function(t){if(this._isHtmlString(t))return 0!==$R.dom(t).closest("figure").length},_isComponentSpan:function(t){if(this._isHtmlString(t))return 0!==$R.dom(t).closest("span.redactor-component").length},_isHtmlString:function(t){return!("string"==typeof t&&!/^\s*<(\w+|!)[^>]*>/.test(t))}}),$R.add("service","block",{mixins:["formatter"],init:function(t){this.app=t},format:function(t){return this.type=t.type?t.type:"set",this.tag="string"==typeof t?t:t.tag,this.tag=this._prepareTag(this.tag),this.tag=this.tag.toLowerCase(),"string"==typeof t?this.args=!1:this.buildArgs(t),this._format()},getBlocks:function(t){return t?this.selection.getBlocks({tags:t,first:!0,cells:!0}):this.selection.getBlocksAndTextNodes({tags:this._getTags(),first:!0,cells:!0,wrap:!0})},getElements:function(t,e){return blocks=e?this.selection.getBlocks({tags:t||this._getTags(),first:!0,cells:!0}):this.getBlocks(t),$R.dom(blocks)},clearFormat:function(t){this.selection.save();var e=this.getElements(t||this._getTags());return e.each(function(t){for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name)}),this.selection.restore(),e.getAll()},_format:function(){this.selection.save();var t=this.getBlocks(),e=[];return t.length>0&&(e=this._replaceBlocks(t),e=this.applyArgs(e,!1),e=this._combinePre(e),e=this._cleanBlocks(e)),setTimeout((function(){this.selection.restore()}).bind(this),0),e},_prepareTag:function(t){return"undefined"==typeof t&&(t=this.opts.breakline?"div":this.opts.markup),t},_getTags:function(){return["div","p","blockquote","pre","h1","h2","h3","h4","h5","h6"]},_replaceBlocks:function(t){var e=[],i=this._isToggleFormatType(t)?"toggle":"set";if("br"===this.opts.markup)for(var n=0;n<t.length;n++)if(t[n]=this._clearWrapperClass(t[n]),"toggle"===i||"p"===this.tag){var s=document.createElement("br");(o=$R.dom(t[n])).append(s),o.unwrap()}else o=this.utils.replaceToTag(t[n],this.tag),e.push(o.get());else{var r="toggle"===i?this.opts.markup:this.tag;for(n=0;n<t.length;n++){t[n]=this._clearWrapperClass(t[n]);var o=this.utils.replaceToTag(t[n],r);e.push(o.get())}}return e},_isToggleFormatType:function(t){for(var e=0,i=t.length,n=0;n<i;n++)t[n]&&this.tag===t[n].tagName.toLowerCase()&&e++;return e===i},_combinePre:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i].nextElementSibling;if(n&&"PRE"===t[i].tagName&&"PRE"===n.tagName){var s=$R.dom(t[i]),r=$R.dom(n),o=document.createTextNode("\n");s.append(o),s.append(r),r.unwrap("pre")}e.push(t[i])}return e},_cleanBlocks:function(t){for(var e=["h1","h2","h3","h4","h5","h6"],i=this.opts.inlineTags,n=0;n<t.length;n++){var s=t[n].tagName.toLowerCase(),r=$R.dom(t[n]);-1!==e.indexOf(s)?r.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker").unwrap():"pre"===s&&r.find(i.join(",")).not(".redactor-selection-marker").unwrap(),this.utils.normalizeTextNodes(t[n])}return t}}),$R.add("service","inline",{mixins:["formatter"],init:function(t){this.app=t},format:function(t){return this._isFormat()?(this.type=t.type?t.type:"set",this.tag="string"==typeof t?t:t.tag,this.tag=this.tag.toLowerCase(),this.tag=this.arrangeTag(this.tag),"string"==typeof t?this.args=!1:this.buildArgs(t),this.selection.isCollapsed()?this.formatCollapsed():this.formatUncollapsed()):[]},_isFormat:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=e.isComponent()&&!e.isComponentType("table");return!(!t||e.isPre()||e.isCode()||e.isFigcaption()||i)},arrangeTag:function(t){var e=this.opts.replaceTags;for(var i in e)t===i&&(t=e[i]);return t},formatCollapsed:function(){var t=[],e=this.selection.getInlineFirst(),i=this.selection.getInlines({all:!0}),n=$R.dom(e);if(e){var s=this.inspector.parse(e);if(this.utils.isEmptyHtml(e.innerHTML))if(e.tagName.toLowerCase()===this.tag)if(this.hasSameArgs(e)){this.caret.setAfter(e),n.remove();var r=this.selection.getElement();this.utils.normalizeTextNodes(r)}else"span"===this.tag?(t=this.applyArgs([e],!1),this.caret.setStart(e)):t=this.insertInline(t);else if(s.hasParent([this.tag])){var o=(u=n.closest(this.tag)).get();this.hasSameArgs(o)?(u.unwrap(),this.caret.setStart(e)):t=this.insertInline(t)}else t=this.insertInline(t);else if(e.tagName.toLowerCase()===this.tag)if(this.hasSameArgs(e)){var a=this.insertion._extractHtmlFromCaret(e),l=$R.dom("<"+this.tag+" />");l=this.utils.cloneAttributes(e,l),n.after(l.append(a)),this.caret.setAfter(e)}else t=this.insertInline(t);else if(s.hasParent([this.tag])){var u;if(o=(u=n.closest(this.tag)).get(),this.hasSameArgs(o)){var h,c;a=this.insertion._extractHtmlFromCaret(o,o),l=$R.dom("<"+this.tag+" />"),l=this.utils.cloneAttributes(o,l);var d=0;i=i.reverse();for(var p=0;p<i.length;p++)i[p]!==o&&(c=$R.dom("<"+i[p].tagName.toLowerCase()+">"),0===d?h=c:h.append(c),d++);u.after(l.append(a)),u.after(h),this.caret.setStart(c)}else t=this.insertInline(t)}else t=this.insertInline(t)}else t=this.insertInline(t);return t},insertInline:function(t){var e=document.createElement(this.tag);return t=this.insertion.insertNode(e,"start"),this.applyArgs(t,!1)},hasSameArgs:function(t){if(0===t.attributes.length&&!1===this.args)return!0;var e=!0;if(this.args){var i=0;for(var n in this.args){var s=$R.dom(t),r=this.args[n],o=this.utils.toParams(r),a=s.attr(n);if(r)if("style"===n){o=o.trim().replace(/;$/,"");for(var l=this.utils.styleToObj(s.attr("style")),u=o.split(";"),h=0,c=0;c<u.length;c++){var d=u[c].split(":"),p=d[0].trim(),f=d[1].trim();if(-1!==p.search(/color/)){var m=s.css(p);!m||m!==f&&this.utils.rgb2hex(m)!==f||h++}else s.css(p)===f&&h++}h===u.length&&Object.keys(l).length===u.length&&i++}else a===o&&i++;else a&&""!==a||i++}e=i===Object.keys(this.args).length}return e},formatUncollapsed:function(){var t=this.selection.getInlines({all:!0,inside:!0});0===t.length?this.formatUncollapsedAllInlines():(this.selection.save(),this.convertToStrike(t),this.selection.restore()),document.execCommand("strikethrough"),this.editor.getElement().find(this.opts.inlineTags.join(",")).each(function(t){if("line-through"===t.style.textDecoration||"line-through"===t.style.textDecorationLine){var e=$R.dom(t);e.css("textDecorationLine",""),e.css("textDecoration",""),e.wrap("<strike>")}}),this.selection.save();var e=this.revertToInlines(t);return e=this.applyArgs(e,!1),this.selection.restore(),this.clearEmptyStyle(),this.normalizeBlocks(e)},formatUncollapsedAllInlines:function(){var t=this.selection.getInlines({all:!0});if(0!==t.length){this.selection.save();for(var e=[],i=0;i<t.length;i++){var n=t[i],s=n.tagName.toLowerCase(),r=$R.dom(n).closest(this.tag).get();r&&this.arrangeTag(r.tagName.toLowerCase())===this.tag&&this.hasSameArgs(r)&&-1===e.indexOf(r)&&e.push(r),"u"!==this.tag&&"u"===s&&(o=this.utils.replaceToTag(n,"span")).addClass("redactor-convertable-u"),"del"!==this.tag&&"del"===s&&(o=this.utils.replaceToTag(n,"span")).addClass("redactor-convertable-del")}for(i=0;i<e.length;i++){var o;(o=$R.dom(e[i])).replaceWith(function(t){return $R.dom("<strike>").append(o.contents())})}this.selection.restore()}},normalizeBlocks:function(t){var e=this.opts.inlineTags,i=this.selection.getBlocks();if(i)for(var n=0;n<i.length;n++)"PRE"===i[n].tagName&&$R.dom(i[n]).find(e.join(",")).not(".redactor-selection-marker").each((function(e){-1!==t.indexOf(e)&&(t=this.utils.removeFromArrayByValue(t,e)),$R.dom(e).unwrap()}).bind(this));return t},clearEmptyStyle:function(){for(var t=this.getInlines(),e=0;e<t.length;e++){this.clearEmptyStyleAttr(t[e]);var i=t[e].childNodes;if(i)for(var n=0;n<i.length;n++)this.clearEmptyStyleAttr(i[n])}},clearEmptyStyleAttr:function(t){3!==t.nodeType&&this.utils.removeEmptyAttr(t,"style")&&(t.removeAttribute("style"),t.removeAttribute("data-redactor-style-cache"))},convertToStrike:function(t){for(var e=0;e<t.length;e++){var i=this.arrangeTag(t[e].tagName.toLowerCase()),n=t[e],s=$R.dom(n);if(i===this.tag)if(this.hasSameArgs(n)){var r=$R.dom(n);r.replaceWith(function(t){return $R.dom("<strike>").append(r.contents())})}else"span"===this.tag&&s.addClass("redactor-convertable-apply");this.convertTags(n,i,"u"),this.convertTags(n,i,"del")}},revertToInlines:function(t){var e=[],i=this.editor.getElement();return i.find("u").unwrap(),i.find("span.redactor-convertable-apply").each((function(t){var i=$R.dom(t);i.removeClass("redactor-convertable-apply"),i.find("strike").unwrap(),this.utils.removeEmptyAttr(t,"class")&&i.removeAttr("class"),e.push(t)}).bind(this)),i.find("strike").each((function(t,i){var n=this.utils.replaceToTag(t,this.tag);e.push(n.get())}).bind(this)),this.revertTags("u"),this.revertTags("del"),e},convertTags:function(t,e,i){this.tag!==i&&e===i&&this.utils.replaceToTag(t,"span").addClass("redactor-convertable-"+i)},revertTags:function(t){this.editor.getElement().find("span.redactor-convertable-"+t).each((function(e){var i=this.utils.replaceToTag(e,t);i.removeClass("redactor-convertable-"+t),this.utils.removeEmptyAttr(i,"class")&&i.removeAttr("class")}).bind(this))},getInlines:function(t){return this.selection.getInlines(t?{tags:t,all:!0}:{all:!0})},getElements:function(t){return $R.dom(this.getInlines(t))},clearFormat:function(){this.selection.save();for(var t=this.selection.getInlines({all:!0}),e=0;e<t.length;e++){var i=$R.dom(t[e]);this.selection.getInline(t[e])&&i.unwrap()}this.selection.restore()}}),$R.add("service","autoparser",{init:function(t){this.app=t},format:function(t,e){this._isKey(e)&&this._format()},parse:function(t){var e=["figure","pre","code","a","iframe","img"],i=[],n=0;t=this.cleaner.encodePreCode(t);for(var s=0;s<e.length;s++){var r="img"===e[s]?"<"+e[s]+"[^>]*>":"<"+e[s]+"([\\w\\W]*?)</"+e[s]+">",o=t.match(new RegExp(r,"gi"));if(null!==o)for(var a=0;a<o.length;a++)t=t.replace(o[a],"#####replaceparse"+n+"#####"),i.push(o[a]),n++}if(this.opts.autoparseImages&&t.match(this.opts.regex.imageurl)){var l=t.match(this.opts.regex.imageurl);for(s=0;s<l.length;s++)t=t.replace(l[s],'<img src="'+l[s]+'">')}for(this.opts.autoparseVideo&&(t.match(this.opts.regex.youtube)||t.match(this.opts.regex.vimeo))&&(t.match(this.opts.regex.youtube)?(str="//www.youtube.com/embed/$1",r=this.opts.regex.youtube):t.match(this.opts.regex.vimeo)&&(str="//player.vimeo.com/video/$2",r=this.opts.regex.vimeo),t=t.replace(r,'<iframe width="500" height="281" src="'+str+'" frameborder="0" allowfullscreen></iframe>')),this.opts.autoparseLinks&&t.match(this.opts.regex.url)&&(t=this._formatLinks(t,!0)),s=0;s<i.length;s++)t=t.replace("#####replaceparse"+s+"#####",i[s]);return t},_isKey:function(t){return t===this.keycodes.ENTER||t===this.keycodes.SPACE},_format:function(){var t=this.selection.getParent(),e=$R.dom(t);if((!t||0===e.closest("figure, pre, code, img, a, iframe").length)&&this.selection.isCollapsed()){var i=document.createTextNode("\u200b");this.selection.getRange().insertNode(i);var n=this.selection.getElement(),s=this.selection.getCurrent(),r=this.inspector.parse(s),o=$R.dom(s);if(i.parentNode.removeChild(i),s&&3===s.nodeType){var a,l=s.textContent;if(this.opts.autoparseImages&&l.match(this._convertToRegExp(this.opts.regex.imageurl))){var u=r.isList(),h=l.match(this.opts.regex.imageurl),c=this.component.create("image",u?void 0:"<figure><img></figure>");c.setSrc(h[0]),c.addClass("redactor-autoparser-object"),l=l.replace(h[0],c.get().outerHTML),a="image"}else if(this.opts.autoparseVideo&&(l.match(this._convertToRegExp(this.opts.regex.youtube))||l.match(this._convertToRegExp(this.opts.regex.vimeo)))){var d,p;l.match(this.opts.regex.youtube)?(d="//www.youtube.com/embed/$1",p=this.opts.regex.youtube):l.match(this.opts.regex.vimeo)&&(d="//player.vimeo.com/video/$2",p=this.opts.regex.vimeo);var f=this.component.create("video",'<iframe width="500" height="281" src="'+d+'" frameborder="0" allowfullscreen></iframe>');f.addClass("redactor-autoparser-object"),l=l.replace(p,f.get().outerHTML),a="video"}else this.opts.autoparseLinks&&l.match(this._convertToRegExp(this.opts.regex.url))&&(l=this._formatLinks(l),a="link");if(a){o.replaceWith(l);var m=this.editor.getElement().find(".redactor-autoparser-object").removeClass("redactor-autoparser-object");if(m="link"===a?$R.create("link.component",this.app,m):m,"link"===a)this.caret.setAfter(m),this.app.broadcast("link.inserted",m);else{this.caret.setAfter(m);var g=m.clone();m.remove(),m=this.insertion.insertHtml(g),m=this.component.build(m)}this.app.broadcast("autoparse",a,m)}}this.utils.normalizeTextNodes(n)}},_formatLinks:function(t,e){for(var i=t.match(this.opts.regex.url),n=0;n<i.length;n++){var s=i[n],r=s,o=null!==s.match(/(https?|ftp):\/\//i)?"":"http://",a=-1!==["/","&","="].indexOf(s.slice(-1))?"":"\\b",l=!1!==this.opts.pasteLinkTarget?' target="'+this.opts.pasteLinkTarget+'"':"";r=-1===(r=r.length>this.opts.linkSize?r.substring(0,this.opts.linkSize)+"...":r).search("%")?decodeURIComponent(r):r;var u=new RegExp("("+s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+a+")","g"),h=e?"":' class="redactor-autoparser-object"';t=t.replace(u,'<a href="'+o+s.trim()+'"'+l+h+">"+r.trim()+"</a>")}return t},_convertToRegExp:function(t){return new RegExp(String(t).replace(/^\//,"").replace(/\/ig$/,"").replace(/\/gi$/,"")+"$","gi")}}),$R.add("service","storage",{init:function(t){this.app=t,this.data=[]},markImages:function(){this.editor.getElement().find("img").each((function(t){var e=$R.dom(t);e.attr("data-image")||e.attr("data-image",this.utils.getRandomId())}).bind(this))},observeImages:function(){this.editor.getElement().find("[data-image]").each(this._addImage.bind(this))},observeFiles:function(){this.editor.getElement().find("[data-file]").each(this._addFile.bind(this))},setStatus:function(t,e){this.data[t].status=e},getChanges:function(){var t=this.editor.getElement();for(var e in this.data){var i=this.data[e],n=t.find("[data-"+i.type+'="'+i.id+'"]');this.setStatus(i.id,0!==n.length)}return this.data},add:function(t,e){var i=$R.dom(e),n=i.attr("data-"+t);this.data[n]={type:t,status:!0,node:i.get(),id:i.attr("data-"+t)}},_addImage:function(t){this.add("image",t)},_addFile:function(t){this.add("file",t)}}),$R.add("service","utils",{init:function(t){this.app=t},isEmpty:function(t){var e=!1;return(t=$R.dom(t).get())&&(e=3===t.nodeType?""===t.textContent.trim().replace(/\n/,""):""===t.innerHTML),e},isEmptyHtml:function(t){return""===(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/^<div>[^\W\w\D\d]*?<\/div>$/i,"")).replace(/<hr(.*?[^>])>$/i,"hr")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).trim()},createTmpContainer:function(t){var e=$R.dom("<div>");return"string"==typeof t?e.html(t):e.append($R.dom(t).clone(!0)),e.get()},createFragment:function(t){for(var e,i,n,s=this.createTmpContainer(t),r=document.createDocumentFragment(),o=[],a=0;e=s.firstChild;){a++;var l=r.appendChild(e);1===a&&(i=l),o.push(l),n=l}return{frag:r,first:i,last:n,nodes:o}},isFragment:function(t){return"object"==typeof t&&t.frag},parseHtml:function(t){var e=this.createTmpContainer(t);return{html:e.innerHTML,nodes:e.childNodes}},getChildNodes:function(t,e,i){var n=(t=t&&t.nodeType&&11===t.nodeType?t:$R.dom(t).get()).childNodes,s=[];if(n)for(var r=0;r<n.length;r++)if(!(!0===i&&3===n[r].nodeType||3===n[r].nodeType&&this.isEmpty(n[r])||(s.push(n[r]),!1===e))){var o=this.getChildNodes(n[r],i);o.length>0&&(s=s.concat(o))}return s},getChildElements:function(t){return this.getChildNodes(t,!0,!0)},getFirstNode:function(t){return this._getFirst(this.getChildNodes(t,!1))},getLastNode:function(t){return this._getLast(this.getChildNodes(t,!1))},getFirstElement:function(t){return this._getFirst(this.getChildNodes(t,!1,!0))},getLastElement:function(t){return this._getLast(this.getChildNodes(t,!1,!0))},replaceToTag:function(t,e){return $R.dom(t).replaceWith(function(t){var i=$R.dom("<"+e+">").append($R.dom(t).contents());if(t.attributes)for(var n=t.attributes,s=0;s<n.length;s++)i.attr(n[s].nodeName,n[s].value);return i})},ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},removeFromArrayByValue:function(t,e){for(var i,n=arguments,s=n.length;s>1&&t.length;)for(e=n[--s];-1!==(i=t.indexOf(e));)t.splice(i,1);return t},removeEmptyAttr:function(t,e){var i=$R.dom(t);return"undefined"==typeof i.attr(e)||null==i.attr(e)||""===i.attr(e)&&(i.removeAttr(e),!0)},cloneAttributes:function(t,e){t=$R.dom(t).get(),e=$R.dom(e);for(var i=t.attributes,n=i.length;n--;){var s=i[n];e.attr(s.name,s.value)}return e},toParams:function(t){var e=Object.keys(t);if(!e.length)return"";for(var i="",n=0;n<e.length;n++){var s=e[n];i+=s+":"+t[s]+";"}return i},styleToObj:function(t){var e={};if(t)for(var i=t.replace(/;$/,"").split(";"),n=0;n<i.length;n++){var s=i[n].split(":");e[s[0].trim()]=s[1].trim()}return e},checkProperty:function(t){for(var e=arguments[1]&&Array.isArray(arguments[1])?arguments[1]:[].slice.call(arguments,1),i=0;i<e.length;i++){if(!t||"undefined"==typeof t[e[i]])return!1;t=t[e[i]]}return t},extendData:function(t,e){for(var i in e)"elements"===i?$R.dom(e[i]).each((function(e){var i=$R.dom(e);if("FORM"===e.tagName){var n=i.serialize(!0);for(var s in n)t=this._setData(t,s,n[s])}else{var r=i.attr("name")?i.attr("name"):i.attr("id");t=this._setData(t,r,i.val())}}).bind(this)):t=this._setData(t,i,e[i]);return t},_setData:function(t,e,i){return t instanceof FormData?t.append(e,i):t[e]=i,t},normalizeTextNodes:function(t){(t=$R.dom(t).get())&&t.normalize()},isRgb:function(t){return 0===t.search(/^rgb/i)},rgb2hex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},hex2long:function(t){return-1!==t.search(/^#/)&&4===t.length&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t},escapeRegExp:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},getRandomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<12;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},_getFirst:function(t){return 0!==t.length&&t[0]},_getLast:function(t){return 0!==t.length&&t[t.length-1]}}),$R.add("service","progress",{init:function(t){this.app=t,this.$box=null,this.$bar=null},show:function(){this._is()||this._build(),this.$box.show()},hide:function(){this._is()&&this.animate.start(this.$box,"fadeOut",this._destroy.bind(this))},update:function(t){this.show(),this.$bar.css("width",t+"%")},_is:function(){return null!==this.$box},_build:function(){this.$bar=$R.dom("<span />"),this.$box=$R.dom('<div id="redactor-progress" />'),this.$box.append(this.$bar),this.$body.append(this.$box)},_destroy:function(){this._is()&&this.$box.remove(),this.$box=null,this.$bar=null}}),$R.add("module","starter",{init:function(t){this.app=t,this.opts=t.opts,this.plugin=t.plugin,this.module=t.module},onstart:function(){this._startStop("start",this.app,["element","container","source","editor","statusbar","toolbar"]),this._startStop("start",this.module,["element","container","source","editor","statusbar","contextbar","input"])},onstop:function(){this._startStop("stop",this.module,["observer","element","container","source","editor","contextbar"])},onenable:function(){var t=this.opts.plugins;this._startStop("start",this.module,["observer","toolbar"]),this._startStop("start",this.plugin,t)},ondisable:function(){var t=this.opts.plugins;this._startStop("stop",this.module,["observer","toolbar"]),this._startStop("stop",this.plugin,t)},_startStop:function(t,e,i){for(var n=0;n<i.length;n++)"undefined"!=typeof e[i[n]]&&this.app.callInstanceMethod(e[i[n]],t)}}),$R.add("module","element",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.namespace=t.namespace,this.element=t.element,this.rootOpts=$R.extend({},!0,$R.options,t.rootOpts)},start:function(){this._build(),this._buildModes(),this._buildMarkup()},stop:function(){this.element.getElement().removeData(this.namespace+"-uuid")},_build:function(){this.element.getElement().data(this.namespace+"-uuid",this.uuid)},_buildModes:function(){var t=this.element.getType();"inline"===t&&this._redefineOptions(this.opts.modes.inline),"div"===t&&this._redefineOptions(this.opts.modes.original),"inline"!==t&&(this._isRootOption("styles")&&this.rootOpts.styles&&(this.opts.styles=!0),this._isRootOption("source")&&!this.rootOpts.source&&(this.opts.showSource=!1))},_buildMarkup:function(){this.opts.breakline&&(this.opts.markup="br");var t=this.opts.markup;this.opts.emptyHtml="br"===t?"":"<"+t+"></"+t+">"},_redefineOptions:function(t){for(var e in t)this.opts[e]=t[e]},_isRootOption:function(t){return"undefined"!=typeof this.rootOpts.styles}}),$R.add("module","editor",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.editor=t.editor,this.source=t.source,this.element=t.element,this.component=t.component,this.container=t.container,this.inspector=t.inspector,this.placeholder=!1,this.events=!1},onenable:function(){this.enable()},ondisable:function(){this.disable()},onenablefocus:function(){this._enableFocus()},oncontextmenu:function(t){this.component.setOnEvent(t,!0)},onclick:function(t){this.component.setOnEvent(t)},onkeyup:function(t){this.inspector.parse(t.target).isComponent()||this.component.clearActive()},onenablereadonly:function(){this._enableReadOnly()},ondisablereadonly:function(){this._disableReadOnly()},onplaceholder:{build:function(){this._buildPlaceholder()},toggle:function(){this._togglePlacehodler()}},start:function(){this._build(),this._buildEvents(),this._buildOptions(),this._buildAccesibility()},stop:function(){var t=this.editor.getElement(),e=this.container.getElement(),i=["redactor-in","redactor-in-"+this.uuid,"redactor-structure","redactor-placeholder",this.opts.stylesClass];t.removeAttr("spellcheck"),t.removeAttr("dir"),t.removeAttr("contenteditable"),t.removeAttr("placeholder"),t.removeClass(i.join(" ")),e.removeClass(["redactor-focus","redactor-blur","redactor-over","redactor-styles-on","redactor-styles-off","redactor-toolbar-on","redactor-text-labeled-on","redactor-source-view"].join(" ")),this._destroyEvents(),0===t.get().classList.length&&t.removeAttr("class")},enable:function(){var t=this.editor.getElement(),e=this.container.getElement();t.addClass("redactor-in redactor-in-"+this.uuid),t.attr({contenteditable:!0}),this.opts.structure&&t.addClass("redactor-structure"),!this.opts.toolbar||this.opts.air||this.opts.toolbarExternal||e.addClass("redactor-toolbar-on"),this._disableBrowsersEditing()},disable:function(){var t=this.editor.getElement(),e=this.container.getElement();t.removeClass("redactor-in redactor-in-"+this.uuid),t.removeClass("redactor-structure"),t.removeAttr("contenteditable"),e.addClass("redactor-toolbar-on")},_build:function(){var t=this.editor.getElement(),e=this.element.getElement(),i=this.container.getElement();i.addClass("redactor-blur"),this.opts.styles?(t.addClass(this.opts.stylesClass),i.addClass("redactor-styles-on")):i.addClass("redactor-styles-off"),this.opts.buttonsTextLabeled&&i.addClass("redactor-text-labeled-on"),this.element.isType("textarea")&&e.before(t)},_buildEvents:function(){this.events=$R.create("editor.events",this.app)},_buildOptions:function(){var t=this.editor.getElement();t.attr("dir",this.opts.direction),this.opts.tabindex&&t.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&t.css("min-height",this.opts.minHeight),this.opts.maxHeight&&t.css("max-height",this.opts.maxHeight),this.opts.maxWidth&&t.css({"max-width":this.opts.maxWidth,margin:"auto"})},_buildAccesibility:function(){this.editor.getElement().attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},_buildPlaceholder:function(){this.placeholder=$R.create("editor.placeholder",this.app)},_enableFocus:function(){this.opts.showSource?this._enableFocusSource():this._enableFocusEditor()},_enableFocusSource:function(){var t=this.source.getElement();this.opts.focus?(t.focus(),t.get().setSelectionRange(0,0)):this.opts.focusEnd&&t.focus()},_enableFocusEditor:function(){this.opts.focus?setTimeout(this.editor.startFocus.bind(this.editor),100):this.opts.focusEnd&&setTimeout(this.editor.endFocus.bind(this.editor),100)},_togglePlacehodler:function(){this.placeholder&&this.placeholder.toggle()},_disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1);var t=this.editor.getElement().get();t.addEventListener?t.addEventListener("mscontrolselect",function(t){t.preventDefault()}):t.attachEvent("oncontrolselect",function(t){t.returnValue=!1})}catch(t){}},_destroyEvents:function(){this.events&&this.events.destroy()},_enableReadOnly:function(){var t=this.editor.getElement();this._getEditables(t).removeAttr("contenteditable"),t.addClass("redactor-read-only"),t.removeAttr("contenteditable"),this.events&&this.events.destroy()},_disableReadOnly:function(){var t=this.editor.getElement();this._getEditables(t).attr({contenteditable:!0}),t.removeClass("redactor-read-only"),t.attr({contenteditable:!0}),this.events&&this.events.init()},_getEditables:function(t){return t.find("figcaption, td, th")}}),$R.add("class","editor.placeholder",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.element=t.element,this.build()},build:function(){var t=this.element.getElement(),e=this.editor.getElement();if(!1!==this.opts.placeholder||t.attr("placeholder")){var i=!1!==this.opts.placeholder?this.opts.placeholder:t.attr("placeholder");e.attr("placeholder",i),this.toggle()}},toggle:function(){return this.editor.isEmpty()?this.show():this.hide()},show:function(){this.editor.getElement().addClass("redactor-placeholder")},hide:function(){this.editor.getElement().removeClass("redactor-placeholder")}}),$R.add("class","editor.events",{init:function(t){this.app=t,this.$doc=t.$doc,this.uuid=t.uuid,this.editor=t.editor,this.container=t.container,this.inspector=t.inspector,this.selection=t.selection,this.component=t.component,this.blurNamespace=".redactor-blur."+this.uuid,this.eventsList=["paste","click","contextmenu","keydown","keyup","mouseup","touchstart","cut","copy","dragenter","dragstart","drop","dragover","dragleave"],this._init()},destroy:function(){this.editor.getElement().off(".redactor-focus"),this.$doc.off("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace),this._loop("off")},focus:function(t){var e=this.container.getElement();this.editor.isPasting()||e.hasClass("redactor-focus")||(e.addClass("redactor-focus"),e.removeClass("redactor-blur"),this.app.broadcast("observe",t),this.app.broadcast("focus",t),this.isFocused=!0,this.isBlured=!1)},blur:function(t){var e=this.container.getElement(),i=$R.dom(t.target),n=[".redactor-in-"+this.uuid,".redactor-toolbar",".redactor-dropdown","#redactor-modal-box"];this.app.isStarted()&&!this.editor.isPasting()&&0===i.closest(n.join(",")).length&&(this.isBlured||e.hasClass("redactor-blur")||(e.removeClass("redactor-focus"),e.addClass("redactor-blur"),this.app.broadcast("blur",t),this.isFocused=!1,this.isBlured=!0))},cut:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);this.app.broadcast("state",t),i.isComponent()&&!i.isComponentEditable()&&(this._passSelectionToClipboard(t,i,!0),t.preventDefault())},copy:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);this.app.broadcast("state",t),i.isComponent()&&!i.isComponentEditable()&&(this._passSelectionToClipboard(t,i,!1),t.preventDefault())},drop:function(t){(t=t.originalEvent||t).stopPropagation(),this._removeOverClass(),this.app.broadcast("state",t),this.app.broadcast("paste",t,t.dataTransfer),this.app.broadcast("drop",t)},dragenter:function(t){t.preventDefault()},dragstart:function(t){this.app.broadcast("dragstart",t)},dragover:function(t){(t=t.originalEvent||t).preventDefault(),this.app.broadcast("dragover",t)},dragleave:function(t){this.app.broadcast("dragleave",t)},paste:function(t){this.app.broadcast("paste",t)},contextmenu:function(t){this.app.broadcast("contextmenu",t)},click:function(t){this.app.broadcast("state",t),this.app.broadcast("click",t)},keydown:function(t){if(this.app.broadcast("state",t),!1===this.app.broadcast("keydown",t))return t.preventDefault()},keyup:function(t){this.app.broadcast("observe",t),this.app.broadcast("keyup",t)},mouseup:function(t){this.app.broadcast("observe",t),this.app.broadcast("state",t)},touchstart:function(t){this.app.broadcast("observe",t),this.app.broadcast("state",t)},_init:function(){this.editor.getElement().on("focus.redactor-focus click.redactor-focus",this.focus.bind(this)),this.$doc.on("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace,this.blur.bind(this)),this._loop("on")},_removeOverClass:function(){this.editor.getElement().removeClass("over")},_loop:function(t){for(var e=this.editor.getElement(),i=0;i<this.eventsList.length;i++)e[t](this.eventsList[i]+".redactor-events",this[this.eventsList[i]].bind(this))},_passSelectionToClipboard:function(t,e,i){var n=t.clipboardData,s=e.getComponent(),r=$R.dom(s);r.find(".redactor-component-caret").remove(),r.removeClass("redactor-component-active"),r.removeAttr("contenteditable"),r.removeAttr("tabindex");var o=s.outerHTML;i&&this.component.remove(s),n.setData("text/html",o),n.setData("text/plain",o.toString().replace(/\n$/,""))}}),$R.add("module","container",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.lang=t.lang,this.element=t.element,this.container=t.container},start:function(){this._build(),this._buildAccesibility()},stop:function(){var t=this.element.getElement(),e=this.container.getElement();e.after(t),e.remove(),t.show()},_build:function(){var t=this.element.getElement(),e=this.container.getElement();e.addClass("redactor-box"),e.attr("dir",this.opts.direction),this.element.isType("inline")&&e.addClass("redactor-inline"),t.after(e),e.append(t)},_buildAccesibility:function(){var t=this.container.getElement(),e=$R.dom("<span />");e.addClass("redactor-voice-label"),e.attr({id:"redactor-voice-"+this.uuid,"aria-hidden":!1}),e.html(this.lang.get("accessibility-help-label")),t.prepend(e)}}),$R.add("module","source",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.marker=t.marker,this.element=t.element,this.source=t.source,this.editor=t.editor,this.toolbar=t.toolbar,this.cleaner=t.cleaner,this.component=t.component,this.container=t.container,this.autoparser=t.autoparser,this.selection=t.selection,this.syncedHtml="",this.started=!1},onstartcode:function(){var t=this.source.getStartedContent(),e=this.editor.getElement(),i=this.source.getElement();this.opts.autoparse&&this.opts.autoparseStart&&(t=this.autoparser.parse(t));var n=this.cleaner.input(t),s=this.cleaner.output(n);e.html(n),i.val(s),this.syncedHtml=s,this.started=this.utils.isEmptyHtml(s),this.app.broadcast("placeholder.build"),this.component.executeScripts()},onstartcodeshow:function(){this.show()},ontrytosync:function(){this.sync()},start:function(){this._build(),this._buildClasses()},stop:function(){var t=this.element.getElement(),e=this.source.getElement();t.removeClass("redactor-source redactor-source-open"),e.off("input.redactor-source"),0===e.get().classList.length&&e.removeAttr("class"),this.source.isNameGenerated()&&t.removeAttr("name"),this.element.isType("textarea")||e.remove()},getCode:function(){return this.source.getCode()},toggle:function(){if(this.opts.source)return this.source.getElement().hasClass("redactor-source-open")?this.hide():this.show()},show:function(){if(this.opts.source){var t=this.editor.getElement(),e=this.source.getElement(),i=this.container.getElement(),n=e.val();this.app.isStarted()&&(n=this.app.broadcast("source.open",n)),this.editorIsSelected=this.selection.is(),this.editorHtml=this._insertMarkersToEditor(),this.editorHtml=this.cleaner.output(this.editorHtml,!1),this.editorHtml=this.editorHtml.trim();var s=t.height();t.hide(),e.height(s),e.val(n.trim()),e.show(),e.addClass("redactor-source-open"),e.on("input.redactor-source-events",this._onChangedSource.bind(this)),e.on("keydown.redactor-source-events",this._onTabKey.bind(this)),e.on("focus.redactor-source-events",this._onFocus.bind(this)),i.addClass("redactor-source-view"),this._setSelectionOffsetSource(),setTimeout((function(){this._disableButtons(),this._setActiveSourceButton()}).bind(this),100),this.app.isStarted()&&this.app.broadcast("source.opened")}},hide:function(){if(this.opts.source){var t=this.editor.getElement(),e=this.source.getElement(),i=this.container.getElement(),n=e.val();n=this._insertMarkersToSource(n),n=this.cleaner.input(n),this.utils.isEmptyHtml(n)&&(n=this.opts.breakline?"<br>":this.opts.emptyHtml),n=this.app.broadcast("source.close",n),this._enableButtons(),this._setInactiveSourceButton(),e.hide(),e.removeClass("redactor-source-open"),e.off(".redactor-source-events"),t.show(),t.html(n),i.removeClass("redactor-source-view"),setTimeout((function(){this.selection.restoreMarkers()}).bind(this),0),this.app.broadcast("source.closed")}},sync:function(){var t=this,e=this.editor.getElement().html();this.started&&(e=this.app.broadcast("syncBefore",e)),e=this.cleaner.output(e),this._isSync(e)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){t._syncing(e)},200))},_build:function(){var t=this.source.getElement(),e=this.element.getElement();t.hide(),this.element.isType("textarea")||e.after(t)},_buildClasses:function(){this.source.getElement().addClass("redactor-source")},_syncing:function(t){this.started&&(t=this.app.broadcast("syncing",t)),this.source.getElement().val(t),this.started&&this.app.broadcast("synced",t),this.started&&this.app.broadcast("changed",t),this.started=!0},_isSync:function(t){return this.syncedHtml!==t&&(this.syncedHtml=t,!0)},_onChangedSource:function(t){var e=this.source.getElement().val();this.app.broadcast("changed",e),this.app.broadcast("source.changed",e)},_onTabKey:function(t){if(9!==t.keyCode)return!0;t.preventDefault();var e=this.source.getElement(),i=e.get(),n=i.selectionStart;e.val(e.val().substring(0,n)+"    "+e.val().substring(i.selectionEnd)),i.selectionStart=i.selectionEnd=n+4},_onFocus:function(){this.app.broadcast("sourcefocus")},_disableButtons:function(){this.toolbar.disableButtons()},_enableButtons:function(){this.toolbar.enableButtons()},_setActiveSourceButton:function(){var t=this.toolbar.getButton("html");t.enable(),t.setActive()},_setInactiveSourceButton:function(){this.toolbar.getButton("html").setInactive()},_insertMarkersToEditor:function(){var t=this.editor.getElement(),e=this.marker.build("start"),i=this.marker.build("end"),n=this.component.getActive();if(n){this.marker.remove();var s=$R.dom(n);s.after(i),s.after(e)}else window.getSelection&&this.editorIsSelected&&(this.marker.remove(),this.marker.insertBoth());return this._getHtmlAndRemoveMarkers(t)},_insertMarkersToSource:function(t){var e=this.source.getElement(),i=this.marker.buildHtml("start"),n=this.marker.buildHtml("end"),s=i.toString().length,r=this._enlargeOffset(t,e.get().selectionStart),o=this._enlargeOffset(t,e.get().selectionEnd);return(t=t.substr(0,r)+i+t.substr(r)).substr(0,o+s)+n+t.substr(o+s)},_getHtmlAndRemoveMarkers:function(t){var e=t.html();return t.find(".redactor-selection-marker").remove(),e},_setSelectionOffsetSource:function(){var t=0,e=0,i=this.source.getElement();if(""!==this.editorHtml){var n=this.marker.buildHtml("start").replace(/\u200B/g,""),s=this.marker.buildHtml("end").replace(/\u200B/g,"");t=this._strpos(this.editorHtml,n),e=this._strpos(this.editorHtml,s)-s.toString().length-2,!1===t&&(t=0,e=0)}i.get().setSelectionRange(t,e),i.get().scrollTop=0,setTimeout((function(){i.focus()}).bind(this),0)},_strpos:function(t,e,i){var n=t.indexOf(e,i);return n>=0&&n},_enlargeOffset:function(t,e){var i=t.length,n=0;if(">"===t[e])n++;else for(var s=e;s<=i&&(n++,">"!==t[s]);s++)if("<"===t[s]||s===i){n=0;break}return e+n}}),$R.add("module","observer",{init:function(t){this.app=t,this.editor=t.editor,this.observerUnit=!1},start:function(){if(window.MutationObserver){var t=this.editor.getElement().get();this.observerUnit=this._build(t),this.observerUnit.observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})}},stop:function(){this.observerUnit&&this.observerUnit.disconnect()},_build:function(t){var e=this;return new MutationObserver(function(i){i.forEach(function(i){e._iterate(i,t)})})},_iterate:function(t,e){"attributes"===t.type&&t.target===e||(this.app.broadcast("observe"),this.app.broadcast("trytosync"),this.app.broadcast("placeholder.toggle"))}}),$R.add("module","clicktoedit",{init:function(t){this.app=t,this.opts=t.opts,this.source=t.source,this.editor=t.editor,this.container=t.container,this.selection=t.selection},onstartclicktoedit:function(){this.start()},onstop:function(){this.stop()},start:function(){this._build()},stop:function(){this.buttonSave&&this.buttonSave.stop(),this.buttonCancel&&this.buttonCancel.stop(),this._destroy(),this.app.broadcast("disable")},enable:function(t){this.app.broadcast("clickStart");var e=this.editor.isEmpty();e||this.selection.saveMarkers(),this._setFocus(),this._destroy(),this.app.broadcast("enable"),this.buttonSave.enable(),this.buttonCancel.enable(),e||this.selection.restoreMarkers(),e&&this.editor.focus()},save:function(t){t&&t.preventDefault();var e=this.source.getCode();this.app.broadcast("disable"),this.app.broadcast("clickSave",e),this.app.broadcast("clickStop"),this._build()},cancel:function(t){t&&t.preventDefault();var e=this.saved;this.editor.getElement().html(e),this.saved="",this.app.broadcast("disable"),this.app.broadcast("clickCancel",e),this.app.broadcast("clickStop"),this._build()},_build:function(){this.buttonSave=$R.create("clicktoedit.button","save",this.app,this),this.buttonCancel=$R.create("clicktoedit.button","cancel",this.app,this),this.buttonSave.stop(),this.buttonCancel.stop();var t=this.editor.getElement(),e=this.container.getElement();t.on("click.redactor-click-to-edit",this.enable.bind(this)),e.addClass("redactor-over")},_destroy:function(){var t=this.editor.getElement(),e=this.container.getElement();t.off("click.redactor-click-to-edit"),e.removeClass("redactor-over")},_setFocus:function(){this.saved=this.source.getCode(),this.buttonSave.start(),this.buttonCancel.start()}}),$R.add("class","clicktoedit.button",{init:function(t,e,i){this.app=e,this.opts=e.opts,this.toolbar=e.toolbar,this.context=i,this.type=t,this.name="save"===t?"clickToSave":"clickToCancel",this.objected=!1,this.enabled=!1,this.namespace=".redactor-click-to-edit",this._build()},enable:function(){if(this.objected){var t=this.opts[this.name];t.api="module.clicktoedit."+this.type,this.toolbar.addButton(this.type,t),this.enabled=!0}},start:function(){this.objected||(this.$button.off(this.namespace),this.$button.show(),this.$button.on("click"+this.namespace,this.context[this.type].bind(this.context)))},stop:function(){!this.objected&&this.enabled&&this.$button.hide()},_build:function(){this.objected="object"==typeof this.opts[this.name],this.objected||(this.$button=$R.dom(this.opts[this.name]),this.enabled=!0)}}),$R.add("module","statusbar",{init:function(t){this.app=t,this.opts=t.opts,this.element=t.element,this.statusbar=t.statusbar,this.container=t.container},start:function(){if(!this.element.isType("inline")){var t=this.statusbar.getElement(),e=this.container.getElement();t.addClass("redactor-statusbar"),e.append(t)}}}),$R.add("module","contextbar",{init:function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.$doc=t.$doc,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector},onenablereadonly:function(){this.stop()},ondisablereadonly:function(){this.start()},oncontextbar:{close:function(){this.close()}},start:function(){if(this.opts.toolbarContext){var t=this.editor.getElement();this._build(),t.on("click.redactor-context mouseup.redactor-context",this.open.bind(this))}},stop:function(){this.editor.getElement().off(".redactor-context"),this.$doc.off(".redactor-context"),this.$contextbar&&this.$contextbar.remove()},is:function(){return this.$contextbar&&this.$contextbar.hasClass("open")},set:function(t,e,i,n){for(var s in this.$contextbar.html(""),this.$el=$R.dom(e),i){var r=$R.create("contextbar.button",this.app,i[s]);""!==r.html()&&this.$contextbar.append(r)}var o=this._buildPosition(t,this.$el,n);this.$contextbar.css(o),this.$contextbar.show(),this.$contextbar.addClass("open"),this.$doc.on("click.redactor-context mouseup.redactor-context",this.close.bind(this))},open:function(t){this.app.broadcast("contextbar",t,this)},close:function(t){if(this.$contextbar){if(t){var e=$R.dom(t.target);if(this.$el&&0!==e.closest(this.$el).length)return}this.$contextbar.hide(),this.$contextbar.removeClass("open"),this.$doc.off(".redactor.context")}},_build:function(){this.$contextbar=$R.dom("<div>"),this.$contextbar.attr("id","redactor-context-toolbar-"+this.uuid),this.$contextbar.addClass("redactor-context-toolbar"),this.$contextbar.hide(),this.$body.append(this.$contextbar)},_buildPosition:function(t,e,i){var n,s,r=e.offset(),o=e.width(),a=e.height(),l=this.$contextbar.width(),u=this.$contextbar.height(),h=this.detector.isMobile(),c=h?t.pageX:t.clientX;return i?"top"===i?(n=r.top-u,s=r.left+o/2-l/2):"bottom"===i&&(n=r.top+a,s=r.left+o/2-l/2):(n=(h?t.pageY:t.clientY)+this.$doc.scrollTop()-u,s=c-l/2),s<0&&(s=0),{top:n+"px",left:s+"px"}}}),$R.add("class","contextbar.button",{mixins:["dom"],init:function(t,e){this.app=t,this.obj=e,this._init()},_init:function(){this.parse("<a>"),this.attr("href","#"),this._buildTitle(),this._buildMessage()},_buildTitle:function(){this.html(this.obj.title)},_buildMessage:function(){"undefined"==typeof this.obj.message&&"undefined"==typeof this.obj.api||this.on("click",this._toggle.bind(this))},_toggle:function(t){t.preventDefault(),this.obj.message?this.app.broadcast(this.obj.message,this.obj.args):this.obj.api&&this.app.api(this.obj.api,this.obj.args)}}),$R.add("module","toolbar",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.toolbar=t.toolbar,this.buttons=[],this.toolbarModule=!1},onsource:{open:function(){!this.toolbar.isAir()&&this.toolbar.isFixed()&&this.toolbarModule.resetPosition()},opened:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.createSourceHelper()},close:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.destroySourceHelper()},closed:function(){this.toolbar.is()&&this.opts.air&&this.toolbarModule.openSelected()}},onobserve:function(){this.toolbar.is()&&this.toolbar.observe()},onfocus:function(){this._setExternalOnFocus()},onsourcefocus:function(){this._setExternalOnFocus()},start:function(){this.toolbar.is()&&(this._buildButtons(),this._initToolbar(),this._initButtons())},stop:function(){this.toolbarModule&&this.toolbarModule.stop()},_buildButtons:function(){this.buttons=this.opts.buttons.concat(),this._buildImageButton(),this._buildFileButton(),this._buildSourceButton(),this._buildAdditionalButtons(),this._buildHiddenButtons()},_buildImageButton:function(){this.opts.imageUpload||this.utils.removeFromArrayByValue(this.buttons,"image")},_buildFileButton:function(){this.opts.fileUpload||this.utils.removeFromArrayByValue(this.buttons,"file")},_buildSourceButton:function(){this.opts.source||this.utils.removeFromArrayByValue(this.buttons,"html")},_buildAdditionalButtons:function(){if(0!==this.opts.buttonsAdd.length&&(this.buttons=this.buttons.concat(this.opts.buttonsAdd)),0!==this.opts.buttonsAddFirst.length&&this.buttons.unshift(this.opts.buttonsAddFirst),!1!==this.opts.buttonsAddAfter)for(var t=this.buttons.indexOf(this.opts.buttonsAddAfter.after)+1,e=this.opts.buttonsAddAfter.buttons,i=0;i<e.length;i++)this.buttons.splice(t+i,0,e[i]);if(!1!==this.opts.buttonsAddBefore)for(t=this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1,e=this.opts.buttonsAddBefore.buttons,i=0;i<e.length;i++)this.buttons.splice(t-(1-i),0,e[i])},_buildHiddenButtons:function(){if(0!==this.opts.buttonsHide.length)for(var t=this.opts.buttonsHide,e=0;e<t.length;e++)this.utils.removeFromArrayByValue(this.buttons,t[e])},_setExternalOnFocus:function(){!this.opts.air&&this.opts.toolbarExternal&&this.toolbarModule.setExternal()},_initToolbar:function(){this.toolbarModule=$R.create(this.opts.air?"toolbar.air":"toolbar.standard",this.app)},_initButtons:function(){for(var t=0;t<this.buttons.length;t++){var e=this.buttons[t];$R.buttons[e]&&this.toolbar.addButton(e,$R.buttons[e])}}}),$R.add("class","toolbar.air",{init:function(t){this.app=t,this.$doc=t.$doc,this.$win=t.$win,this.utils=t.utils,this.editor=t.editor,this.animate=t.animate,this.toolbar=t.toolbar,this.container=t.container,this.inspector=t.inspector,this.selection=t.selection,this.clicks=0,this._init()},stop:function(){this.toolbar.getWrapper().remove(),this.editor.getElement().off(".redactor-air-trigger"),this.$doc.off(".redactor-air"),this.$doc.off(".redactor-air-trigger"),this.toolbar.stopObservers()},createSourceHelper:function(){this.$airHelper=$R.dom("<span>"),this.$airHelper.addClass("redactor-air-helper"),this.$airHelper.html('<i class="re-icon-html"></i>'),this.$airHelper.on("click",(function(t){t.preventDefault(),this.app.api("module.source.hide")}).bind(this)),this.container.getElement().append(this.$airHelper)},destroySourceHelper:function(){this.$airHelper&&this.$airHelper.remove()},openSelected:function(){setTimeout((function(){this._isSelection()&&this._open(!1)}).bind(this),0)},_init:function(){this.toolbar.create();var t=this.toolbar.getWrapper(),e=this.toolbar.getElement(),i=this.editor.getElement(),n=this.container.getElement();t.addClass("redactor-toolbar-wrapper-air"),e.addClass("redactor-air"),e.hide(),t.append(e),n.prepend(t),this.openSelected(),this.$doc.on("mouseup.redactor-air-trigger",this._open.bind(this)),i.on("keyup.redactor-air-trigger",this._openCmd.bind(this))},_isSelection:function(){return this.selection.is()&&!this.selection.isCollapsed()},_isOpened:function(){return this.toolbar.getElement().hasClass("open")},_open:function(t){var e=!!t&&t.target,i=!!t&&$R.dom(t.target),n=this.inspector.parse(e),s=n.isComponent()&&!n.isComponentType("table"),r=n.isFigcaption(),o=i&&0!==i.closest(".redactor-modal").length,a=t&&0!==i.closest(".re-button").length;if(!(t&&0!==i.closest(".redactor-dropdown").length||a||o||r||s||this.toolbar.isContextBar())&&this._isSelection()){var l=this.selection.getPosition();setTimeout((function(){this._isSelection()&&this._doOpen(l)}).bind(this),1)}},_openCmd:function(){if(this.selection.isAll()){var t=this.toolbar.getElement(),e=this.selection.getPosition();e.top=e.top<20?0:e.top-t.height(),e.height=0,this._doOpen(e)}},_doOpen:function(t){var e=this.toolbar.getWrapper(),i=this.toolbar.getElement(),n=this.container.getElement().offset();e.css({left:t.left-n.left-0+"px",top:t.top-n.top+t.height+this.$doc.scrollTop()+"px"}),this.app.broadcast("airOpen"),i.addClass("open"),i.show(),this._opened()},_opened:function(){this.$doc.on("click.redactor-air",this._close.bind(this)),this.$doc.on("keydown.redactor-air",this._close.bind(this)),this.app.broadcast("airOpened")},_close:function(t){var e=!!t&&t.target,i=!!t&&$R.dom(t.target),n=(this.inspector.parse(e),t&&0!==i.closest("[data-dropdown], .redactor-dropdown-not-close").length);if(!n&&t&&0!==i.closest(".re-button").length||!n&&this._isOpened()){this.app.broadcast("airClose");var s=this.toolbar.getElement();s.removeClass("open"),s.hide(),this._closed()}},_closed:function(){this.$doc.off(".redactor-air"),this.app.broadcast("airClosed")}}),$R.add("class","toolbar.fixed",{init:function(t){this.app=t,this.opts=t.opts,this.$win=t.$win,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector,this.container=t.container,this._init()},stop:function(){this.$fixedTarget.off(".redactor-toolbar"),this.$win.off(".redactor-toolbar"),this.editor.getElement().off(".redactor-toolbar")},reset:function(){var t=this.toolbar.getElement();this.toolbar.getWrapper().css("height",""),t.removeClass("redactor-toolbar-fixed"),t.css({position:"",top:"",left:"",width:""});var e=this.toolbar.getDropdown();e&&e.updatePosition()},_init:function(){var t=this.opts.toolbarFixedTarget!==document;this.$fixedTarget=t?$R.dom(this.opts.toolbarFixedTarget):this.$win,this._doFixed(),t&&(this.$win.on("scroll.redactor-toolbar",this._doFixed.bind(this)),this.$win.on("resize.redactor-toolbar",this._doFixed.bind(this))),this.$fixedTarget.on("scroll.redactor-toolbar",this._doFixed.bind(this)),this.$fixedTarget.on("resize.redactor-toolbar",this._doFixed.bind(this)),this.editor.getElement().on("keyup.redactor-toolbar",this._checkFixed.bind(this))},_checkFixed:function(){this.editor.isEmpty()&&this.reset()},_doFixed:function(){var t=this.editor.getElement(),e=this.container.getElement(),i=this.toolbar.getElement(),n=this.toolbar.getWrapper();if(0===e.parents().filter(function(t){return"none"===getComputedStyle(t,null).display&&t}).length){var s=t.height()<100,r=this.editor.isEmpty();if(!(s||r||this.editor.isSourceMode())){var o=i.height(),a=e.position().top,l=a+e.height()-(60+this.opts.toolbarFixedTopOffset),u=this.$fixedTarget.scrollTop(),h=this.opts.toolbarFixedTarget===document?0:this.$fixedTarget.offset().top-this.$win.scrollTop();if(u>a&&u<l){var c=this.detector.isDesktop()?"fixed":"absolute";h=this.detector.isDesktop()?h:u-a+this.opts.toolbarFixedTopOffset,this.detector.isMobile()&&(this.fixedScrollTimeout&&clearTimeout(this.fixedScrollTimeout),i.hide(),this.fixedScrollTimeout=setTimeout(function(){i.show()},250)),n.height(o),i.addClass("redactor-toolbar-fixed"),i.css({position:c,top:h+this.opts.toolbarFixedTopOffset+"px",width:e.width()+"px"});var d=this.toolbar.getDropdown();d&&d.updatePosition(),this.app.broadcast("toolbar.fixed")}else this.reset(),this.app.broadcast("toolbar.unfixed")}}}}),$R.add("class","toolbar.standard",{init:function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.toolbar=t.toolbar,this.container=t.container,this.isExternalMultiple=!1,this.toolbarFixed=!1,this._init()},stop:function(){this.toolbar.getWrapper().remove(),this.toolbarFixed&&this.toolbarFixed.stop(),this.opts.toolbarExternal&&this._findToolbars(),this.toolbar.stopObservers()},setExternal:function(){this._findToolbars(),this.isExternalMultiple&&(this.$toolbars.hide(),this.$external.find(".redactor-toolbar-external-"+this.uuid).show())},resetPosition:function(){this.toolbarFixed&&this.toolbarFixed.reset()},_init:function(){this._build(),this.opts.toolbarExternal?this._buildExternal():(this._buildFixed(),this.toolbar.getElement().show())},_build:function(){this.toolbar.create();var t=this.toolbar.getWrapper(),e=this.toolbar.getElement();t.addClass("redactor-toolbar-wrapper"),e.addClass("redactor-toolbar"),e.hide(),t.append(e),this.opts.toolbarExternal||this.container.getElement().prepend(t)},_buildExternal:function(){this._initExternal(),this._findToolbars(),this.isExternalMultiple?this._hideToolbarsExceptFirst():this.toolbar.getElement().show()},_buildFixed:function(){this.opts.toolbarFixed&&(this.toolbarFixed=$R.create("toolbar.fixed",this.app))},_initExternal:function(){var t=this.toolbar.getElement(),e=this.toolbar.getElement();t.addClass("redactor-toolbar-external redactor-toolbar-external-"+this.uuid),this.$external=$R.dom(this.opts.toolbarExternal),this.$external.append(e)},_findToolbars:function(){this.$toolbars=this.$external.find(".redactor-toolbar-external"),this.isExternalMultiple=this.$toolbars.length>1},_hideToolbarsExceptFirst:function(){this.$toolbars.hide(),this.$toolbars.first().show()}}),$R.add("module","line",{init:function(t){this.app=t,this.lang=t.lang,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("line")){var n=i.getComponent(),s={remove:{title:this.lang.get("delete"),api:"module.line.remove",args:n}};e.set(t,n,s,"bottom")}},insert:function(){var t=this.component.create("line");this.insertion.insertRaw(t)},remove:function(t){this.component.remove(t)}}),$R.add("class","line.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&void 0!==e.cmnt?e:this._init(e)},_init:function(t){var e,i;if("undefined"!=typeof t){var n=$R.dom(t),s=n.get();"HR"===s.tagName?i=s:"FIGURE"===s.tagName&&(e=s,i=n.find("hr").get())}this._buildWrapper(e),this._buildElement(i),this._initWrapper()},_buildElement:function(t){t?this.$element=$R.dom(t):(this.$element=$R.dom("<hr>"),this.append(this.$element))},_buildWrapper:function(t){this.parse(t=t||"<figure>")},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"line",tabindex:"-1",contenteditable:!1})}}),$R.add("module","link",{modals:{link:'<form action="">                 <div class="form-item">                     <label>URL <span class="req">*</span></label>                     <input type="text" name="url">                 </div>                 <div class="form-item">                     <label>## text ##</label>                     <input type="text" name="text">                 </div>                 <div class="form-item form-item-target">                     <label class="checkbox">                         <input type="checkbox" name="target"> ## link-in-new-tab ##                     </label>                 </div>             </form>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.utils=t.utils,this.caret=t.caret,this.inline=t.inline,this.editor=t.editor,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.isCurrentLink=!1,this.currentText=!1},onmodal:{link:{open:function(t,e){this._setFormData(e,t)},opened:function(t,e){this._setFormFocus(e)},update:function(t,e){var i=e.getData();this._validateData(e,i)&&this._update(i)},insert:function(t,e){var i=e.getData();this._validateData(e,i)&&this._insert(i)},unlink:function(t,e){this._unlink()}}},onbutton:{link:{observe:function(t){this._observeButton(t)}}},ondropdown:{link:{observe:function(t){this._observeUnlink(t),this._observeEdit(t)}}},oncontextbar:function(t,e){var i=this._getCurrent(),n=this.inspector.parse(i);if(n.isLink()){var s=n.getLink(),r=$R.dom(s),o=$R.dom("<a>"),a=r.attr("href");o.text(this._truncateText(a)),o.attr("href",a),o.attr("target","_blank");var l={link:{title:o},edit:{title:this.lang.get("edit"),api:"module.link.open"},unlink:{title:this.lang.get("unlink"),api:"module.link.unlink"}};e.set(t,s,l,"bottom")}},open:function(){this.$link=this._buildCurrent(),this.app.api("module.modal.build",this._getModalData())},insert:function(t){this._insert(t)},update:function(t){this._update(t)},unlink:function(){this._unlink()},_observeButton:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);i.isPre()||i.isCode()?t.disable():t.enable()},_observeUnlink:function(t){var e=t.getItem("unlink");0===this._getLinks().length?e.disable():e.enable()},_observeEdit:function(t){var e=this._getCurrent(),i=t.getItem("link"),n=this.inspector.parse(e).isLink()?this.lang.get("link-edit"):this.lang.get("link-insert");i.setTitle(n)},_unlink:function(){this.app.api("module.modal.close");var t=[],e=this._getLinks();this.selection.save();for(var i=0;i<e.length;i++){var n=$R.create("link.component",this.app,e[i]);t.push(this.selection.getElement(e[i])),n.unwrap(),this.app.broadcast("link.deleted",n)}for(this.selection.restore(),i=0;i<t.length;i++){var s=t[i]?t[i]:this.editor.getElement();this.utils.normalizeTextNodes(s)}this._resetCurrent()},_update:function(t){this.app.api("module.modal.close");var e=this._getLinks();this._setLinkData(e,t,"updated"),this._resetCurrent()},_insert:function(t){this.app.api("module.modal.close");var e=this._getLinks();this._insertSingle(e,t)||(this._removeInSelection(e),this._insertMultiple(t)),this._resetCurrent()},_removeInSelection:function(t){this.selection.save();for(var e=0;e<t.length;e++){var i=$R.create("link.component",this.app,t[e]),n=i.clone();i.unwrap(),this.app.broadcast("link.deleted",n)}this.selection.restore()},_insertMultiple:function(t){var e=this.selection.getRange();e&&this._isCurrentTextChanged(t)&&this._deleteContents(e);var i=this.inline.format({tag:"a"});this._setLinkData(i,t,"inserted")},_insertSingle:function(t,e){var i=this.selection.getInline();if(1===t.length&&t[0].textContext===this.selection.getText()||i&&"A"===i.tagName){var n=$R.create("link.component",this.app,t[0]);return n.setData(e),this.caret.set(n),this.app.broadcast("link.inserted",n),!0}return!1},_setLinkData:function(t,e,i){e.text=""===e.text.trim()?this._truncateText(e.url):e.text;var n=!this.currentText||this.currentText!==e.text;this.selection.save();for(var s=0;s<t.length;s++){var r=$R.create("link.component",this.app,t[s]),o={};e.text&&n&&(o.text=e.text),e.url&&(o.url=e.url),void 0!==e.target&&(o.target=e.target),r.setData(o),this.app.broadcast("link."+i,r)}setTimeout(this.selection.restore.bind(this.selection),0)},_deleteContents:function(t){var e=this.selection.getHtml(),i=this.utils.parseHtml(e).nodes[0];if(i&&3!==i.nodeType){var n=i.tagName.toLowerCase(),s=document.createElement(n);this.insertion.insertNode(s,"start")}else t.deleteContents()},_getModalData:function(){var t;return t=this._isLink()?{update:{title:this.lang.get("save")},unlink:{title:this.lang.get("unlink"),type:"danger"},cancel:{title:this.lang.get("cancel")}}:{insert:{title:this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}},{name:"link",title:this._isLink()?this.lang.get("link-edit"):this.lang.get("link-insert"),handle:this._isLink()?"update":"insert",commands:t}},_isLink:function(){return this.currentLink},_isCurrentTextChanged:function(t){return this.currentText&&this.currentText!==t.text},_buildCurrent:function(){var t=this._getCurrent(),e=this.inspector.parse(t);if(e.isLink()){this.currentLink=!0;var i=e.getLink();i=$R.create("link.component",this.app,i)}else{this.currentLink=!1,i=$R.create("link.component",this.app);var n={text:this.selection.getText()};i.setData(n)}return i},_getCurrent:function(){return this.selection.getInlinesAllSelected({tags:["a"]})[0]},_getLinks:function(){for(var t=this.selection.getInlines({all:!0,tags:["a"]}),e=[],i=0;i<t.length;i++)this.inspector.parse(t[i]).isLink()&&e.push(t[i]);return e},_resetCurrent:function(){this.isCurrentLink=!1,this.currentText=!1},_truncateText:function(t){return t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},_validateData:function(t,e){return""!==e.url.trim()||t.setError("url")},_setFormFocus:function(t){t.getField("url").focus()},_setFormData:function(t,e){var i=this.$link.getData(),n={url:i.url,text:i.text,target:this.opts.linkTarget||i.target};this.opts.linkNewTab||e.find(".form-item-target").hide(),t.setData(n),this.currentText=t.getField("text").val()}}),$R.add("class","link.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,this.marker=t.marker,this.reUrl=new RegExp("^((https?|ftp):\\/\\/)?(([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i"),e&&void 0!==e.cmnt?e:this._init(e)},setData:function(t){for(var e in t)this._set(e,t[e])},getData:function(){for(var t=["url","text","target"],e={},i=0;i<t.length;i++)e[t[i]]=this._get(t[i]);return e},_init:function(t){var e=$R.dom(t);this.parse(void 0===t?"<a>":e)},_set:function(t,e){this["_set_"+t](e)},_get:function(t){return this["_get_"+t]()},_get_target:function(){return!!this.attr("target")&&this.attr("target")},_get_url:function(){return this.attr("href")},_get_text:function(){return this._getContext().text()},_getContext:function(){return this._findDeepestChild(this).element},_set_target:function(t){!1===t?this.removeAttr("target"):t&&this.attr("target",!0===t?"_blank":t)},_set_text:function(t){this._getContext().html();var e=this.marker.find("start",this),i=this.marker.find("end",this),n=this.marker.buildHtml("start"),s=this.marker.buildHtml("end");e&&i?t=n+t+s:(e||i)&&(t+=n),this._getContext().html(t)},_set_url:function(t){this.opts.linkValidation&&(t=this._cleanUrl(t),t=this._isMailto(t)?"mailto:"+t.replace("mailto:",""):t,t=this._isUrl(t)?"http://"+t.replace(/(ftp|https?):\/\//gi,""):t),this.attr("href",t)},_isMailto:function(t){return-1!==t.search("@")&&!1===/(ftp|https?):\/\//i.test(t)},_isUrl:function(t){return this.reUrl.test(t)},_cleanUrl:function(t){return t.trim().replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,"")},_findDeepestChild:function(t){var e={depth:0,element:t};return t.children().each((function(i){var n=$R.dom(i);if(i.outerHTML===t.html()){var s=this._findDeepestChild(n);s.depth+1>e.depth&&(e={depth:1+s.depth,element:s.element})}}).bind(this)),e}}),$R.add("module","modal",{init:function(t){this.app=t,this.lang=t.lang,this.$doc=t.$doc,this.$win=t.$win,this.$body=t.$body,this.animate=t.animate,this.detector=t.detector,this.selection=t.selection,this.$box=!1,this.$modal=!1,this.defaults={name:!1,url:!1,title:!1,width:"600px",height:!1,handle:!1,commands:!1}},build:function(t){this._open(t)},close:function(){this._close()},stop:function(){this.$box&&(this.$box.remove(),this.$box=!1,this.$modal=!1,this.$doc.off(".redactor.modal"),this.$win.off(".redactor.modal")),this.$overlay&&this.$overlay.remove()},resize:function(){this.$modal.setWidth(this.p.width),this.$modal.updatePosition()},_isOpened:function(){return this.$modal&&this.$modal.hasClass("open")},_open:function(t){this._buildDefaults(t),this.p.url?this._openUrl():this._openTemplate()},_openUrl:function(){$R.ajax.post({url:this.p.url,success:this._doOpen.bind(this)})},_openTemplate:function(){if("undefined"!=typeof $R.modals[this.p.name]){var t=this.lang.parse($R.modals[this.p.name]);this._doOpen(t)}},_doOpen:function(t){this.stop(),this.selection.saveMarkers(),this.detector.isDesktop()||document.activeElement.blur(),this._createModal(t),this._buildModalBox(),this._buildOverlay(),this._buildModal(),this._buildModalForm(),this._buildModalCommands(),this._broadcast("open"),this.$modal.updatePosition(),this._buildModalTabs(),this.animate.start(this.$box,"fadeIn",this._opened.bind(this)),this.animate.start(this.$overlay,"fadeIn")},_opened:function(){this.$modal.addClass("open"),this.$box.on("mousedown.redactor.modal",this._close.bind(this)),this.$doc.on("keyup.redactor.modal",this._handleEscape.bind(this)),this.$win.on("resize.redactor.modal",this.resize.bind(this)),this.$modal.getBody().find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor.modal",this._handleEnter.bind(this)),this._broadcast("opened")},_close:function(t){if(this.$box&&this._isOpened()){if(t){if(!this._needToClose(t.target))return;t.stopPropagation(),t.preventDefault()}this.selection.restoreMarkers(),this._broadcast("close"),this.animate.start(this.$box,"fadeOut",this._closed.bind(this)),this.animate.start(this.$overlay,"fadeOut")}},_closed:function(){this.$modal.removeClass("open"),this.$box.off(".redactor.modal"),this.$doc.off(".redactor.modal"),this.$win.off(".redactor.modal"),this._broadcast("closed")},_createModal:function(t){this.$modal=$R.create("modal.element",this.app,t)},_broadcast:function(t){this.app.broadcast("modal."+t,this.$modal,this.$modalForm),this.app.broadcast("modal."+this.p.name+"."+t,this.$modal,this.$modalForm)},_buildDefaults:function(t){this.p=$R.extend({},this.defaults,t)},_buildModalBox:function(){this.$box=$R.dom("<div>"),this.$box.attr("id","redactor-modal"),this.$box.addClass("redactor-animate-hide"),this.$box.html(""),this.$body.append(this.$box)},_buildOverlay:function(){this.$overlay=$R.dom("#redactor-overlay"),0===this.$overlay.length&&(this.$overlay=$R.dom("<div>"),this.$overlay.attr("id","redactor-overlay"),this.$overlay.addClass("redactor-animate-hide"),this.$body.prepend(this.$overlay))},_buildModal:function(){this.$box.append(this.$modal),this.$modal.setTitle(this.p.title),this.$modal.setHeight(this.p.height),this.$modal.setWidth(this.p.width)},_buildModalCommands:function(){if(this.p.commands){var t=this.p.commands,e=this.$modal.getFooter();for(var i in t){var n=$R.dom("<button>");n.html(t[i].title),n.attr("data-command",i),"cancel"===i&&(n.attr("data-action","close"),n.addClass("redactor-button-unstyled")),"undefined"!=typeof t[i].type&&"danger"===t[i].type&&n.addClass("redactor-button-danger"),n.on("click",this._handleCommand.bind(this)),e.append(n)}}},_buildModalTabs:function(){var t=this.$modal.getBody(),e=t.find(".redactor-modal-tab"),i=t.find(".redactor-modal-tabs");e.length>1&&((i=0===i.length?$R.dom("<div>"):i.html("")).addClass("redactor-modal-tabs"),e.each((function(t,e){var n=$R.dom(t),s=$R.dom("<a>");s.attr("href","#"),s.attr("rel",e),s.text(n.attr("data-title")),s.on("click",this._showTab.bind(this)),0===e&&s.addClass("active"),i.append(s)}).bind(this)),t.prepend(i))},_buildModalForm:function(){this.$modalForm=$R.create("modal.form",this.app,this.$modal.getForm())},_showTab:function(t){t.preventDefault();var e=$R.dom(t.target),i=e.attr("rel"),n=this.$modal.getBody(),s=n.find(".redactor-modal-tab");s.hide(),s.eq(i).show(),n.find(".redactor-modal-tabs a").removeClass("active"),e.addClass("active")},_needToClose:function(t){var e=$R.dom(t);return!("close"!==e.attr("data-action")&&!this.$modal.isCloseNode(t)&&0!==e.closest(".redactor-modal").length)},_handleCommand:function(t){var e=$R.dom(t.target).closest("button").attr("data-command");"cancel"!==e&&t.preventDefault(),this._broadcast(e)},_handleEnter:function(t){13===t.which&&this.p.handle&&(t.preventDefault(),this._broadcast(this.p.handle))},_handleEscape:function(t){27===t.which&&this._close()}}),$R.add("class","modal.element",{mixins:["dom"],init:function(t,e){this.app=t,this.$win=t.$win,this._init(e)},getForm:function(){return this.find("form")},getHeader:function(){return this.$modalHeader},getBody:function(){return this.$modalBody},getFooter:function(){return this.$modalFooter},setTitle:function(t){t&&this.$modalHeader.html(t)},setWidth:function(t){t=parseInt(t)>=this.$win.width()?"96%":t,this.css("max-width",t)},setHeight:function(t){!1!==t&&this.$modalBody.css("height",t)},updatePosition:function(){var t=this.width();this.css({left:"50%","margin-left":"-"+t/2+"px"});var e=this.$win.height(),i=this.height(),n=e/2-i/2;i<e&&0!==n&&this.css("margin-top",n+"px")},isCloseNode:function(t){return t===this.$modalClose.get()},_init:function(t){this._build(),this._buildClose(),this._buildHeader(),this._buildBody(),this._buildFooter(),this._buildTemplate(t)},_build:function(){this.parse("<div>"),this.addClass("redactor-modal")},_buildClose:function(){this.$modalClose=$R.dom("<span>"),this.$modalClose.addClass("redactor-close"),this.append(this.$modalClose)},_buildHeader:function(){this.$modalHeader=$R.dom("<div>"),this.$modalHeader.addClass("redactor-modal-header"),this.append(this.$modalHeader)},_buildBody:function(){this.$modalBody=$R.dom("<div>"),this.$modalBody.addClass("redactor-modal-body"),this.append(this.$modalBody)},_buildFooter:function(){this.$modalFooter=$R.dom("<div>"),this.$modalFooter.addClass("redactor-modal-footer"),this.append(this.$modalFooter)},_buildTemplate:function(t){this.$modalBody.html(t)}}),$R.add("class","modal.form",{mixins:["dom"],init:function(t,e){this.app=t,this.build(e)},build:function(t){this.parse(t)},getData:function(){var t={};return this.find("[name]").each(function(e){var i=$R.dom(e);t[i.attr("name")]=i.val()}),t},setData:function(t){this.find("[name]").each(function(e){var i=$R.dom(e),n=i.attr("name");t.hasOwnProperty(n)&&(e.type&&"checkbox"===e.type?e.checked=t[n]:i.val(t[n]))})},getField:function(t){return this.find("[name="+t+"]")},setError:function(t){var e=this.getField(t);return e.addClass("error"),e.one(this._getFieldEventName(e.get()),this._clearError),!1},_clearError:function(){return $R.dom(this).removeClass("error")},_getFieldEventName:function(t){return"SELECT"===t.tagName||"checkbox"===t.type||"radio"===t.type?"change":"keyup"}}),$R.add("module","block",{init:function(t){this.app=t,this.block=t.block},format:function(t){var e=this.block.format(t);this.app.broadcast("format","block",e)},clearformat:function(){this.block.clearFormat()},clearstyle:function(){this.block.clearStyle()},clearclass:function(){this.block.clearClass()},clearattr:function(){this.block.clearAttr()},add:function(t,e){this.block.add(t,e)},toggle:function(t,e){this.block.toggle(t,e)},set:function(t,e){this.block.set(t,e)},remove:function(t,e){this.block.remove(t,e)}}),$R.add("module","inline",{init:function(t){this.app=t,this.inline=t.inline},format:function(t){var e=this.inline.format(t);this.app.broadcast("format","inline",e)},clearformat:function(){this.inline.clearFormat()},clearstyle:function(){this.inline.clearStyle()},clearclass:function(){this.inline.clearClass()},clearattr:function(){this.inline.clearAttr()},add:function(t,e){this.inline.add(t,e)},toggle:function(t,e){this.inline.toggle(t,e)},set:function(t,e){this.inline.set(t,e)},remove:function(t,e){this.inline.remove(t,e)}}),$R.add("module","autosave",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.source=t.source},onsynced:function(){this.opts.autosave&&this._send()},_send:function(){var t={};t[this.opts.autosaveName?this.opts.autosaveName:this.source.getName()]=this.source.getCode(),t=this.utils.extendData(t,this.opts.autosaveData),$R.ajax.post({url:this.opts.autosave,data:t,success:this._complete.bind(this)})},_complete:function(t){this.app.broadcast(t&&t.error?"autosaveError":"autosave",name,data,t)}}),$R.add("module","input",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.keycodes=t.keycodes,this.element=t.element,this.selection=t.selection,this.insertion=t.insertion,this.inspector=t.inspector,this.autoparser=t.autoparser,this.lastShiftKey=!1},onpaste:function(t,e){if(this.opts.input)return $R.create("input.paste",this.app,t,e)},onkeydown:function(t){if(this.opts.input){var e=t.which;if(!$R.create("input.shortcut",this.app,t).is()){if((t.ctrlKey||t.metaKey)&&65===e)return t.preventDefault(),this._selectAll();var i=[this.keycodes.ENTER,this.keycodes.SPACE,this.keycodes.BACKSPACE,this.keycodes.DELETE];if(this.selection.isAll()&&-1!==i.indexOf(e))t.preventDefault(),this.element.isType("inline")?(this.editor.getElement().html(""),this.editor.startFocus()):this.insertion.set(this.opts.emptyHtml);else{if(this.opts.autoparse&&this.autoparser.format(t,e),!(e>=48&&e<=57||e>=65&&e<=90)||!this.selection.hasNonEditable())return e===this.keycodes.ENTER?$R.create("input.enter",this.app,t,e):t.metaKey&&219===e?(t.preventDefault(),void this.app.api("module.list.outdent")):e===this.keycodes.TAB||t.metaKey&&221===e?$R.create("input.tab",this.app,t,e):e===this.keycodes.SPACE?$R.create("input.space",this.app,t,e,this.lastShiftKey):this._isDeleteKey(e)?$R.create("input.delete",this.app,t,e):this._isArrowKey(e)?$R.create("input.arrow",this.app,t,e):void 0;t.preventDefault()}}}},onkeyup:function(t){if(this.opts.input){var e=t.which;this.lastShiftKey=t.shiftKey,this.app.broadcast("contextbar.close"),$R.create("input.shortcode",this.app,t,e).is()}},start:function(){this.opts.shortcutsAdd&&(this.opts.shortcuts=$R.extend({},!0,this.opts.shortcuts,this.opts.shortcutsAdd))},_selectAll:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t);if(e.isComponentType("table")){var i=e.getTable();this.selection.setAll(i)}else e.isComponentType("code")?(i=e.getComponentCodeElement(),this.selection.setAll(i)):this.selection.setAll()},_isArrowKey:function(t){return-1!==[this.keycodes.UP,this.keycodes.DOWN,this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(t)},_isDeleteKey:function(t){return t===this.keycodes.BACKSPACE||t===this.keycodes.DELETE}}),$R.add("class","input.arrow",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.caret=t.caret,this.editor=t.editor,this.keycodes=t.keycodes,this.component=t.component,this.inspector=t.inspector,this.selection=t.selection,this.key=i,this._init(e)},_init:function(t){if(this._isRightDownKey()){if(this._isExitOnDownRightArrow(t))return;if(this._selectComponent(t,"End","nextSibling"))return}this._isLeftUpKey()&&this._selectComponent(t,"Start","previousSibling")||this._isRightLeftKey()&&this._removeInvisibleSpace()},_isRightDownKey:function(){return-1!==[this.keycodes.DOWN,this.keycodes.RIGHT].indexOf(this.key)},_isLeftUpKey:function(){return-1!==[this.keycodes.UP,this.keycodes.LEFT].indexOf(this.key)},_isRightLeftKey:function(){return-1!==[this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(this.key)},_isExitOnDownRightArrow:function(t){var e=this.editor.getElement(),i=this.selection.getCurrent(),n=this.selection.getBlock(i),s=this.inspector.parse(i),r=this.caret.isEnd(n),o=this.caret.isEnd(),a=r&&o;if(s.isTable()){if(r&&this.key===this.keycodes.RIGHT||a){var l=s.getComponent();return this._exitNextElement(t,l)}}else if(s.isFigcaption()){if(n=s.getFigcaption(),a=(r=this.caret.isEnd(n))&&o)return l=s.getComponent(),this._exitNextElement(t,l)}else if(s.isComponentType("code")){if(!(l=s.getComponent()).nextSibling){t.preventDefault();var u=s.getComponentCodeElement();return this._createExitNextMarkup(u),!0}}else if(s.isPre()||s.isBlockquote()||s.isDl()){if(a){if(s.isPre())return this._exitNextElement(t,s.getPre());if(s.isBlockquote())return this._exitNextElement(t,s.getBlockquote());if(s.isDl())return this._exitNextElement(t,s.getDl())}}else if(s.isList()){var h=$R.dom(i).parents("ul, ol",e).last();if(a=(r=this.caret.isEnd(h))&&o)return this._exitNextElement(t,h)}else if(s.isComponent()&&!s.isComponentType("variable")){if(!i.nextElementSibling)return t.preventDefault(),l=s.getComponent(),this._createExitNextMarkup(l),!0;this.component.clearActive()}},_exitNextElement:function(t,e){return t.preventDefault(),e.nextSibling?this.caret.setStart(e.nextSibling):this._createExitNextMarkup(e),!0},_createExitNextMarkup:function(t){var e=document.createElement(this.opts.markup);$R.dom(t).after(e),this.caret.setStart(e)},_removeInvisibleSpace:function(){var t=/^\u200B$/g,e=this.selection.getCurrent(),i=$R.dom(e),n=!!e.previousSibling&&$R.dom(e.previousSibling);this.utils.isEmptyHtml(i.html())&&0===i.text().search(t)&&i.remove(),this.key===this.keycodes.DELETE&&n&&0===n.text().search(t)&&n.remove()},_selectComponent:function(t,e,i){var n=this.selection.getCurrent(),s=this.selection.getBlock(n),r=this._findSiblings(n,i),o=this._findSiblings(s,i);r&&this.caret["is"+e](n)?this._selectComponentItem(t,r,e):o&&this.caret["is"+e](s)&&this._selectComponentItem(t,o,e)},_selectComponentItem:function(t,e,i){var n=this.inspector.parse(e);if(n.isComponent()&&!n.isComponentEditable())return t.preventDefault(),this.caret["set"+i](e),!0},_findSiblings:function(t,e){for(;t=t[e];){var i=!1;if(3!==t.nodeType||this.opts.breakline||(i=""===t.textContent.trim()),!i&&"BR"!==t.tagName)return t}}}),$R.add("class","input.delete",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.caret=t.caret,this.utils=t.utils,this.editor=t.editor,this.marker=t.marker,this.keycodes=t.keycodes,this.component=t.component,this.inspector=t.inspector,this.selection=t.selection,this.key=i,this._init(e)},_init:function(t){if(!this._removeActiveComponent(t)&&!this._removeAllSelectedTable(t)){var e=this.selection.getCurrent(),i=this._getCurrent(),n=this.inspector.parse(i),s=this.caret.isStart(i),r=this.caret.isEnd(i),o=s&&this.key===this.keycodes.BACKSPACE,a=r&&this.key===this.keycodes.DELETE;if(this.key===this.keycodes.BACKSPACE&&e&&this.caret.isStart(e)&&e.previousSibling)return t.preventDefault(),void this.caret.setStart(e.previousSibling);if(this._isNonEditable()||this.selection.hasNonEditable())t.preventDefault();else if(this.key===this.keycodes.BACKSPACE&&this.editor.isEmpty())t.preventDefault();else{if(this.selection.isCollapsed()){if(n.isComponentType("code")&&(o||a))return void t.preventDefault();o?this._removePrev(t,i,n):a&&this._removeNext(t,i,n)}this._removeInvisibleSpace(),this._removeUnwantedStyles(),this._removeEmptySpans(),this._removeSpanTagsInHeadings(),this._removeInlineTagsInPre()}}},_getCurrent:function(){var t=this.editor.getElement(),e=this.selection.getCurrent(),i=this.inspector.parse(e).isList(),n=this.selection.isText(),s=this.selection.getBlock(e);return s=i?$R.dom(e).parents("ul, ol",t).last().get():s,n?e:s},_findSiblings:function(t,e){for(;t=t[e];){var i=!1;if(3!==t.nodeType||this.opts.breakline||(i=""===t.textContent.trim()),!i&&"BR"!==t.tagName)return t}},_removePrev:function(t,e,i){var n=this._findSiblings(e,"previousSibling");if(n){var s=this.inspector.parse(n),r=$R.dom(e),o=$R.dom(n);if(i.isList())if(t.preventDefault(),s.isList())r.children("li").first().prepend(this.marker.build("start")),o.append(r),r.unwrap(),this.selection.restoreMarkers();else{var a=r.children("li").first(),l=a.get(),u=a.find("ul, ol");if("br"===this.opts.markup)r.before(a),a.prepend(this.marker.build("start")),a.prepend("<br>").append("<br>").unwrap(),this.selection.restoreMarkers();else{var h=this.utils.replaceToTag(l,this.opts.markup);r.before(h),this.caret.setStart(h)}0!==u.length&&(r.prepend(u),u.unwrap())}else{if(!i.isFigcaption())return s.isComponentEditable()?(t.preventDefault(),void this.component.remove(n,!1)):s.isComponent()?(t.preventDefault(),this.utils.isEmptyHtml(r.html())&&r.remove(),void this.caret.setStart(n)):void 0;t.preventDefault()}}},_removeNext:function(t,e,i){var n=this._findSiblings(e,"nextSibling");if(n){var s=this.inspector.parse(n),r=$R.dom(e),o=$R.dom(n);if(s.isList()){if(i.isList())return t.preventDefault(),r.append(o),void o.unwrap();var a=o.children("li").first(),l=(a.get(),a.find("ul, ol"));if(0!==l.length)return t.preventDefault(),o.prepend(l),l.unwrap(),r.append(a),void a.unwrap()}else{if(i.isFigcaption())return void t.preventDefault();if(s.isComponentEditable())return t.preventDefault(),void this.component.remove(n,!1);if(s.isComponent())return t.preventDefault(),void this.caret.setStart(n)}}},_removeActiveComponent:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e),n=i.getComponent();if(i.isComponent()&&this.component.isActive(n))return t.preventDefault(),this.component.remove(n),!0},_removeAllSelectedTable:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e).getTable();if(i&&this.selection.isAll(i))return t.preventDefault(),this.component.remove(i),!0},_removeUnwantedStyles:function(){var t=this.editor.getElement();setTimeout(function(){t.find("*[style]").not("img, figure, iframe, [data-redactor-style-cache], [data-redactor-span]").removeAttr("style")},0)},_removeEmptySpans:function(){var t=this.editor.getElement();setTimeout(function(){t.find("span").each(function(t){0===t.attributes.length&&$R.dom(t).replaceWith(t.childNodes)})},0)},_removeInvisibleSpace:function(){var t=/^\u200B$/g,e=this.selection.getCurrent(),i=$R.dom(e),n=!(!e||!e.previousSibling)&&$R.dom(e.previousSibling);this.utils.isEmptyHtml(i.html())&&0===i.text().search(t)&&i.remove(),this.key===this.keycodes.DELETE&&n&&0===n.text().search(t)&&n.remove()},_removeSpanTagsInHeadings:function(){var t=this.editor.getElement();setTimeout(function(){t.find("h1, h2, h3, h4, h5, h6").each(function(t){var e=$R.dom(t);0===e.closest("figure").length&&e.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker").unwrap()})},1)},_removeInlineTagsInPre:function(){var t=this.editor.getElement(),e=this.opts.inlineTags;setTimeout(function(){t.find("pre").each(function(t){var i=$R.dom(t);0===i.closest("figure").length&&i.find(e.join(",")).not("code, .redactor-selection-marker").unwrap()})},1)},_isNonEditable:function(){var t=this.selection.getBlock(),e=this.caret.isStart(t)||this.caret.isEnd(t),i=t&&e?t:this.selection.getCurrent();if(!i)return!1;var n=this.key===this.keycodes.BACKSPACE,s=this._findSiblings(i,n?"previousSibling":"nextSibling"),r=0!==$R.dom(s).closest(".non-editable").length;return!!(n&&this.caret.isStart(i)&&r)||!(n||!this.caret.isEnd(i)||!r)}}),$R.add("class","input.enter",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.caret=t.caret,this.editor=t.editor,this.insertion=t.insertion,this.selection=t.selection,this.inspector=t.inspector,this._init(e)},_init:function(t){return this.opts.enterKey?!1===this.app.broadcast("enter",t)?t.preventDefault():this.selection.hasNonEditable()?void t.preventDefault():t.ctrlKey||t.shiftKey?this._insertBreak(t):void(this._isExit(t)||this._traverse(t)):this._disable(t)},_disable:function(t){t.preventDefault();var e=this.selection.getRange();e&&!e.collapsed&&e.deleteContents()},_insertBreak:function(t){t.preventDefault();var e=this.selection.getCurrent(),i=this.inspector.parse(e);i.isComponent()||i.isCode()||(i.isPre()?this.insertion.insertNewline():this.insertion.insertBreakLine())},_isExit:function(t){var e=this.editor.getElement(),i=this.selection.getCurrent(),n=this.inspector.parse(i),s=this.selection.getBlock(i),r=this.caret.isEnd(s),o=i.previousSibling;if(n.isBlockquote()){var a=r&&this._isExitableBlock(s,"P"),l=r&&o&&"BR"===o.tagName,u=n.getBlockquote();if(a||l)return this._exitFromElement(t,l?o:s,u)}else if(!n.isComponentType("code")&&n.isPre()){if(r&&null!==s.innerHTML.replace(/[\u200B-\u200D\uFEFF]/g,"").match(/(\n\n\n)$/))return $R.dom(o.previousSibling.previousSibling).remove(),void this._exitFromElement(t,o,s)}else if(n.isDl()){if(r&&this._isExitableBlock(s,"DT")){var h=n.getDl();return this._exitFromElement(t,s,h)}}else if(n.isList()){var c=$R.dom(i).parents("ul, ol",e).last();if((r=this.caret.isEnd(c))&&this._isExitableBlock(s,"LI"))return this._exitFromElement(t,s,c)}},_isExitableBlock:function(t,e){return t&&t.tagName===e&&this.utils.isEmptyHtml(t.innerHTML)},_exitFromElement:function(t,e,i){return t.preventDefault(),$R.dom(e).remove(),"br"===this.opts.markup?this.caret.setAfter(i):this._createExitNextMarkup(i),!0},_createExitNextMarkup:function(t){var e=document.createElement(this.opts.markup);$R.dom(t).after(e),this.caret.setStart(e)},_traverse:function(t){var e=this.selection.getCurrent(),i=this.selection.isText(),n=this.inspector.parse(e);if(n.isPre())return t.preventDefault(),this.insertion.insertNewline();if(!n.isBlockquote())return n.isFigcaption()?void t.preventDefault():n.isDl()?(t.preventDefault(),this._traverseDl(e)):i?(t.preventDefault(),this.insertion.insertBreakLine()):void setTimeout(this._replaceBlock.bind(this),1);var s=this.selection.getBlock(e);return s&&"BLOCKQUOTE"===s.tagName?(t.preventDefault(),this.insertion.insertBreakLine()):void 0},_traverseDl:function(t){var e=this.selection.getBlock(t),i=this.inspector.parse(e).getTag(),n=$R.dom(e),s=n.get().nextSibling||!1,r=$R.dom(s),o=s&&r.is("dd"),a=s&&r.is("dt"),l=this.caret.isEnd(e);if("dt"===i&&!o&&l){var u=document.createElement("dd");return n.after(u),void this.caret.setStart(u)}if("dd"===i&&!a&&l){var h=document.createElement("dt");return n.after(h),void this.caret.setStart(h)}return this.insertion.insertBreakLine()},_replaceBlock:function(){var t=this.selection.getBlock(),e=$R.dom(t);if("div"!==this.opts.markup&&t&&this._isNeedToReplaceBlock(t)){var i=document.createElement(this.opts.markup);e.replaceWith(i),this.caret.setStart(i)}else t&&this.utils.isEmptyHtml(t.innerHTML)&&((this.opts.cleanInlineOnEnter||"<br>"===t.innerHTML)&&e.html(""),this.caret.setStart(t));t&&this._isNeedToCleanBlockStyle(t)&&this.opts.cleanOnEnter&&e.removeAttr("class style")},_isNeedToReplaceBlock:function(t){return"DIV"===t.tagName&&this.utils.isEmptyHtml(t.innerHTML)},_isNeedToCleanBlockStyle:function(t){return"P"===t.tagName&&this.utils.isEmptyHtml(t.innerHTML)}}),$R.add("class","input.paste",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.editor=t.editor,this.cleaner=t.cleaner,this.container=t.container,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.autoparser=t.autoparser,this.dataTransfer=i,this._init(e)},_init:function(t){var e=this.dataTransfer||t.clipboardData,i=this.selection.getCurrent(),n=this.inspector.parse(i);if(this.dropPasted=this.dataTransfer,this.isRawCode=n.isPre()||n.isCode(),this.editor.enablePasting(),this.editor.saveScroll(),this.dropPasted||this.selection.saveMarkers(),this.isRawCode||!e)this._getPastedUsingHiddenBox(t);else{var s=e.getData("URL"),r=this._isPlainText(e)?e.getData("text/plain"):e.getData("text/html");r=s&&""!==s?s:r;var o=e.items||e.files,a=!e.items&&e.files;if(o&&""===r){for(var l=[],u=0;u<o.length;u++){var h=a?o[u]:o[u].getAsFile();h&&l.push(h)}if(l.length>0)return t.preventDefault(),void this._insertFiles(t,l)}t.preventDefault(),this._insert(t,r)}},_getPastedUsingHiddenBox:function(t){this._createBox(),setTimeout((function(){var e=this._getCodeFromBox();this._insert(t,e)}).bind(this),1)},_createBox:function(){var t=this.container.getElement();this.$pasteBox=$R.dom(this.isRawCode?"<textarea>":'<div contenteditable="true">'),this.$pasteBox.css({position:"fixed",width:"1px",top:0,left:"-9999px"}),t.append(this.$pasteBox),this.$pasteBox.focus()},_getCodeFromBox:function(){var t=this.isRawCode?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),t},_isPlainText:function(t){var e=t.getData("text/plain"),i=t.getData("text/html");if(!e||!i)return null!=e;var n=document.createElement("div");return n.innerHTML=i,n.textContent===e?!n.querySelector(":not(meta)"):void 0},_restoreSelection:function(){this.editor.restoreScroll(),this.editor.disablePasting(),this.dropPasted||this.selection.restoreMarkers()},_insert:function(t,e){var i;e=void 0===(i=this.app.broadcast("pasteBefore",e))?e:i,e=this.isRawCode?e:this.cleaner.paste(e),e=this.isRawCode?this.cleaner.encodePhpCode(e):e,e=void 0===(i=this.app.broadcast("pasting",e))?e:i,this._restoreSelection(),this.opts.autoparse&&this.opts.autoparsePaste&&(e=this.autoparser.parse(e));var n=this.dropPasted?this.insertion.insertToPoint(t,e):this.insertion.insertHtml(e);this.app.broadcast("pasted",n)},_insertFiles:function(t,e){this._restoreSelection();var i=-1!==this.opts.imageTypes.indexOf(e[0].type);this.app.broadcast(i?"dropimage":"dropfile",t,e,"undefined"==typeof this.dropPasted)}}),$R.add("class","input.shortcode",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.marker=t.marker,this.keycodes=t.keycodes,this.selection=t.selection,this.worked=!1,i===this.keycodes.SPACE&&this._init()},is:function(){return this.worked},_init:function(){var t=this.selection.getCurrent();if(t&&3===t.nodeType){var e=t.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),i=this.opts.shortcodes;for(var n in i){var s=new RegExp("^"+this.utils.escapeRegExp(n));if(null!==e.match(s)&&"undefined"!=typeof i[n].format)return this._format(i[n].format,e,t,s)}}},_format:function(t,e,i,n){var s=(i=this.marker.insertStart().previousSibling).textContent;s=s.replace(n,""),i.textContent=s,this.app.api("ul"===t||"ol"===t?"module.list.toggle":"module.block.format",t),this.selection.restoreMarkers(),this.worked=!0}}),$R.add("class","input.shortcut",{init:function(t,e){this.app=t,this.opts=t.opts,this.worked=!1,this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},this._init(e)},is:function(){return this.worked},_init:function(t){if(!1!==this.opts.shortcuts)for(var e in this.opts.shortcuts)this._build(t,e,this.opts.shortcuts[e]);else!t.ctrlKey&&!t.metaKey||66!==t.which&&73!==t.which||t.preventDefault()},_build:function(t,e,i){for(var n=e.split(","),s=n.length,r=0;r<s;r++)"string"==typeof n[r]&&this._handler(t,n[r].trim(),i)},_handler:function(t,e,i){e=e.toLowerCase().split(" ");for(var n=this.hotkeys[t.keyCode],s=String.fromCharCode(t.which).toLowerCase(),r="",o={},a=["alt","ctrl","meta","shift"],l=0;l<a.length;l++){var u=a[l];t[u+"Key"]&&n!==u&&(r+=u+"+")}n&&(o[r+n]=!0),s&&(o[r+s]=!0,o[r+this.hotkeysShiftNums[s]]=!0,"shift+"===r&&(o[this.hotkeysShiftNums[s]]=!0));var h=e.length;for(l=0;l<h;l++)if(o[e[l]])return t.preventDefault(),this.worked=!0,void(i.message?this.app.broadcast(i.message,i.args):i.api&&this.app.api(i.api,i.args))}}),$R.add("class","input.space",{init:function(t,e,i,n){this.app=t,this.keycodes=t.keycodes,this.insertion=t.insertion,this.selection=t.selection,this.key=i,this.lastShiftKey=n,this._init(e)},_init:function(t){if(!this.selection.hasNonEditable())return this.lastShiftKey||this.key!==this.keycodes.SPACE||!t.ctrlKey&&!t.shiftKey?void 0:(t.preventDefault(),void this.insertion.insertChar("&nbsp;"));t.preventDefault()}}),$R.add("class","input.tab",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this._init(e)},_init:function(t){return this.opts.tabKey?!1===this.app.broadcast("tab",t)?t.preventDefault():void this._traverse(t):this._disable(t)},_disable:function(t){t.preventDefault()},_traverse:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);if(i.isList())return t.preventDefault(),this.app.api("module.list.indent");if(i.isPre()||i.isComponentType("code")&&!i.isFigcaption())return this._tabCode(t);if(!1!==this.opts.tabAsSpaces){t.preventDefault();var n=document.createTextNode(Array(this.opts.tabAsSpaces+1).join("\xa0"));return this.insertion.insertNode(n,"end")}},_tabCode:function(t){t.preventDefault();var e=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join("\xa0")):document.createTextNode("\t");return this.insertion.insertNode(e,"end")}}),$R.add("module","upload",{init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.utils=t.utils,this.editor=t.editor,this.progress=t.progress,this.defaults={event:!1,element:!1,name:!1,files:!1,url:!1,data:!1}},build:function(t){this._build(t)},send:function(t){this.p=$R.extend(this.defaults,t),this.$uploadbox=this.editor.getElement(),this._send(this.p.event,this.p.files)},_build:function(t){this.p=$R.extend(this.defaults,t),this.$el=$R.dom(this.p.element),"INPUT"===this.$el.get().tagName?this._buildInput():this._buildBox()},_buildInput:function(){this.box=!1,this.prefix="",this.$uploadbox=$R.dom('<div class="upload-box" />'),this.$el.hide(),this.$el.after(this.$uploadbox),this._buildPlaceholder(),this._buildEvents()},_buildBox:function(){this.box=!0,this.prefix="box-",this.$uploadbox=this.$el,this.$uploadbox.on("drop.redactor.upload",this._onDropBox.bind(this)),this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this)),this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_buildPlaceholder:function(){this.$placeholder=$R.dom('<div class="upload-placeholder" />'),this.$placeholder.html(this.lang.get("upload-label")),this.$uploadbox.append(this.$placeholder)},_buildEvents:function(){this.$el.on("change.redactor.upload",this._onChange.bind(this)),this.$uploadbox.on("click.redactor.upload",this._onClick.bind(this)),this.$uploadbox.on("drop.redactor.upload",this._onDrop.bind(this)),this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this)),this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_onClick:function(t){t.preventDefault(),this.$el.click()},_onChange:function(t){this.app.broadcast("upload.start"),this._send(t,this.$el.get().files)},_onDrop:function(t){t.preventDefault(),this._clear(),this._setStatusDrop(),this.app.broadcast("upload.start"),this._send(t)},_onDragOver:function(t){return t.preventDefault(),this._setStatusHover(),!1},_onDragLeave:function(t){return t.preventDefault(),this._removeStatusHover(),!1},_onDropBox:function(t){t.preventDefault(),this._clear(),this._setStatusDrop(),this.app.broadcast("upload.start"),this._send(t)},_removeStatusHover:function(){this.$uploadbox.removeClass("upload-"+this.prefix+"hover")},_setStatusDrop:function(){this.$uploadbox.addClass("upload-"+this.prefix+"drop")},_setStatusHover:function(){this.$uploadbox.addClass("upload-"+this.prefix+"hover")},_setStatusError:function(){this.$uploadbox.addClass("upload-"+this.prefix+"error")},_setStatusSuccess:function(){this.$uploadbox.addClass("upload-"+this.prefix+"success")},_clear:function(){for(var t=["drop","hover","error","success"],e=0;e<t.length;e++)this.$uploadbox.removeClass("upload-"+this.prefix+t[e])},_getParamName:function(){return this.opts.uploadParamName?this.opts.uploadParamName:"file"},_send:function(t,e){t=t.originalEvent||t,e=e||t.dataTransfer.files;var i=new FormData,n=this._getParamName();i=this._buildData(n,e,i),i=this.utils.extendData(i,this.p.data),this._sendData(i,t)},_sendData:function(t,e){this.progress.show(),"function"==typeof this.p.url?(this.p.url(t,e),this.progress.hide()):$R.ajax.post({url:this.p.url,data:t,headers:{Authorization:`Bearer ${this.opts.accessToken}`},before:(function(t){return this.app.broadcast("upload.beforeSend",t)}).bind(this),success:(function(t){t[this.opts.imageUploadParam]||(t={[this.opts.imageUploadParam]:t}),this._complete(t,e)}).bind(this)})},_buildData:function(t,e,i){if(1===e.length)i.append(t,e[0]);else if(e.length>1&&!1!==this.opts.multipleUpload)for(var n=0;n<e.length;n++)i.append(t+"-"+n,e[n]);return i},_complete:function(t,e){this._clear(),this.progress.hide(),t&&t.error?(this._setStatusError(),this.app.broadcast("upload."+this.p.name+".error",t,e),this.app.broadcast("upload.error",t)):(this._setStatusSuccess(),this.app.broadcast("upload."+this.p.name+".complete",t,e),this.app.broadcast("upload.complete",t),setTimeout(this._clear.bind(this),500))}}),$R.add("class","code.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&void 0!==e.cmnt?e:this._init(e)},_init:function(t){var e;if("undefined"!=typeof t){var i=$R.dom(t).closest("figure");0!==i.length?this.parse(i):(this.parse("<figure>"),this.append(t)),e=this.find("pre code, pre").last()}else e=$R.dom("<pre>"),this.parse("<figure>"),this.append(e);this._initElement(e),this._initWrapper()},_initElement:function(t){t.attr({tabindex:"-1",contenteditable:!0})},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"code",tabindex:"-1",contenteditable:!1})}}),$R.add("module","form",{init:function(t){this.app=t,this.lang=t.lang,this.component=t.component,this.inspector=t.inspector},onform:{remove:function(t){this._remove(t)}},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("form")){var n=i.getComponent(),s={remove:{title:this.lang.get("delete"),api:"module.form.remove",args:n}};e.set(t,n,s,"top")}},_remove:function(t){this.component.remove(t)}}),$R.add("class","form.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.utils=t.utils,e&&void 0!==e.cmnt?e:this._init(e)},_init:function(t){if("undefined"!=typeof t)if(0!==$R.dom(t).closest("form").length){var e=this.utils.replaceToTag(t,"figure");this.parse(e)}else this.parse("<figure>"),this.append(t);else this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"form",tabindex:"-1",contenteditable:!1})}}),$R.add("module","image",{modals:{image:'<div class="redactor-modal-tab" data-title="## upload ##"><form action="">                 <input type="file" name="file" multiple>             </form></div>',imageedit:'<div class="redactor-modal-group">                 <div id="redactor-modal-image-preview" class="redactor-modal-side"></div>                 <form action="" class="redactor-modal-area">             \t\t<div class="form-item">             \t\t\t<label> ## title ##</label>             \t\t\t<input type="text" name="title" />             \t\t</div>             \t\t<div class="form-item form-item-caption">             \t\t\t<label>## caption ##</label>             \t\t\t<input type="text" name="caption" aria-label="## caption ##" />             \t\t</div>             \t\t<div class="form-item">             \t\t\t<label>## link ##</label>             \t\t\t<input type="text" name="url" aria-label="## link ##" />             \t\t</div>             \t\t<div class="form-item form-item-align">             \t\t\t<label>## image-position ##</label>             \t\t\t<select name="align" aria-label="## image-position ##">             \t\t\t\t<option value="none">## none ##</option>             \t\t\t\t<option value="left">## left ##</option>             \t\t\t\t<option value="center">## center ##</option>             \t\t\t\t<option value="right">## right ##</option>             \t\t\t</select>             \t\t</div>             \t\t<div class="form-item">             \t\t\t<label class="checkbox"><input type="checkbox" name="target" aria-label="## link-in-new-tab ##"> ## link-in-new-tab ##</label>             \t\t</div>                 </form>             </div>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.editor=t.editor,this.storage=t.storage,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection},onstarted:function(){this.storage.markImages(),this.storage.observeImages(),this.opts.imageResizable&&(this.resizer=$R.create("image.resize",this.app))},ondropimage:function(t,e,i){this.opts.imageUpload&&this.app.api("module.upload.send",{url:this.opts.imageUpload,event:!i&&t,files:e,name:"imagedrop",data:this.opts.imageData})},onstop:function(){this.resizer&&this.resizer.stop()},onimageresizer:{stop:function(){this.resizer&&this.resizer.stop()}},onsource:{open:function(){this.resizer&&this.resizer.stop()}},onupload:{image:{complete:function(t){this._insert(t)},error:function(t){this._uploadError(t)}},imageedit:{complete:function(t){this._change(t)},error:function(t){this._uploadError(t)}},imagedrop:{complete:function(t,e){this._insert(t,e)},error:function(t){this._uploadError(t)}}},onmodal:{image:{open:function(t,e){this._setUpload(e)}},imageedit:{open:function(t,e){this._setFormData(t,e)},opened:function(t,e){this._setFormFocus(e)},remove:function(t,e){this._remove(this.$image)},save:function(t,e){this._save(t,e)}}},oncontextbar:function(t,e){var i=this.selection.getCurrent(),n=this.inspector.parse(i);if(!n.isFigcaption()&&n.isComponentType("image")){var s=n.getComponent(),r={edit:{title:this.lang.get("edit"),api:"module.image.open"},remove:{title:this.lang.get("delete"),api:"module.image.remove",args:s}};e.set(t,s,r)}},open:function(){this.$image=this._getCurrent(),this.app.api("module.modal.build",this._getModalData())},insert:function(t){this._insert(t)},remove:function(t){this._remove(t)},_getModalData:function(){return this._isImage()&&this.opts.imageEditable?{name:"imageedit",width:"800px",title:this.lang.get("edit"),handle:"save",commands:{save:{title:this.lang.get("save")},remove:{title:this.lang.get("delete"),type:"danger"},cancel:{title:this.lang.get("cancel")}}}:{name:"image",title:this.lang.get("image")}},_isImage:function(){return this.$image},_getCurrent:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t);return!(!e.isComponentType("image")||!e.isComponentActive())&&this.component.create("image",e.getComponent())},_insert:function(t,e){if(this.app.api("module.modal.close"),"object"==typeof t){var i,n,s=0,r=Object.keys(t).length,o=r>1;for(var a in t){if(s++,(i=this.component.create("image")).setData({src:t[a].url,id:t[a].id?t[a].id:this.utils.getRandomId()}),this.storage.add("image",i.getElement()),1===s?(n=e?this.insertion.insertToPoint(e,i):this.insertion.insertHtml(i),o&&this.caret.setAfter(n)):(n=this.insertion.insertHtml(i),o&&s<=r&&this.caret.setAfter(n)),!n[0].nextSibling){var l=document.createElement(this.opts.markup);n[0].after(l),this.caret.setStart(l)}this.app.broadcast("image.uploaded",n,t)}}},_save:function(t,e){var i=e.getData(),n={title:i.title,link:{url:i.url,target:i.target}};this.opts.imageCaption&&(n.caption=i.caption),this.opts.imagePosition&&(n.align=i.align),this.$image.setData(n),this.resizer&&this.resizer.rebuild(),this.app.broadcast("image.changed",this.$image),this.app.api("module.modal.close")},_change:function(t){if("object"==typeof t){var e;for(var i in t){(e=$R.dom("<img>")).attr("src",t[i].url),this.$image.changeImage(t[i]),this.app.broadcast("image.changed",this.$image,t),this.app.broadcast("image.uploaded",this.$image,t);break}e.on("load",(function(){this.$previewBox.html(e)}).bind(this))}},_uploadError:function(t){this.app.broadcast("image.uploadError",t)},_remove:function(t){this.app.api("module.modal.close"),this.component.remove(t)},_setFormData:function(t,e){this._buildPreview();var i=this.$image.getData(),n={title:i.title};this.opts.imageCaption?n.caption=i.caption:t.find(".form-item-caption").hide(),this.opts.imagePosition?n.align=i.align:t.find(".form-item-align").hide(),i.link&&(n.url=i.link.url,i.link.target&&(n.target=!0)),e.setData(n)},_setFormFocus:function(t){t.getField("title").focus()},_setUpload:function(t){var e={url:this.opts.imageUpload,element:t.getField("file"),name:"image",data:this.opts.imageData};this.app.api("module.upload.build",e)},_buildPreview:function(){this.$preview=$R.dom("#redactor-modal-image-preview");var t=this.$image.getData(),e=$R.dom("<img>");e.attr("src",t.src);var i=$R.dom('<div class="desc">');i.html("Drop a new image to change"),this.$previewBox=$R.dom("<div>"),this.$previewBox.append(e),this.$preview.html(""),this.$preview.append(this.$previewBox),this.$preview.append(i),this.app.api("module.upload.build",{url:this.opts.imageUpload,element:this.$previewBox,name:"imageedit"})}}),$R.add("class","image.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,e&&void 0!==e.cmnt?e:this._init(e)},setData:function(t){for(var e in t)this._set(e,t[e])},getData:function(){for(var t=["src","title","caption","align","link","id"],e={},i=0;i<t.length;i++)e[t[i]]=this._get(t[i]);return e},getElement:function(){return this.$element},changeImage:function(t){this.$element.attr("src",t.url)},_init:function(t){var e=$R.dom(t),i=e.closest("figure");void 0===t?(this.$element=$R.dom("<img>"),this.parse("<figure>"),this.append(this.$element)):0===i.length?(this.parse("<figure>"),this.$element=e,this.$element.wrap(this)):(this.parse(i),this.$element=this.find("img")),this._initWrapper()},_set:function(t,e){this["_set_"+t](e)},_get:function(t){return this["_get_"+t]()},_set_src:function(t){this.$element.attr("src",t)},_set_id:function(t){this.$element.attr("data-image",t)},_set_title:function(t){""===(t=t.trim().replace(/(<([^>]+)>)/gi,""))?(this.$element.removeAttr("alt"),this.$element.removeAttr("title")):(this.$element.attr("alt",t),this.$element.attr("title",t))},_set_caption:function(t){var e=this.find("figcaption");return 0===e.length&&((e=$R.dom("<figcaption>")).attr("contenteditable","true"),this.append(e)),""===t?e.remove():e.html(t),e},_set_align:function(t){var e="",i="",n="";switch(t){case"left":e="left",i="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":e="right",i="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":n="center"}this.css({float:e,margin:i,"text-align":n}),this.attr("rel",this.attr("style"))},_set_link:function(t){var e=this.find("a");return""===t.url?e.unwrap():(0===e.length&&(e=$R.dom("<a>"),this.$element.wrap(e)),e.attr("href",t.url),t.target?e.attr("target",t.target):e.removeAttr("target"),e)},_get_src:function(){return this.$element.attr("src")},_get_id:function(){return this.$element.attr("data-image")},_get_title:function(){var t=this.$element.attr("alt"),e=this.$element.attr("title");return t||e||""},_get_caption:function(){var t=this.find("figcaption");return 0===t.length?"":t.text()},_get_align:function(){return"center"===this.css("text-align")?"center":this.css("float")},_get_link:function(){var t=this.find("a");if(0!==t.length){var e=!!t.attr("target");return{url:t.attr("href"),target:e}}},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"image",tabindex:"-1",contenteditable:!1})}}),$R.add("class","image.resize",{init:function(t){this.app=t,this.$doc=t.$doc,this.$body=t.$body,this.editor=t.editor,this.inspector=t.inspector,this._init()},rebuild:function(){this._setResizerPosition()},stop:function(){this.editor.getElement().off(".redactor.image-resize"),this.$doc.off(".redactor.image-resize"),this.$body.find("#redactor-image-resizer").remove()},_init:function(){this.editor.getElement().on("click.redactor.image-resize",this._build.bind(this))},_build:function(t){this.$body.find("#redactor-image-resizer").remove();var e=this.inspector.parse(t.target),i=this.editor.getElement();e.isComponentType("image")&&(this.$resizableBox=i,this.$resizableImage=$R.dom(e.getImageElement()),this.$resizer=$R.dom("<span>"),this.$resizer.attr("id","redactor-image-resizer"),this.$body.append(this.$resizer),this._setResizerPosition(),this.$resizer.on("mousedown touchstart",this._set.bind(this)))},_setResizerPosition:function(){var t=this.$resizableImage.offset(),e=this.$resizableImage.width(),i=this.$resizableImage.height(),n=this.$resizer.width(),s=this.$resizer.height();this.$resizer.css({top:t.top+i-s+7+"px",left:t.left+e-n+7+"px"})},_set:function(t){t.preventDefault(),this.resizeHandle={x:t.pageX,y:t.pageY,el:this.$resizableImage,ratio:this.$resizableImage.width()/this.$resizableImage.height(),h:this.$resizableImage.height()},(t=t.originalEvent||t).targetTouches&&(this.resizeHandle.x=t.targetTouches[0].pageX,this.resizeHandle.y=t.targetTouches[0].pageY),this.app.broadcast("contextbar.close"),this.app.broadcast("image.resize",this.$resizableImage),this._start()},_start:function(){this.$doc.on("mousemove.redactor.image-resize touchmove.redactor.image-resize",this._move.bind(this)),this.$doc.on("mouseup.redactor.image-resize touchend.redactor.image-resize",this._stop.bind(this))},_stop:function(){this.$doc.off(".redactor.image-resize"),this.$body.find("#redactor-image-resizer").remove(),this.app.broadcast("image.resized",this.$resizableImage)},_move:function(t){t.preventDefault();var e=this.resizeHandle.h,i=(e+=(t=t.originalEvent||t).targetTouches?t.targetTouches[0].pageY-this.resizeHandle.y:t.pageY-this.resizeHandle.y)*this.resizeHandle.ratio;e<50||i<100||this._getResizableBoxWidth()<=i||(this.resizeHandle.el.attr({width:i,height:e}),this.resizeHandle.el.width(i),this.resizeHandle.el.height(e),this._setResizerPosition())},_getResizableBoxWidth:function(){return this.$resizableBox.width()-parseInt(this.$resizableBox.css("padding-left"))-parseInt(this.$resizableBox.css("padding-right"))}}),$R.add("module","file",{modals:{file:'<div class="redactor-modal-tab" data-title="## upload ##"><form action="">                 <div class="form-item form-item-title">             \t\t<label> ## filename ## <span class="desc">(## optional ##)</span></label>                     <input type="text" name="title" />                 </div>                 <input type="file" name="file" multiple>             </form></div>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.storage=t.storage,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection},onstarted:function(){this.storage.observeFiles()},ondropfile:function(t,e,i){this.opts.fileUpload&&this.app.api("module.upload.send",{url:this.opts.fileUpload,event:!i&&t,files:e,name:"filedrop",data:this.opts.fileData})},onmodal:{file:{open:function(t,e){this._setFormData(t,e),this._setUpload(e)},opened:function(t,e){this._setFormFocus(e),this.$form=e}}},onupload:{file:{complete:function(t){this._insert(t)},error:function(t){this._uploadError(t)}},filedrop:{complete:function(t,e){this._insert(t,e)},error:function(t){this._uploadError(t)}}},oncontextbar:function(t,e){var i=this.selection.getCurrent(),n=this.inspector.parse(i);if(n.isFile()){var s=n.getFile(),r={remove:{title:this.lang.get("delete"),api:"module.file.remove",args:s}};e.set(t,s,r,"bottom")}},open:function(){this._open()},insert:function(t){this._insert(t)},remove:function(t){this._remove(t)},_open:function(){this.app.api("module.modal.build",this._getModalData())},_getModalData:function(){return{name:"file",title:this.lang.get("file")}},_insert:function(t,e){if(this.app.api("module.modal.close"),"object"==typeof t){var i,n,s=!!this.$form&&this.$form.getData(),r=0,o=Object.keys(t).length,a=o>1;for(var l in t){r++;var u=!this.opts.fileAttachment&&s&&""!==s.title?s.title:this._truncateUrl(t[l].name?t[l].name:t[l].url);if((i=this.component.create("file")).attr("href",t[l].url),i.attr("data-file",t[l].id?t[l].id:this.utils.getRandomId()),i.attr("data-name",t[l].name),i.html(u),this.storage.add("file",i),this.opts.fileAttachment){var h=$R.dom(this.opts.fileAttachment),c=i.wrapAttachment();h.append(c),n=c.get(),this.app.broadcast("file.appended",n,t)}else 1===r?(n=e?this.insertion.insertToPoint(e,i):this.insertion.insertRaw(i),a&&this.caret.setAfter(n)):(this.insertion.insertRaw(i),a&&r<=o&&this.caret.setAfter(n));this.app.broadcast("file.uploaded",n,t)}this.$form=!1}},_remove:function(t){this.selection.save();var e=this.component.create("file",t);!1!==this.app.broadcast("file.delete",e)?(e.unwrap(),this.selection.restore(),this.app.broadcast("file.deleted",e)):this.selection.restore()},_truncateUrl:function(t){return t.length>20?t.substring(0,20)+"...":t},_setUpload:function(t){var e={url:this.opts.fileUpload,element:t.getField("file"),name:"file",data:this.opts.fileData};this.app.api("module.upload.build",e)},_setFormData:function(t,e){this.opts.fileAttachment?t.find(".form-item-title").hide():e.setData({title:this.selection.getText()})},_setFormFocus:function(t){t.getField("title").focus()},_uploadError:function(t){this.app.broadcast("file.uploadError",t)}}),$R.add("class","file.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,e&&void 0!==e.cmnt?e:this._init(e)},wrapAttachment:function(){return this.$wrapper=$R.dom('<span class="redactor-file-item">'),this.$remover=$R.dom('<span class="redactor-file-remover">'),this.$remover.html("&times;"),this.$remover.on("click",this.removeAttachment.bind(this)),this.$wrapper.append(this),this.$wrapper.append(this.$remover),this.$wrapper},removeAttachment:function(t){t.preventDefault(),!1!==this.app.broadcast("file.delete",this,this.$wrapper)&&(this.$wrapper.remove(),this.app.broadcast("file.deleted",this),this.app.broadcast("file.removeAttachment",this))},_init:function(t){if(void 0===t)this.parse("<a>");else{var e=$R.dom(t).closest("a");this.parse(e)}}}),$R.add("module","buffer",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.offset=t.offset,this.keycodes=t.keycodes,this.selection=t.selection,this.state=!1,this.passed=!1,this.keyPressed=!1,this.savedHtml=!1,this.savedOffset=!1,this.undoStorage=[],this.redoStorage=[]},onkeydown:function(t){this._listen(t)},onsyncing:function(){this.keyPressed||this.trigger(),this.keyPressed=!1},onstate:function(t,e,i){t&&(t.ctrlKey||t.metaKey)||t&&(this._isUndo(t)||this._isRedo(t))||(this.passed=!1,this._saveState(e,i))},onenable:function(){this.clear()},clear:function(){this.state=!1,this.undoStorage=[],this.redoStorage=[]},undo:function(){this._getUndo()},redo:function(){this._getRedo()},trigger:function(){this.state&&!1===this.passed&&this._setUndo()},_saveState:function(t,e){var i=this.editor.getElement();this.state={html:t||i.html(),offset:e||this.offset.get()}},_listen:function(t){var e=t.which,i=t.ctrlKey||t.metaKey,n=i||t.shiftKey||t.altKey,s=[this.keycodes.SPACE,this.keycodes.ENTER,this.keycodes.BACKSPACE,this.keycodes.DELETE,this.keycodes.TAB,this.keycodes.LEFT,this.keycodes.RIGHT,this.keycodes.UP,this.keycodes.DOWN];return this._isUndo(t)?(t.preventDefault(),void this.undo()):this._isRedo(t)?(t.preventDefault(),void this.redo()):(i||-1===s.indexOf(e)||(n=!0,this.trigger()),n=!0,this.trigger(),n||this._hasUndo()||this.trigger(),void(this.keyPressed=!0))},_isUndo:function(t){return(t.ctrlKey||t.metaKey)&&90===t.which&&!t.shiftKey&&!t.altKey},_isRedo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&(90===e&&t.shiftKey||89===e&&!t.shiftKey)&&!t.altKey},_setUndo:function(){var t=this.undoStorage[this.undoStorage.length-1];"undefined"!=typeof t&&t[0]===this.state.html||(this.undoStorage.push([this.state.html,this.state.offset]),this._removeOverStorage())},_setRedo:function(){var t=this.editor.getElement(),e=this.offset.get(),i=t.html();this.redoStorage.push([i,e]),this.redoStorage=this.redoStorage.slice(0,this.opts.bufferLimit)},_getUndo:function(){if(this._hasUndo()){this.passed=!0;var t=this.editor.getElement(),e=this.undoStorage.pop();this._setRedo(),t.html(e[0]),this.offset.set(e[1]),this.selection.restore(),this.app.broadcast("undo",e[0],e[1])}},_getRedo:function(){if(this._hasRedo()){this.passed=!0;var t=this.editor.getElement(),e=this.redoStorage.pop();this._setUndo(),t.html(e[0]),this.offset.set(e[1]),this.app.broadcast("redo",e[0],e[1])}},_removeOverStorage:function(){this.undoStorage.length>this.opts.bufferLimit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-this.opts.bufferLimit))},_hasUndo:function(){return 0!==this.undoStorage.length},_hasRedo:function(){return 0!==this.redoStorage.length}}),$R.add("module","list",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.toolbar=t.toolbar,this.inspector=t.inspector,this.selection=t.selection},onbutton:{list:{observe:function(t){this._observeButton(t)}}},ondropdown:{list:{observe:function(t){this._observeDropdown(t)}}},toggle:function(t){this.selection.saveMarkers();var e=this._getBlocks(),i=this.selection.getBlock(),n=$R.dom(i).parents("ul, ol",".redactor-in").last();return 0===e.length&&0!==n.length&&(e=[n.get()]),e=this._isUnformat(t,e)?this._unformat(t,e):this._format(t,e),this.selection.restoreMarkers(),e},indent:function(){var t=this.selection.isCollapsed(),e=this.selection.getCurrent(),i=this.inspector.parse(e),n=!!i.isList()&&i.getListItem(),s=$R.dom(n),r=(o=s.prevElement()).get();if(t&&n&&r&&"LI"===r.tagName){this.selection.save();var o,a=(o=$R.dom(r)).children("ul, ol"),l=s.closest("ul, ol");if(0!==a.length)a.append(s);else{var u=l.get().tagName.toLowerCase(),h=$R.dom("<"+u+">");h.append(s),o.append(h)}this.selection.restore()}},outdent:function(){var t=this.selection.isCollapsed(),e=this.selection.getCurrent(),i=this.inspector.parse(e),n=!!i.isList()&&i.getListItem(),s=$R.dom(n);if(t&&n){var r=s.parent(),o=r.closest("li"),a=s.prevElement(),l=s.nextElement(),u=a.get(),h=l.get(),c=!1===u,d=!1!==u&&!1!==h,p=!c&&!1===h;if(this.selection.save(),0!==o.length)if(d){for(var f=this._getAllNext(s.get()),m=$R.dom("<"+r.get().tagName.toLowerCase()+">"),g=0;g<f.length;g++)m.append(f[g]);o.after(s),s.append(m)}else o.after(s),0===r.children().length?r.remove():c&&s.append(r);else{var v=this._createUnformatContainer(s),b=v.find("ul, ol").first();if(c)r.before(v);else if(p)r.after(v);else if(d){for(m=$R.dom("<"+r.get().tagName.toLowerCase()+">"),f=this._getAllNext(s.get()),g=0;g<f.length;g++)m.append(f[g]);r.after(v),v.after(m)}if(0!==b.length){var y=v.nextElement().get();y&&y.tagName===r.get().tagName?($R.dom(y).prepend(b),b.unwrap()):v.after(b)}v.hasClass("redactor-list-item-container")&&v.replaceWith(v.contents()),s.remove()}this.selection.restore()}},_getAllNext:function(t){for(var e=[];t;){if(!(t=$R.dom(t).nextElement().get()))return e;e.push(t)}return e},_isUnformat:function(t,e){for(var i=0,n=0;n<e.length;n++)if(3!==e[n].nodeType){var s=e[n].tagName.toLowerCase();s!==t&&"figure"!==s||i++}return i===e.length},_format:function(t,e){var i=this._uniteBlocks(e,["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6","ul","ol"]),n=[];for(var s in i){for(var r=i[s],o=this._createList(t,i[s]),a=0;a<r.length;a++){var l;if(3===r[a].nodeType||"UL"!==r[a].tagName&&"OL"!==r[a].tagName)l=this._createListItem(r[a]),this.utils.normalizeTextNodes(l),o.append(l);else{var u=$R.dom(r[a]);l=u.contents(),o.append(l),this.utils.isEmpty(u)&&u.remove()}}n.push(o.get())}return n},_uniteBlocks:function(t,e){for(var i=0,n={0:[]},s=!1,r=0;r<t.length;r++){var o=$R.dom(t[r]).closest("th, td");0!==o.length?(o.get()!==s&&(n[++i]=[]),this._isUniteBlock(t[r],e)&&n[i].push(t[r])):this._isUniteBlock(t[r],e)?n[i].push(t[r]):n[++i]=[],s=o.get()}return n},_isUniteBlock:function(t,e){return 3===t.nodeType||-1!==e.indexOf(t.tagName.toLowerCase())},_createList:function(t,e,i){var n=$R.dom(e[e.length-1]),s=$R.dom("<"+t+">");return n.after(s),s},_createListItem:function(t){var e=$R.dom("<li>");if(3===t.nodeType)e.append(t);else{var i=$R.dom(t);e.append(i.contents()),i.remove()}return e},_unformat:function(t,e){if(1===e.length){var i=$R.dom(e[0]),n=i.find("li"),s=this.selection.getNodes({tags:["li"]}),r=this.selection.getBlock(),o=$R.dom(r).closest("li");if(0===s.length&&0!==o.length&&(s=[o.get()]),s.length===n.length)return this._unformatEntire(e[0]);var a=this._getItemsPosition(n,s);if("Top"===a)return this._unformatAtSide("before",s,i);if("Bottom"===a)return s.reverse(),this._unformatAtSide("after",s,i);if("Middle"===a){var l=$R.dom(s[s.length-1]),u=!1,h=!1,c=$R.dom("<"+i.get().tagName.toLowerCase()+">");n.each(function(t){if(u){var e=$R.dom(t);e.children("ul, ol"),0!==e.closest(".redactor-split-item").length||!1!==h&&0!==e.closest(h).length||e.addClass("redactor-split-item"),h=e}t===l.get()&&(u=!0)}),n.filter(".redactor-split-item").each(function(t){$R.dom(t).removeClass("redactor-split-item"),c.append(t)}),i.after(c),s.reverse();for(var d=0;d<s.length;d++){var p=$R.dom(s[d]),f=this._createUnformatContainer(p);i.after(f),f.find("ul, ol").remove(),p.remove()}return}}else for(d=0;d<e.length;d++)3!==e[d].nodeType&&e[d].tagName.toLowerCase()===t&&this._unformatEntire(e[d])},_unformatEntire:function(t){var e=$R.dom(t);e.find("li").each((function(t){var i=$R.dom(t),n=this._createUnformatContainer(i);i.remove(),e.before(n)}).bind(this)),e.remove()},_unformatAtSide:function(t,e,i){for(var n=0;n<e.length;n++){var s=$R.dom(e[n]),r=this._createUnformatContainer(s);i[t](r);var o=r.find("ul, ol").first();s.append(o),o.each(function(t){var i=$R.dom(t),s=i.closest("li");s.get()===e[n]&&(i.unwrap(),s.addClass("r-unwrapped"))}),this.utils.isEmptyHtml(s.html())&&s.remove()}i.find(".r-unwrapped").each(function(t){var e=$R.dom(t);""===e.html().trim()?e.remove():e.removeClass("r-unwrapped")})},_getItemsPosition:function(t,e){var i="Middle",n=e[0],s=e[e.length-1],r=t.first().get(),o=t.last().get();return r===n&&o!==s?i="Top":r!==n&&o===s&&(i="Bottom"),i},_createUnformatContainer:function(t){var e;return"br"===this.opts.markup?(t.append("<br>"),e=$R.dom('<div class="redactor-list-item-container">')):e=$R.dom("<"+this.opts.markup+">"),e.append(t.contents()),e},_getBlocks:function(t){return this.selection.getBlocksAndTextNodes({first:!0,cells:!0,wrap:!0})},_observeButton:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e),n=i.isPre()||i.isCode()||i.isFigcaption();this._observeButtonsList(n,["lists","ul","ol","outdent","indent"]);var s=this.toolbar.getButton("outdent"),r=this.toolbar.getButton("indent");this._observeIndent(r,s)},_observeDropdown:function(t){var e=t.getItem("outdent"),i=t.getItem("indent");this._observeIndent(i,e)},_observeIndent:function(t,e){var i=this.selection.isCollapsed(),n=this.selection.getCurrent(),s=this.inspector.parse(n),r=!!s.isList()&&s.getListItem(),o=$R.dom(r).prevElement().get(),a=i&&r&&o&&"LI"===o.tagName;e&&(r&&i?e.enable():e.disable()),t&&(r&&a?t.enable():t.disable())},_observeButtonsList:function(t,e){for(var i=0;i<e.length;i++){var n=this.toolbar.getButton(e[i]);n&&(t?n.disable():n.enable())}}}),window.Redactor=window.$R=$R}(),window.addEventListener("load",function(){$R("[data-redactor]")}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.jss={})}(this,function(t){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i="object"===("undefined"==typeof window?"undefined":e(window))&&"object"===("undefined"==typeof document?"undefined":e(document))&&9===document.nodeType;function n(t,e){t.renderable=e,t.rules&&e.cssRules&&t.rules.link(e.cssRules)}var s="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},r=function(){},o=function(t,e){for(var i="",n=0;n<t.length&&"!important"!==t[n];n++)i&&(i+=e),i+=t[n];return i};function a(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(t))return t;var i="";if(Array.isArray(t[0]))for(var n=0;n<t.length&&"!important"!==t[n];n++)i&&(i+=", "),i+=o(t[n]," ");else i=o(t,", ");return e||"!important"!==t[t.length-1]||(i+=" !important"),i}function l(t,e){for(var i="",n=0;n<e;n++)i+="  ";return i+t}function u(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n="";if(!e)return n;var s=i.indent,r=void 0===s?0:s,o=e.fallbacks;if(r++,o)if(Array.isArray(o))for(var u=0;u<o.length;u++){var h=o[u];for(var c in h){var d=h[c];null!=d&&(n+="\n"+l(c+": "+a(d)+";",r))}}else for(var p in o){var f=o[p];null!=f&&(n+="\n"+l(p+": "+a(f)+";",r))}for(var m in e){var g=e[m];null!=g&&"fallbacks"!==m&&(n+="\n"+l(m+": "+a(g)+";",r))}return n||i.allowEmpty?n=l(t+" {"+n+"\n",--r)+l("}",r):n}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},f=function(){function t(e,i,n){c(this,t),this.type="style",this.isProcessed=!1;var s=n.sheet,r=n.Renderer,o=n.selector;this.key=e,this.options=n,this.style=i,o&&(this.selectorText=o),this.renderer=s?s.renderer:new r}return d(t,[{key:"prop",value:function(t,e){if(void 0===e)return this.style[t];if(this.style[t]===e)return this;var i=null==(e=this.options.jss.plugins.onChangeValue(e,t,this))||!1===e,n=t in this.style;if(i&&!n)return this;var s=i&&n;if(s?delete this.style[t]:this.style[t]=e,this.renderable)return s?this.renderer.removeProperty(this.renderable,t):this.renderer.setProperty(this.renderable,t,e),this;var o=this.options.sheet;return o&&o.attached&&r(!1,'Rule is not linked. Missing sheet option "link: true".'),this}},{key:"applyTo",value:function(t){var e=this.toJSON();for(var i in e)this.renderer.setProperty(t,i,e[i]);return this}},{key:"toJSON",value:function(){var t={};for(var e in this.style){var i=this.style[e];"object"!==(void 0===i?"undefined":h(i))?t[e]=i:Array.isArray(i)&&(t[e]=a(i))}return t}},{key:"toString",value:function(t){var e=this.options.sheet,i=e&&e.options.link?p({},t,{allowEmpty:!0}):t;return u(this.selector,this.style,i)}},{key:"selector",set:function(t){if(t!==this.selectorText&&(this.selectorText=t,this.renderable&&!this.renderer.setSelector(this.renderable,t)&&this.renderable)){var e=this.renderer.replaceRule(this.renderable,this);e&&(this.renderable=e)}},get:function(){return this.selectorText}}]),t}();function m(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function g(t,e){return t(e={exports:{}},e.exports),e.exports}var v=g(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e,i=t.Symbol;return"function"==typeof i?i.observable?e=i.observable:(e=i("observable"),i.observable=e):e="@@observable",e}});m(v);var b=g(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i,n,r=(i=v)&&i.__esModule?i:{default:i};n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s?s:t;var o=(0,r.default)(n);e.default=o});m(b);var y=b,_=function(t){return t&&t[y]&&t===t[y]()},x=Array.isArray;function k(t){if(null==t)return t;var e=void 0===t?"undefined":h(t);if("string"===e||"number"===e||"function"===e)return t;if(x(t))return t.map(k);if(_(t))return t;var i={};for(var n in t){var s=t[n];i[n]="object"!==(void 0===s?"undefined":h(s))?s:k(s)}return i}function $(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unnamed",e=arguments[2],i=e.jss,n=k(arguments[1]);return i.plugins.onCreateRule(t,n,e)||("@"===t[0]&&r(!1,"[JSS] Unknown at-rule %s",t),new f(t,n,e))}var C=function(t){return t},R=function(){function t(e){var i=this;c(this,t),this.map={},this.raw={},this.index=[],this.update=function(t,e){var n=i.options,s=n.jss.plugins,r=n.sheet;if("string"==typeof t)s.onUpdate(e,i.get(t),r);else for(var o=0;o<i.index.length;o++)s.onUpdate(t,i.index[o],r)},this.options=e,this.classes=e.classes}return d(t,[{key:"add",value:function(t,e,i){var n=this.options,s=n.sheet,r=n.generateClassName;!(i=p({classes:this.classes,parent:n.parent,sheet:s,jss:n.jss,Renderer:n.Renderer,generateClassName:r},i)).selector&&this.classes[t]&&(i.selector="."+C(this.classes[t])),this.raw[t]=e;var o=$(t,e,i),a=void 0;return!i.selector&&o instanceof f&&(a=r(o,s),o.selector="."+C(a)),this.register(o,a),this.index.splice(void 0===i.index?this.index.length:i.index,0,o),o}},{key:"get",value:function(t){return this.map[t]}},{key:"remove",value:function(t){this.unregister(t),this.index.splice(this.indexOf(t),1)}},{key:"indexOf",value:function(t){return this.index.indexOf(t)}},{key:"process",value:function(){var t=this.options.jss.plugins;this.index.slice(0).forEach(t.onProcessRule,t)}},{key:"register",value:function(t,e){this.map[t.key]=t,t instanceof f&&(this.map[t.selector]=t,e&&(this.classes[t.key]=e))}},{key:"unregister",value:function(t){delete this.map[t.key],t instanceof f&&(delete this.map[t.selector],delete this.classes[t.key])}},{key:"link",value:function(t){for(var e=this.options.sheet.renderer.getUnescapedKeysMap(this.index),i=0;i<t.length;i++){var s=t[i],r=this.options.sheet.renderer.getKey(s);e[r]&&(r=e[r]);var o=this.map[r];o&&n(o,s)}}},{key:"toString",value:function(t){for(var e="",i=this.options.sheet,n=!!i&&i.options.link,s=0;s<this.index.length;s++){var r=this.index[s].toString(t);(r||n)&&(e&&(e+="\n"),e+=r)}return e}}]),t}(),w=function(){function t(e,i){var n=this;for(var s in c(this,t),this.update=function(t,e){return"string"==typeof t?n.rules.update(t,e):n.rules.update(t),n},this.attached=!1,this.deployed=!1,this.linked=!1,this.classes={},this.options=p({},i,{sheet:this,parent:this,classes:this.classes}),this.renderer=new i.Renderer(this),this.rules=new R(this.options),e)this.rules.add(s,e[s]);this.rules.process()}return d(t,[{key:"attach",value:function(){return this.attached?this:(this.deployed||this.deploy(),this.renderer.attach(),!this.linked&&this.options.link&&this.link(),this.attached=!0,this)}},{key:"detach",value:function(){return this.attached?(this.renderer.detach(),this.attached=!1,this):this}},{key:"addRule",value:function(t,e,i){var n=this.queue;this.attached&&!n&&(this.queue=[]);var s=this.rules.add(t,e,i);return this.options.jss.plugins.onProcessRule(s),this.attached?this.deployed?(n?n.push(s):(this.insertRule(s),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),s):s:(this.deployed=!1,s)}},{key:"insertRule",value:function(t){var e=this.renderer.insertRule(t);e&&this.options.link&&n(t,e)}},{key:"addRules",value:function(t,e){var i=[];for(var n in t)i.push(this.addRule(n,t[n],e));return i}},{key:"getRule",value:function(t){return this.rules.get(t)}},{key:"deleteRule",value:function(t){var e=this.rules.get(t);return!!e&&(this.rules.remove(e),!this.attached||!e.renderable||this.renderer.deleteRule(e.renderable))}},{key:"indexOf",value:function(t){return this.rules.indexOf(t)}},{key:"deploy",value:function(){return this.renderer.deploy(),this.deployed=!0,this}},{key:"link",value:function(){var t=this.renderer.getRules();return t&&this.rules.link(t),this.linked=!0,this}},{key:"toString",value:function(t){return this.rules.toString(t)}}]),t}(),E=function(){function t(){c(this,t),this.hooks={onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}}return d(t,[{key:"onCreateRule",value:function(t,e,i){for(var n=0;n<this.hooks.onCreateRule.length;n++){var s=this.hooks.onCreateRule[n](t,e,i);if(s)return s}return null}},{key:"onProcessRule",value:function(t){if(!t.isProcessed){for(var e=t.options.sheet,i=0;i<this.hooks.onProcessRule.length;i++)this.hooks.onProcessRule[i](t,e);t.style&&this.onProcessStyle(t.style,t,e),t.isProcessed=!0}}},{key:"onProcessStyle",value:function(t,e,i){for(var n=t,s=0;s<this.hooks.onProcessStyle.length;s++)n=this.hooks.onProcessStyle[s](n,e,i),e.style=n}},{key:"onProcessSheet",value:function(t){for(var e=0;e<this.hooks.onProcessSheet.length;e++)this.hooks.onProcessSheet[e](t)}},{key:"onUpdate",value:function(t,e,i){for(var n=0;n<this.hooks.onUpdate.length;n++)this.hooks.onUpdate[n](t,e,i)}},{key:"onChangeValue",value:function(t,e,i){for(var n=t,s=0;s<this.hooks.onChangeValue.length;s++)n=this.hooks.onChangeValue[s](n,e,i);return n}},{key:"use",value:function(t){for(var e in t)this.hooks[e]?this.hooks[e].push(t[e]):r(!1,'[JSS] Unknown hook "%s".',e)}}]),t}(),T=function(){function t(e,i,n){c(this,t),this.type="simple",this.isProcessed=!1,this.key=e,this.value=i,this.options=n}return d(t,[{key:"toString",value:function(t){if(Array.isArray(this.value)){for(var e="",i=0;i<this.value.length;i++)e+=this.key+" "+this.value[i]+";",this.value[i+1]&&(e+="\n");return e}return this.key+" "+this.value+";"}}]),t}(),S=function(){function t(e,i,n){for(var s in c(this,t),this.type="keyframes",this.isProcessed=!1,this.key=e,this.options=n,this.rules=new R(p({},n,{parent:this})),i)this.rules.add(s,i[s],p({},this.options,{parent:this,selector:s}));this.rules.process()}return d(t,[{key:"toString",value:function(){var t=this.rules.toString(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{indent:1});return t&&(t+="\n"),this.key+" {\n"+t+"}"}}]),t}(),N=function(){function t(e,i,n){for(var s in c(this,t),this.type="conditional",this.isProcessed=!1,this.key=e,this.options=n,this.rules=new R(p({},n,{parent:this})),i)this.rules.add(s,i[s]);this.rules.process()}return d(t,[{key:"getRule",value:function(t){return this.rules.get(t)}},{key:"indexOf",value:function(t){return this.rules.indexOf(t)}},{key:"addRule",value:function(t,e,i){var n=this.rules.add(t,e,i);return this.options.jss.plugins.onProcessRule(n),n}},{key:"toString",value:function(){var t=this.rules.toString(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{indent:1});return t?this.key+" {\n"+t+"\n}":""}}]),t}(),A=function(){function t(e,i,n){c(this,t),this.type="font-face",this.isProcessed=!1,this.key=e,this.style=i,this.options=n}return d(t,[{key:"toString",value:function(t){if(Array.isArray(this.style)){for(var e="",i=0;i<this.style.length;i++)e+=u(this.key,this.style[i]),this.style[i+1]&&(e+="\n");return e}return u(this.key,this.style,t)}}]),t}(),O=function(){function t(e,i,n){c(this,t),this.type="viewport",this.isProcessed=!1,this.key=e,this.style=i,this.options=n}return d(t,[{key:"toString",value:function(t){return u(this.key,this.style,t)}}]),t}(),P={"@charset":T,"@import":T,"@namespace":T,"@keyframes":S,"@media":N,"@supports":N,"@font-face":A,"@viewport":O,"@-ms-viewport":O},B=Object.keys(P).map(function(t){var e=new RegExp("^"+t),i=P[t];return{onCreateRule:function(t,n,s){return e.test(t)?new i(t,n,s):null}}}),j={onCreateRule:function(t,e,i){if(!_(e))return null;var n=e,s=$(t,{},i);return n.subscribe(function(t){for(var e in t)s.prop(e,t[e])}),s},onProcessRule:function(t){if(t instanceof f){var e=t,i=e.style,n=function(t){var n=i[t];if(!_(n))return"continue";delete i[t],n.subscribe({next:function(i){e.prop(t,i)}})};for(var s in i)n(s)}}},D=Date.now(),F="fnValues"+D,L="fnStyle"+ ++D,I={onCreateRule:function(t,e,i){if("function"!=typeof e)return null;var n=$(t,{},i);return n[L]=e,n},onProcessStyle:function(t,e){var i={};for(var n in t){var s=t[n];"function"==typeof s&&(delete t[n],i[n]=s)}return(e=e)[F]=i,t},onUpdate:function(t,e){if(e.rules instanceof R)e.rules.update(t);else if(e instanceof f){if((e=e)[F])for(var i in e[F])e.prop(i,e[F][i](t));var n=(e=e)[L];if(n){var s=n(t);for(var r in s)e.prop(r,s[r])}}}},M=function(){function t(){c(this,t),this.registry=[]}return d(t,[{key:"add",value:function(t){var e=this.registry,i=t.options.index;if(-1===e.indexOf(t))if(0===e.length||i>=this.index)e.push(t);else for(var n=0;n<e.length;n++)if(e[n].options.index>i)return void e.splice(n,0,t)}},{key:"reset",value:function(){this.registry=[]}},{key:"remove",value:function(t){var e=this.registry.indexOf(t);this.registry.splice(e,1)}},{key:"toString",value:function(t){return this.registry.filter(function(t){return t.attached}).map(function(e){return e.toString(t)}).join("\n")}},{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),t}(),H=new M,z="2f1acc6c3a606b082e5eef5e54414ffb";null==s[z]&&(s[z]=0);var W=s[z]++,U=function(){var t=0;return function(e,i){(t+=1)>1e10&&r(!1,"[JSS] You might have a memory leak. Rule counter is at %s.",t);var n="c",s="";return i&&(n=i.options.classNamePrefix||"c",null!=i.options.jss.id&&(s+=i.options.jss.id)),""+n+W+s+t}},K=function(t){var e=void 0;return function(){return e||(e=t()),e}};function q(t,e){try{return t.style.getPropertyValue(e)}catch(t){return""}}function V(t,e,i){try{var n=i;if(Array.isArray(i)&&(n=a(i,!0),"!important"===i[i.length-1]))return t.style.setProperty(e,n,"important"),!0;t.style.setProperty(e,n)}catch(t){return!1}return!0}function G(t,e){try{t.style.removeProperty(e)}catch(t){r(!1,'[JSS] DOMException "%s" was thrown. Tried to remove property "%s".',t.message,e)}}var J,X=(J=function(t){return t.substr(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t.indexOf("{")-1)},function(t){if(1===t.type)return t.selectorText;if(7===t.type){var e=t.name;if(e)return"@keyframes "+e;var i=t.cssText;return"@"+J(i,i.indexOf("keyframes"))}return J(t.cssText)});function Y(t,e){return t.selectorText=e,t.selectorText===e}var Q,Z,tt=K(function(){return document.head||document.getElementsByTagName("head")[0]}),et=(Q=void 0,Z=!1,function(t){var e={};Q||(Q=document.createElement("style"));for(var i=0;i<t.length;i++){var n=t[i];if(n instanceof f){var s=n.selector;if(s&&-1!==s.indexOf("\\")){Z||(tt().appendChild(Q),Z=!0),Q.textContent=s+" {}";var r=Q.sheet;if(r){var o=r.cssRules;o&&(e[o[0].selectorText]=n.key)}}}}return Z&&(tt().removeChild(Q),Z=!1),e}),it=K(function(){var t=document.querySelector('meta[property="csp-nonce"]');return t?t.getAttribute("content"):null}),nt=function(){function t(e){c(this,t),this.getPropertyValue=q,this.setProperty=V,this.removeProperty=G,this.setSelector=Y,this.getKey=X,this.getUnescapedKeysMap=et,this.hasInsertedRules=!1,e&&H.add(e),this.sheet=e;var i=this.sheet?this.sheet.options:{},n=i.media,s=i.meta;this.element=i.element||document.createElement("style"),this.element.setAttribute("data-jss",""),n&&this.element.setAttribute("media",n),s&&this.element.setAttribute("data-meta",s);var r=it();r&&this.element.setAttribute("nonce",r)}return d(t,[{key:"attach",value:function(){!this.element.parentNode&&this.sheet&&(this.hasInsertedRules&&(this.deploy(),this.hasInsertedRules=!1),function(t,e){var i=e.insertionPoint,n=function(t){var e=H.registry;if(e.length>0){var i=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(n.attached&&n.options.index>e.index&&n.options.insertionPoint===e.insertionPoint)return n}return null}(e,t);if(i)return i.renderer.element;if(i=function(t,e){for(var i=t.length-1;i>=0;i--){var n=t[i];if(n.attached&&n.options.insertionPoint===e.insertionPoint)return n}return null}(e,t))return i.renderer.element.nextElementSibling}var n=t.insertionPoint;if(n&&"string"==typeof n){var s=function(t){for(var e=tt(),i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(8===n.nodeType&&n.nodeValue.trim()===t)return n}return null}(n);if(s)return s.nextSibling;r("jss"===n,'[JSS] Insertion point "%s" not found.',n)}return null}(e);if(n){var s=n.parentNode;s&&s.insertBefore(t,n)}else if(i&&"number"==typeof i.nodeType){var o=i.parentNode;o?o.insertBefore(t,i.nextSibling):r(!1,"[JSS] Insertion point is not in the DOM.")}else tt().insertBefore(t,n)}(this.element,this.sheet.options))}},{key:"detach",value:function(){this.element.parentNode.removeChild(this.element)}},{key:"deploy",value:function(){this.sheet&&(this.element.textContent="\n"+this.sheet.toString()+"\n")}},{key:"insertRule",value:function(t,e){var i=this.element.sheet,n=i.cssRules,s=t.toString();if(e||(e=n.length),!s)return!1;try{i.insertRule(s,e)}catch(e){return r(!1,"[JSS] Can not insert an unsupported rule \n\r%s",t),!1}return this.hasInsertedRules=!0,n[e]}},{key:"deleteRule",value:function(t){var e=this.element.sheet,i=this.indexOf(t);return-1!==i&&(e.deleteRule(i),!0)}},{key:"indexOf",value:function(t){for(var e=this.element.sheet.cssRules,i=0;i<e.length;i++)if(t===e[i])return i;return-1}},{key:"replaceRule",value:function(t,e){var i=this.indexOf(t),n=this.insertRule(e,i);return this.element.sheet.deleteRule(i),n}},{key:"getRules",value:function(){return this.element.sheet.cssRules}}]),t}(),st=function(){function t(){c(this,t)}return d(t,[{key:"setProperty",value:function(){return!0}},{key:"getPropertyValue",value:function(){return""}},{key:"removeProperty",value:function(){}},{key:"setSelector",value:function(){return!0}},{key:"getKey",value:function(){return""}},{key:"attach",value:function(){}},{key:"detach",value:function(){}},{key:"deploy",value:function(){}},{key:"insertRule",value:function(){return!1}},{key:"deleteRule",value:function(){return!0}},{key:"replaceRule",value:function(){return!1}},{key:"getRules",value:function(){}},{key:"indexOf",value:function(){return-1}}]),t}(),rt=B.concat([j,I]),ot=0,at=function(){function t(e){c(this,t),this.id=ot++,this.version="9.8.7",this.plugins=new E,this.options={createGenerateClassName:U,Renderer:i?nt:st,plugins:[]},this.generateClassName=U(),this.use.apply(this,rt),this.setup(e)}return d(t,[{key:"setup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.createGenerateClassName&&(this.options.createGenerateClassName=t.createGenerateClassName,this.generateClassName=t.createGenerateClassName()),null!=t.insertionPoint&&(this.options.insertionPoint=t.insertionPoint),(t.virtual||t.Renderer)&&(this.options.Renderer=t.Renderer||(t.virtual?st:nt)),t.plugins&&this.use.apply(this,t.plugins),this}},{key:"createStyleSheet",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.index;"number"!=typeof i&&(i=0===H.index?0:H.index+1);var n=new w(t,p({},e,{jss:this,generateClassName:e.generateClassName||this.generateClassName,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:i}));return this.plugins.onProcessSheet(n),n}},{key:"removeStyleSheet",value:function(t){return t.detach(),H.remove(t),this}},{key:"createRule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===(void 0===t?"undefined":h(t))&&(i=e,e=t,t=void 0);var n=i;n.jss=this,n.Renderer=this.options.Renderer,n.generateClassName||(n.generateClassName=this.generateClassName),n.classes||(n.classes={});var s=$(t,e,n);return!n.selector&&s instanceof f&&(s.selector="."+n.generateClassName(s)),this.plugins.onProcessRule(s),s}},{key:"use",value:function(){for(var t=this,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return i.forEach(function(e){-1===t.options.plugins.indexOf(e)&&(t.options.plugins.push(e),t.plugins.use(e))}),this}}]),t}(),lt=function(){function t(){c(this,t),this.sheets=[],this.refs=[],this.keys=[]}return d(t,[{key:"get",value:function(t){var e=this.keys.indexOf(t);return this.sheets[e]}},{key:"add",value:function(t,e){var i=this.sheets,n=this.refs,s=this.keys,r=i.indexOf(e);return-1!==r?r:(i.push(e),n.push(0),s.push(t),i.length-1)}},{key:"manage",value:function(t){var e=this.keys.indexOf(t),i=this.sheets[e];return 0===this.refs[e]&&i.attach(),this.refs[e]++,this.keys[e]||this.keys.splice(e,0,t),i}},{key:"unmanage",value:function(t){var e=this.keys.indexOf(t);-1!==e?this.refs[e]>0&&(this.refs[e]--,0===this.refs[e]&&this.sheets[e].detach()):r(!1,"SheetsManager: can't find sheet to unmanage")}},{key:"size",get:function(){return this.keys.length}}]),t}(),ut=function(t){return new at(t)},ht=ut();t.create=ut,t.default=ht,t.getDynamicStyles=function t(e){var i=null;for(var n in e){var s=e[n],r=void 0===s?"undefined":h(s);if("function"===r)i||(i={}),i[n]=s;else if("object"===r&&null!==s&&!Array.isArray(s)){var o=t(s);o&&(i||(i={}),i[n]=o)}}return i},t.toCssValue=a,t.SheetsRegistry=M,t.SheetsManager=lt,t.RuleList=R,t.sheets=H,t.createGenerateClassName=U,Object.defineProperty(t,"__esModule",{value:!0})}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.jssPreset=e():t.jssPreset=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(1)),r=n(i(4)),o=n(i(38)),a=n(i(39)),l=n(i(40)),u=n(i(41)),h=n(i(43)),c=n(i(45)),d=n(i(47)),p=n(i(53));e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{plugins:[(0,s.default)(t.template),(0,r.default)(t.global),(0,o.default)(t.extend),(0,a.default)(t.nested),(0,l.default)(t.compose),(0,u.default)(t.camelCase),(0,h.default)(t.defaultUnit),(0,c.default)(t.expand),(0,d.default)(t.vendorPrefixer),(0,p.default)(t.propsSort)]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(i(2)),s=function(t){"string"==typeof t.style&&(t.style=(0,n.default)(t.style))};e.default=function(){return{onProcessRule:s}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(i(3)),s=/;\n/;e.default=function(t){for(var e={},i=t.split(s),r=0;r<i.length;r++){var o=(i[r]||"").trim();if(o){var a=o.indexOf(":");if(-1!==a){var l=o.substr(0,a).trim(),u=o.substr(a+1).trim();e[l]=u}else(0,n.default)(!1,'Malformed CSS string "%s"',o)}}return e}},function(t,e,i){"use strict";t.exports=function(){}},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=t.split(d),n="",s=0;s<i.length;s++)n+=e+" "+i[s].trim(),i[s+1]&&(n+=", ");return n}Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.default=function(){return{onCreateRule:function(t,e,i){if(t===l)return new h(t,e,i);if("@"===t[0]&&t.substr(0,u.length)===u)return new c(t,e,i);var n=i.parent;return n&&("global"!==n.type&&"global"!==n.options.parent.type||(i.global=!0)),i.global&&(i.selector=t),null},onProcessRule:function(t){"style"===t.type&&(function(t){var e=t.options,i=t.style,n=i[l];if(n){for(var o in n)e.sheet.addRule(o,n[o],r({},e,{selector:s(o,t.selector)}));delete i[l]}}(t),function(t){var e=t.options,i=t.style;for(var n in i)if(n.substr(0,l.length)===l){var o=s(n.substr(l.length),t.selector);e.sheet.addRule(o,i[n],r({},e,{selector:o})),delete i[n]}}(t))}}};var a=i(5),l="@global",u="@global ",h=function(){function t(e,i,s){for(var o in n(this,t),this.type="global",this.key=e,this.options=s,this.rules=new a.RuleList(r({},s,{parent:this})),i)this.rules.add(o,i[o],{selector:o});this.rules.process()}return o(t,[{key:"getRule",value:function(t){return this.rules.get(t)}},{key:"addRule",value:function(t,e,i){var n=this.rules.add(t,e,i);return this.options.jss.plugins.onProcessRule(n),n}},{key:"indexOf",value:function(t){return this.rules.indexOf(t)}},{key:"toString",value:function(){return this.rules.toString()}}]),t}(),c=function(){function t(e,i,s){n(this,t),this.name=e,this.options=s;var o=e.substr(u.length);this.rule=s.jss.createRule(o,i,r({},s,{parent:this,selector:o}))}return o(t,[{key:"toString",value:function(t){return this.rule.toString(t)}}]),t}(),d=/\s*,\s*/g},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.create=e.createGenerateClassName=e.sheets=e.RuleList=e.SheetsManager=e.SheetsRegistry=e.toCssValue=e.getDynamicStyles=void 0;var s=i(6);Object.defineProperty(e,"getDynamicStyles",{enumerable:!0,get:function(){return n(s).default}});var r=i(7);Object.defineProperty(e,"toCssValue",{enumerable:!0,get:function(){return n(r).default}});var o=i(8);Object.defineProperty(e,"SheetsRegistry",{enumerable:!0,get:function(){return n(o).default}});var a=i(9);Object.defineProperty(e,"SheetsManager",{enumerable:!0,get:function(){return n(a).default}});var l=i(10);Object.defineProperty(e,"RuleList",{enumerable:!0,get:function(){return n(l).default}});var u=i(21);Object.defineProperty(e,"sheets",{enumerable:!0,get:function(){return n(u).default}});var h=i(22);Object.defineProperty(e,"createGenerateClassName",{enumerable:!0,get:function(){return n(h).default}});var c=n(i(25)),d=e.create=function(t){return new c.default(t)};e.default=d()},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(t){return function t(e){var n=null;for(var s in e){var r=e[s],o="undefined"==typeof r?"undefined":i(r);if("function"===o)n||(n={}),n[s]=r;else if("object"===o&&null!==r&&!Array.isArray(r)){var a=t(r);a&&(n||(n={}),n[s]=a)}}return n}(t)}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(t))return t;var n="";if(Array.isArray(t[0]))for(var s=0;s<t.length&&"!important"!==t[s];s++)n&&(n+=", "),n+=i(t[s]," ");else n=i(t,", ");return e||"!important"!==t[t.length-1]||(n+=" !important"),n};var i=function(t,e){for(var i="",n=0;n<t.length&&"!important"!==t[n];n++)i&&(i+=e),i+=t[n];return i}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.registry=[]}return i(t,[{key:"add",value:function(t){var e=this.registry,i=t.options.index;if(-1===e.indexOf(t)){if(0===e.length||i>=this.index)return void e.push(t);for(var n=0;n<e.length;n++)if(e[n].options.index>i)return void e.splice(n,0,t)}}},{key:"reset",value:function(){this.registry=[]}},{key:"remove",value:function(t){var e=this.registry.indexOf(t);this.registry.splice(e,1)}},{key:"toString",value:function(t){return this.registry.filter(function(t){return t.attached}).map(function(e){return e.toString(t)}).join("\n")}},{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(t){return t&&t.__esModule?t:{default:t}}(i(3)),r=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.sheets=[],this.refs=[],this.keys=[]}return n(t,[{key:"get",value:function(t){var e=this.keys.indexOf(t);return this.sheets[e]}},{key:"add",value:function(t,e){var i=this.sheets,n=this.refs,s=this.keys,r=i.indexOf(e);return-1!==r?r:(i.push(e),n.push(0),s.push(t),i.length-1)}},{key:"manage",value:function(t){var e=this.keys.indexOf(t),i=this.sheets[e];return 0===this.refs[e]&&i.attach(),this.refs[e]++,this.keys[e]||this.keys.splice(e,0,t),i}},{key:"unmanage",value:function(t){var e=this.keys.indexOf(t);return-1===e?void(0,s.default)(!1,"SheetsManager: can't find sheet to unmanage"):void(this.refs[e]>0&&(this.refs[e]--,0===this.refs[e]&&this.sheets[e].detach()))}},{key:"size",get:function(){return this.keys.length}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=n(i(11)),a=n(i(19)),l=n(i(12)),u=n(i(20)),h=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.map={},this.raw={},this.index=[],this.options=e,this.classes=e.classes}return r(t,[{key:"add",value:function(t,e,i){var n=this.options,r=n.sheet,a=n.generateClassName;!(i=s({classes:this.classes,parent:n.parent,sheet:r,jss:n.jss,Renderer:n.Renderer,generateClassName:a},i)).selector&&this.classes[t]&&(i.selector="."+(0,u.default)(this.classes[t])),this.raw[t]=e;var h=(0,o.default)(t,e,i),c=void 0;return!i.selector&&h instanceof l.default&&(c=a(h,r),h.selector="."+(0,u.default)(c)),this.register(h,c),this.index.splice(void 0===i.index?this.index.length:i.index,0,h),h}},{key:"get",value:function(t){return this.map[t]}},{key:"remove",value:function(t){this.unregister(t),this.index.splice(this.indexOf(t),1)}},{key:"indexOf",value:function(t){return this.index.indexOf(t)}},{key:"process",value:function(){var t=this.options.jss.plugins;this.index.slice(0).forEach(t.onProcessRule,t)}},{key:"register",value:function(t,e){this.map[t.key]=t,t instanceof l.default&&(this.map[t.selector]=t,e&&(this.classes[t.key]=e))}},{key:"unregister",value:function(t){delete this.map[t.key],t instanceof l.default&&(delete this.map[t.selector],delete this.classes[t.key])}},{key:"update",value:function(t,e){var i=this.options,n=i.jss.plugins,s=i.sheet;if("string"!=typeof t)for(var r=0;r<this.index.length;r++)n.onUpdate(t,this.index[r],s);else n.onUpdate(e,this.get(t),s)}},{key:"link",value:function(t){for(var e=this.options.sheet.renderer.getUnescapedKeysMap(this.index),i=0;i<t.length;i++){var n=t[i],s=this.options.sheet.renderer.getKey(n);e[s]&&(s=e[s]);var r=this.map[s];r&&(0,a.default)(r,n)}}},{key:"toString",value:function(t){for(var e="",i=this.options.sheet,n=!!i&&i.options.link,s=0;s<this.index.length;s++){var r=this.index[s].toString(t);(r||n)&&(e&&(e+="\n"),e+=r)}return e}}]),t}();e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unnamed",e=arguments[2],i=e.jss,n=(0,o.default)(arguments[1]);return i.plugins.onCreateRule(t,n,e)||("@"===t[0]&&(0,s.default)(!1,"[JSS] Unknown at-rule %s",t),new r.default(t,n,e))};var s=n(i(3)),r=n(i(12)),o=n(i(14))},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=n(i(3)),l=n(i(13)),u=n(i(7)),h=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.type="style",this.isProcessed=!1;var s=n.sheet,r=n.Renderer,o=n.selector;this.key=e,this.options=n,this.style=i,o&&(this.selectorText=o),this.renderer=s?s.renderer:new r}return o(t,[{key:"prop",value:function(t,e){if(void 0===e)return this.style[t];if(this.style[t]===e)return this;var i=null==(e=this.options.jss.plugins.onChangeValue(e,t,this))||!1===e,n=t in this.style;if(i&&!n)return this;var s=i&&n;if(s?delete this.style[t]:this.style[t]=e,this.renderable)return s?this.renderer.removeProperty(this.renderable,t):this.renderer.setProperty(this.renderable,t,e),this;var r=this.options.sheet;return r&&r.attached&&(0,a.default)(!1,'Rule is not linked. Missing sheet option "link: true".'),this}},{key:"applyTo",value:function(t){var e=this.toJSON();for(var i in e)this.renderer.setProperty(t,i,e[i]);return this}},{key:"toJSON",value:function(){var t={};for(var e in this.style){var i=this.style[e];"object"!==("undefined"==typeof i?"undefined":r(i))?t[e]=i:Array.isArray(i)&&(t[e]=(0,u.default)(i))}return t}},{key:"toString",value:function(t){var e=this.options.sheet,i=e&&e.options.link?s({},t,{allowEmpty:!0}):t;return(0,l.default)(this.selector,this.style,i)}},{key:"selector",set:function(t){if(t!==this.selectorText&&(this.selectorText=t,this.renderable)&&!this.renderer.setSelector(this.renderable,t)&&this.renderable){var e=this.renderer.replaceRule(this.renderable,this);e&&(this.renderable=e)}},get:function(){return this.selectorText}}]),t}();e.default=h},function(t,e,i){"use strict";function n(t,e){for(var i="",n=0;n<e;n++)i+="  ";return i+t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="";if(!e)return r;var o=i.indent,a=void 0===o?0:o,l=e.fallbacks;if(a++,l)if(Array.isArray(l))for(var u=0;u<l.length;u++){var h=l[u];for(var c in h){var d=h[c];null!=d&&(r+="\n"+n(c+": "+(0,s.default)(d)+";",a))}}else for(var p in l){var f=l[p];null!=f&&(r+="\n"+n(p+": "+(0,s.default)(f)+";",a))}for(var m in e){var g=e[m];null!=g&&"fallbacks"!==m&&(r+="\n"+n(m+": "+(0,s.default)(g)+";",a))}return r||i.allowEmpty?r=n(t+" {"+r+"\n",--a)+n("}",a):r};var s=function(t){return t&&t.__esModule?t:{default:t}}(i(7))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function t(e){if(null==e)return e;var i="undefined"==typeof e?"undefined":n(e);if("string"===i||"number"===i||"function"===i)return e;if(r(e))return e.map(t);if((0,s.default)(e))return e;var o={};for(var a in e){var l=e[a];o[a]="object"!==("undefined"==typeof l?"undefined":n(l))?l:t(l)}return o};var s=function(t){return t&&t.__esModule?t:{default:t}}(i(15)),r=Array.isArray},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(i(16));e.default=function(t){return t&&t[n.default]&&t===t[n.default]()}},function(t,e,i){(function(t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=function(t){return t&&t.__esModule?t:{default:t}}(i(18));s="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof t?t:n;var o=(0,r.default)(s);e.default=o}).call(e,function(){return this}(),i(17)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e,i=t.Symbol;return"function"==typeof i?i.observable?e=i.observable:(e=i("observable"),i.observable=e):e="@@observable",e}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){t.renderable=e,t.rules&&e.cssRules&&t.rules.link(e.cssRules)}},function(t,e,i){(function(t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t}}).call(e,function(){return this}())},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(i(8));e.default=new n.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(3)),r=n((n(i(23)),i(24)));e.default=function(){var t=0;return function(e,i){(t+=1)>1e10&&(0,s.default)(!1,"[JSS] You might have a memory leak. Rule counter is at %s.",t);var n="c",o="";return i&&(n=i.options.classNamePrefix||"c",null!=i.options.jss.id&&(o+=i.options.jss.id)),""+n+r.default+o+t}}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=n(i(19)),a=n(i(10)),l=function(){function t(e,i){for(var n in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.attached=!1,this.deployed=!1,this.linked=!1,this.classes={},this.options=s({},i,{sheet:this,parent:this,classes:this.classes}),this.renderer=new i.Renderer(this),this.rules=new a.default(this.options),e)this.rules.add(n,e[n]);this.rules.process()}return r(t,[{key:"attach",value:function(){return this.attached?this:(this.deployed||this.deploy(),this.renderer.attach(),!this.linked&&this.options.link&&this.link(),this.attached=!0,this)}},{key:"detach",value:function(){return this.attached?(this.renderer.detach(),this.attached=!1,this):this}},{key:"addRule",value:function(t,e,i){var n=this.queue;this.attached&&!n&&(this.queue=[]);var s=this.rules.add(t,e,i);return this.options.jss.plugins.onProcessRule(s),this.attached?this.deployed?(n?n.push(s):(this.insertRule(s),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),s):s:(this.deployed=!1,s)}},{key:"insertRule",value:function(t){var e=this.renderer.insertRule(t);e&&this.options.link&&(0,o.default)(t,e)}},{key:"addRules",value:function(t,e){var i=[];for(var n in t)i.push(this.addRule(n,t[n],e));return i}},{key:"getRule",value:function(t){return this.rules.get(t)}},{key:"deleteRule",value:function(t){var e=this.rules.get(t);return!!e&&(this.rules.remove(e),!this.attached||!e.renderable||this.renderer.deleteRule(e.renderable))}},{key:"indexOf",value:function(t){return this.rules.indexOf(t)}},{key:"deploy",value:function(){return this.renderer.deploy(),this.deployed=!0,this}},{key:"link",value:function(){var t=this.renderer.getRules();return t&&this.rules.link(t),this.linked=!0,this}},{key:"update",value:function(t,e){return this.rules.update(t,e),this}},{key:"toString",value:function(t){return this.rules.toString(t)}}]),t}();e.default=l},function(t,e){(function(t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="2f1acc6c3a606b082e5eef5e54414ffb";null==t[i]&&(t[i]=0),e.default=t[i]++}).call(e,function(){return this}())},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=n(i(26)),l=n(i(23)),u=n(i(27)),h=n(i(28)),c=n(i(34)),d=n(i(35)),p=n(i(21)),f=n(i(12)),m=n(i(22)),g=n(i(11)),v=n(i(36)),b=n(i(37)),y=h.default.concat([c.default,d.default]),_=0,x=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.id=_++,this.version="9.8.0",this.plugins=new u.default,this.options={createGenerateClassName:m.default,Renderer:a.default?v.default:b.default,plugins:[]},this.generateClassName=(0,m.default)(),this.use.apply(this,y),this.setup(e)}return o(t,[{key:"setup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.createGenerateClassName&&(this.options.createGenerateClassName=t.createGenerateClassName,this.generateClassName=t.createGenerateClassName()),null!=t.insertionPoint&&(this.options.insertionPoint=t.insertionPoint),(t.virtual||t.Renderer)&&(this.options.Renderer=t.Renderer||(t.virtual?b.default:v.default)),t.plugins&&this.use.apply(this,t.plugins),this}},{key:"createStyleSheet",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.index;"number"!=typeof i&&(i=0===p.default.index?0:p.default.index+1);var n=new l.default(t,r({},e,{jss:this,generateClassName:e.generateClassName||this.generateClassName,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:i}));return this.plugins.onProcessSheet(n),n}},{key:"removeStyleSheet",value:function(t){return t.detach(),p.default.remove(t),this}},{key:"createRule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===("undefined"==typeof t?"undefined":s(t))&&(i=e,e=t,t=void 0);var n=i;n.jss=this,n.Renderer=this.options.Renderer,n.generateClassName||(n.generateClassName=this.generateClassName),n.classes||(n.classes={});var r=(0,g.default)(t,e,n);return!n.selector&&r instanceof f.default&&(r.selector="."+n.generateClassName(r)),this.plugins.onProcessRule(r),r}},{key:"use",value:function(){for(var t=this,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return i.forEach(function(e){-1===t.options.plugins.indexOf(e)&&(t.options.plugins.push(e),t.plugins.use(e))}),this}}]),t}();e.default=x},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=e.isBrowser="object"===("undefined"==typeof window?"undefined":i(window))&&"object"===("undefined"==typeof document?"undefined":i(document))&&9===document.nodeType;e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(t){return t&&t.__esModule?t:{default:t}}(i(3)),r=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.hooks={onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}}return n(t,[{key:"onCreateRule",value:function(t,e,i){for(var n=0;n<this.hooks.onCreateRule.length;n++){var s=this.hooks.onCreateRule[n](t,e,i);if(s)return s}return null}},{key:"onProcessRule",value:function(t){if(!t.isProcessed){for(var e=t.options.sheet,i=0;i<this.hooks.onProcessRule.length;i++)this.hooks.onProcessRule[i](t,e);t.style&&this.onProcessStyle(t.style,t,e),t.isProcessed=!0}}},{key:"onProcessStyle",value:function(t,e,i){for(var n=t,s=0;s<this.hooks.onProcessStyle.length;s++)n=this.hooks.onProcessStyle[s](n,e,i),e.style=n}},{key:"onProcessSheet",value:function(t){for(var e=0;e<this.hooks.onProcessSheet.length;e++)this.hooks.onProcessSheet[e](t)}},{key:"onUpdate",value:function(t,e,i){for(var n=0;n<this.hooks.onUpdate.length;n++)this.hooks.onUpdate[n](t,e,i)}},{key:"onChangeValue",value:function(t,e,i){for(var n=t,s=0;s<this.hooks.onChangeValue.length;s++)n=this.hooks.onChangeValue[s](n,e,i);return n}},{key:"use",value:function(t){for(var e in t)this.hooks[e]?this.hooks[e].push(t[e]):(0,s.default)(!1,'[JSS] Unknown hook "%s".',e)}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(29)),r=n(i(30)),o=n(i(31)),a=n(i(32)),l=n(i(33)),u={"@charset":s.default,"@import":s.default,"@namespace":s.default,"@keyframes":r.default,"@media":o.default,"@supports":o.default,"@font-face":a.default,"@viewport":l.default,"@-ms-viewport":l.default};e.default=Object.keys(u).map(function(t){var e=new RegExp("^"+t);return{onCreateRule:function(i,n,s){return e.test(i)?new u[t](i,n,s):null}}})},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.type="simple",this.isProcessed=!1,this.key=e,this.value=i,this.options=n}return i(t,[{key:"toString",value:function(t){if(Array.isArray(this.value)){for(var e="",i=0;i<this.value.length;i++)e+=this.key+" "+this.value[i]+";",this.value[i+1]&&(e+="\n");return e}return this.key+" "+this.value+";"}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(i(10)),o=function(){function t(e,i,s){for(var o in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type="keyframes",this.isProcessed=!1,this.key=e,this.options=s,this.rules=new r.default(n({},s,{parent:this})),i)this.rules.add(o,i[o],n({},this.options,{parent:this,selector:o}));this.rules.process()}return s(t,[{key:"toString",value:function(){var t=this.rules.toString(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{indent:1});return t&&(t+="\n"),this.key+" {\n"+t+"}"}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(i(10)),o=function(){function t(e,i,s){for(var o in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type="conditional",this.isProcessed=!1,this.key=e,this.options=s,this.rules=new r.default(n({},s,{parent:this})),i)this.rules.add(o,i[o]);this.rules.process()}return s(t,[{key:"getRule",value:function(t){return this.rules.get(t)}},{key:"indexOf",value:function(t){return this.rules.indexOf(t)}},{key:"addRule",value:function(t,e,i){var n=this.rules.add(t,e,i);return this.options.jss.plugins.onProcessRule(n),n}},{key:"toString",value:function(){var t=this.rules.toString(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{indent:1});return t?this.key+" {\n"+t+"\n}":""}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(t){return t&&t.__esModule?t:{default:t}}(i(13)),r=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.type="font-face",this.isProcessed=!1,this.key=e,this.style=i,this.options=n}return n(t,[{key:"toString",value:function(t){if(Array.isArray(this.style)){for(var e="",i=0;i<this.style.length;i++)e+=(0,s.default)(this.key,this.style[i]),this.style[i+1]&&(e+="\n");return e}return(0,s.default)(this.key,this.style,t)}}]),t}();e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(t){return t&&t.__esModule?t:{default:t}}(i(13)),r=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.type="viewport",this.isProcessed=!1,this.key=e,this.style=i,this.options=n}return n(t,[{key:"toString",value:function(t){return(0,s.default)(this.key,this.style,t)}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(12)),r=n(i(11)),o=n(i(15));e.default={onCreateRule:function(t,e,i){if(!(0,o.default)(e))return null;var n=e,s=(0,r.default)(t,{},i);return n.subscribe(function(t){for(var e in t)s.prop(e,t[e])}),s},onProcessRule:function(t){if(t instanceof s.default){var e=t,i=e.style,n=function(t){var n=i[t];return(0,o.default)(n)?(delete i[t],void n.subscribe({next:function(i){e.prop(t,i)}})):"continue"};for(var r in i)n(r)}}}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(12)),o=n(i(11)),a=Date.now(),l="fnValues"+a,u="fnStyle"+ ++a;e.default={onCreateRule:function(t,e,i){if("function"!=typeof e)return null;var n=(0,o.default)(t,{},i);return n[u]=e,n},onProcessStyle:function(t,e){var i={};for(var n in t){var s=t[n];"function"==typeof s&&(delete t[n],i[n]=s)}return(e=e)[l]=i,t},onUpdate:function(t,e){if(e.rules instanceof s.default)e.rules.update(t);else if(e instanceof r.default){if((e=e)[l])for(var i in e[l])e.prop(i,e[l][i](t));var n=(e=e)[u];if(n){var o=n(t);for(var a in o)e.prop(a,o[a])}}}}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){try{return t.style.getPropertyValue(e)}catch(t){return""}}function r(t,e,i){try{var n=i;if(Array.isArray(i)&&(n=(0,d.default)(i,!0),"!important"===i[i.length-1]))return t.style.setProperty(e,n,"important"),!0;t.style.setProperty(e,n)}catch(t){return!1}return!0}function o(t,e){try{t.style.removeProperty(e)}catch(t){(0,u.default)(!1,'[JSS] DOMException "%s" was thrown. Tried to remove property "%s".',t.message,e)}}function a(t,e){return t.selectorText=e,t.selectorText===e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=n(i(3)),h=n(i(21)),c=n(i(12)),d=n(i(7)),p=function(t){var e=void 0;return function(){return e||(e=t()),e}},f=function(){var t=function(t){return t.substr(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t.indexOf("{")-1)};return function(e){if(1===e.type)return e.selectorText;if(7===e.type){var i=e.name;if(i)return"@keyframes "+i;var n=e.cssText;return"@"+t(n,n.indexOf("keyframes"))}return t(e.cssText)}}(),m=p(function(){return document.head||document.getElementsByTagName("head")[0]}),g=function(){var t=void 0,e=!1;return function(i){var n={};t||(t=document.createElement("style"));for(var s=0;s<i.length;s++){var r=i[s];if(r instanceof c.default){var o=r.selector;if(o&&-1!==o.indexOf("\\")){e||(m().appendChild(t),e=!0),t.textContent=o+" {}";var a=t.sheet;if(a){var l=a.cssRules;l&&(n[l[0].selectorText]=r.key)}}}}return e&&(m().removeChild(t),e=!1),n}}(),v=p(function(){var t=document.querySelector('meta[property="csp-nonce"]');return t?t.getAttribute("content"):null}),b=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.getPropertyValue=s,this.setProperty=r,this.removeProperty=o,this.setSelector=a,this.getKey=f,this.getUnescapedKeysMap=g,this.hasInsertedRules=!1,e&&h.default.add(e),this.sheet=e;var i=this.sheet?this.sheet.options:{},n=i.media,l=i.meta;this.element=i.element||document.createElement("style"),this.element.type="text/css",this.element.setAttribute("data-jss",""),n&&this.element.setAttribute("media",n),l&&this.element.setAttribute("data-meta",l);var u=v();u&&this.element.setAttribute("nonce",u)}return l(t,[{key:"attach",value:function(){!this.element.parentNode&&this.sheet&&(this.hasInsertedRules&&(this.deploy(),this.hasInsertedRules=!1),function(t,e){var i=e.insertionPoint,n=function(t){var e=h.default.registry;if(e.length>0){var i=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(n.attached&&n.options.index>e.index&&n.options.insertionPoint===e.insertionPoint)return n}return null}(e,t);if(i)return i.renderer.element;if(i=function(t,e){for(var i=t.length-1;i>=0;i--){var n=t[i];if(n.attached&&n.options.insertionPoint===e.insertionPoint)return n}return null}(e,t))return i.renderer.element.nextElementSibling}var n=t.insertionPoint;if(n&&"string"==typeof n){var s=function(t){for(var e=m(),i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(8===n.nodeType&&n.nodeValue.trim()===t)return n}return null}(n);if(s)return s.nextSibling;(0,u.default)("jss"===n,'[JSS] Insertion point "%s" not found.',n)}return null}(e);if(n){var s=n.parentNode;s&&s.insertBefore(t,n)}else if(i&&"number"==typeof i.nodeType){var r=i.parentNode;r?r.insertBefore(t,i.nextSibling):(0,u.default)(!1,"[JSS] Insertion point is not in the DOM.")}else m().insertBefore(t,n)}(this.element,this.sheet.options))}},{key:"detach",value:function(){this.element.parentNode.removeChild(this.element)}},{key:"deploy",value:function(){this.sheet&&(this.element.textContent="\n"+this.sheet.toString()+"\n")}},{key:"insertRule",value:function(t,e){var i=this.element.sheet,n=i.cssRules,s=t.toString();if(e||(e=n.length),!s)return!1;try{i.insertRule(s,e)}catch(e){return(0,u.default)(!1,"[JSS] Can not insert an unsupported rule \n\r%s",t),!1}return this.hasInsertedRules=!0,n[e]}},{key:"deleteRule",value:function(t){var e=this.element.sheet,i=this.indexOf(t);return-1!==i&&(e.deleteRule(i),!0)}},{key:"indexOf",value:function(t){for(var e=this.element.sheet.cssRules,i=0;i<e.length;i++)if(t===e[i])return i;return-1}},{key:"replaceRule",value:function(t,e){var i=this.indexOf(t),n=this.insertRule(e,i);return this.element.sheet.deleteRule(i),n}},{key:"getRules",value:function(){return this.element.sheet.cssRules}}]),t}();e.default=b},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,[{key:"setProperty",value:function(){return!0}},{key:"getPropertyValue",value:function(){return""}},{key:"removeProperty",value:function(){}},{key:"setSelector",value:function(){return!0}},{key:"getKey",value:function(){return""}},{key:"attach",value:function(){}},{key:"detach",value:function(){}},{key:"deploy",value:function(){}},{key:"insertRule",value:function(){return!1}},{key:"deleteRule",value:function(){return!0}},{key:"replaceRule",value:function(){return!1}},{key:"getRules",value:function(){}},{key:"indexOf",value:function(){return-1}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(){return{onProcessStyle:function(t,e,i){return"extend"in t?function t(e,i,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(e,i,o,a){if("string"!==n(e.extend))if(Array.isArray(e.extend))for(var l=0;l<e.extend.length;l++)t(e.extend[l],i,o,a);else for(var u in e.extend)"extend"!==u?r(e.extend[u])?(u in a||(a[u]={}),t(e.extend[u],i,o,a[u])):a[u]=e.extend[u]:t(e.extend.extend,i,o,a);else{if(!o)return;var h=o.getRule(e.extend);if(!h)return;if(h===i)return void(0,s.default)(!1,"[JSS] A rule tries to extend itself \r\n%s",i);var c=h.options.parent;c&&t(c.rules.raw[e.extend],i,o,a)}}(e,i,o,a),function(e,i,n,s){for(var o in e)"extend"!==o&&(r(s[o])&&r(e[o])?t(e[o],i,n,s[o]):s[o]=r(e[o])?t(e[o],i,n):e[o])}(e,i,o,a),a}(t,e,i):t},onChangeValue:function(t,e,i){if("extend"!==e)return t;if(null==t||!1===t){for(var n in i[o])i.prop(n,null);return i[o]=null,null}for(var s in t)i.prop(s,t[s]);return i[o]=t,null}}};var s=function(t){return t&&t.__esModule?t:{default:t}}(i(3)),r=function(t){return t&&"object"===("undefined"==typeof t?"undefined":n(t))&&!Array.isArray(t)},o="extendCurrValue"+Date.now()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};e.default=function(){function t(t){return function(e,i){var n=t.getRule(i);return n?n.selector:((0,s.default)(!1,"[JSS] Could not find the referenced rule %s in %s.",i,t.options.meta||t),i)}}function e(t,e){for(var i=e.split(r),n=t.split(r),s="",a=0;a<i.length;a++)for(var u=i[a],h=0;h<n.length;h++){var c=n[h];s&&(s+=", "),s+=l(c)?c.replace(o,u):u+" "+c}return s}function i(t,e,i){if(i)return n({},i,{index:i.index+1});var s=t.options.nestingLevel;return n({},t.options,{nestingLevel:s=void 0===s?1:s+1,index:e.indexOf(t)+1})}var l=function(t){return-1!==t.indexOf("&")};return{onProcessStyle:function(s,r){if("style"!==r.type)return s;var o=r.options.parent,u=void 0,h=void 0;for(var c in s){var d=l(c),p="@"===c[0];if(d||p){if(u=i(r,o,u),d){var f=e(c,r.selector);h||(h=t(o)),f=f.replace(a,h),o.addRule(f,s[c],n({},u,{selector:f}))}else p&&o.addRule(c,null,u).addRule(r.key,s[c],{selector:r.selector});delete s[c]}}return s}}};var s=function(t){return t&&t.__esModule?t:{default:t}}(i(3)),r=/\s*,\s*/g,o=/&/g,a=/\$([\w-]+)/g},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return{onProcessStyle:function(t,e){return t.composes?(function t(e,i){if(!i)return!0;if(Array.isArray(i)){for(var s=0;s<i.length;s++)if(!t(e,i[s]))return!1;return!0}if(i.indexOf(" ")>-1)return t(e,i.split(" "));var r=e.options.parent;if("$"===i[0]){var o=r.getRule(i.substr(1));return o?o===e?((0,n.default)(!1,"[JSS] Cyclic composition detected. \r\n%s",e),!1):(r.classes[e.key]+=" "+r.classes[o.key],!0):((0,n.default)(!1,"[JSS] Referenced rule is not defined. \r\n%s",e),!1)}return e.options.parent.classes[e.key]+=" "+i,!0}(e,t.composes),delete t.composes,t):t}}};var n=function(t){return t&&t.__esModule?t:{default:t}}(i(3))},function(t,e,i){"use strict";function n(t){var e={};for(var i in t)e[(0,s.default)(i)]=t[i];return t.fallbacks&&(e.fallbacks=Array.isArray(t.fallbacks)?t.fallbacks.map(n):n(t.fallbacks)),e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return{onProcessStyle:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++)t[e]=n(t[e]);return t}return n(t)},onChangeValue:function(t,e,i){var n=(0,s.default)(e);return e===n?t:(i.prop(n,t),null)}}};var s=function(t){return t&&t.__esModule?t:{default:t}}(i(42))},function(t,e){"use strict";var i=/[A-Z]/g,n=/^ms-/,s={};t.exports=function(t){return t in s?s[t]:s[t]=t.replace(i,"-$&").toLowerCase().replace(n,"-ms-")}},function(t,e,i){"use strict";function n(t){var e=/(-[a-z])/g,i=function(t){return t[1].toUpperCase()},n={};for(var s in t)n[s]=t[s],n[s.replace(e,i)]=t[s];return n}function s(t,e,i){if(!e)return e;var n=e,a="undefined"==typeof e?"undefined":r(e);switch("object"===a&&Array.isArray(e)&&(a="array"),a){case"object":if("fallbacks"===t){for(var l in e)e[l]=s(l,e[l],i);break}for(var u in e)e[u]=s(t+"-"+u,e[u],i);break;case"array":for(var h=0;h<e.length;h++)e[h]=s(t,e[h],i);break;case"number":0!==e&&(n=e+(i[t]||o[t]||""))}return n}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(){var t=n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{onProcessStyle:function(e,i){if("style"!==i.type)return e;for(var n in e)e[n]=s(n,e[n],t);return e},onChangeValue:function(e,i){return s(i,e,t)}}};var o=n(function(t){return t&&t.__esModule?t:{default:t}}(i(44)).default)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={"animation-delay":"ms","animation-duration":"ms","background-position":"px","background-position-x":"px","background-position-y":"px","background-size":"px",border:"px","border-bottom":"px","border-bottom-left-radius":"px","border-bottom-right-radius":"px","border-bottom-width":"px","border-left":"px","border-left-width":"px","border-radius":"px","border-right":"px","border-right-width":"px","border-spacing":"px","border-top":"px","border-top-left-radius":"px","border-top-right-radius":"px","border-top-width":"px","border-width":"px","border-after-width":"px","border-before-width":"px","border-end-width":"px","border-horizontal-spacing":"px","border-start-width":"px","border-vertical-spacing":"px",bottom:"px","box-shadow":"px","column-gap":"px","column-rule":"px","column-rule-width":"px","column-width":"px","flex-basis":"px","font-size":"px","font-size-delta":"px",height:"px",left:"px","letter-spacing":"px","logical-height":"px","logical-width":"px",margin:"px","margin-after":"px","margin-before":"px","margin-bottom":"px","margin-left":"px","margin-right":"px","margin-top":"px","max-height":"px","max-width":"px","margin-end":"px","margin-start":"px","mask-position-x":"px","mask-position-y":"px","mask-size":"px","max-logical-height":"px","max-logical-width":"px","min-height":"px","min-width":"px","min-logical-height":"px","min-logical-width":"px",motion:"px","motion-offset":"px",outline:"px","outline-offset":"px","outline-width":"px",padding:"px","padding-bottom":"px","padding-left":"px","padding-right":"px","padding-top":"px","padding-after":"px","padding-before":"px","padding-end":"px","padding-start":"px","perspective-origin-x":"%","perspective-origin-y":"%",perspective:"px",right:"px","shape-margin":"px",size:"px","text-indent":"px","text-stroke":"px","text-stroke-width":"px",top:"px","transform-origin":"%","transform-origin-x":"%","transform-origin-y":"%","transform-origin-z":"%","transition-delay":"ms","transition-duration":"ms","vertical-align":"px",width:"px","word-spacing":"px","box-shadow-x":"px","box-shadow-y":"px","box-shadow-blur":"px","box-shadow-spread":"px","font-line-height":"px","text-shadow-x":"px","text-shadow-y":"px","text-shadow-blur":"px"}},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e,i,n){return null==i[e]?t:0===t.length?[]:Array.isArray(t[0])?s(t[0],e,i):"object"===l(t[0])?function(t,e,i){return t.map(function(t){return r(t,e,i,!1,!0)})}(t,e,n):[t]}function r(t,e,i,n,s){if(!u.propObj[e]&&!u.customPropObj[e])return[];var r=[];if(u.customPropObj[e]&&(t=o(t,i,u.customPropObj[e],n)),Object.keys(t).length)for(var a in u.propObj[e])t[a]?Array.isArray(t[a])?r.push(null===u.propArrayInObj[a]?t[a]:t[a].join(" ")):r.push(t[a]):null!=u.propObj[e][a]&&r.push(u.propObj[e][a]);return!r.length||s?r:[r]}function o(t,e,i,s){for(var r in i){var o=i[r];if("undefined"!=typeof t[r]&&(s||!e.prop(o))){var l=a(n({},o,t[r]),e)[o];s?e.style.fallbacks[o]=l:e.style[o]=l}delete t[r]}return t}function a(t,e,i){for(var n in t){var o=t[n];if(Array.isArray(o)){if(!Array.isArray(o[0])){if("fallbacks"===n){for(var h=0;h<t.fallbacks.length;h++)t.fallbacks[h]=a(t.fallbacks[h],e,!0);continue}t[n]=s(o,n,u.propArray),t[n].length||delete t[n]}}else if("object"===("undefined"==typeof o?"undefined":l(o))){if("fallbacks"===n){t.fallbacks=a(t.fallbacks,e,!0);continue}t[n]=r(o,n,e,i),t[n].length||delete t[n]}else""===t[n]&&delete t[n]}return t}Object.defineProperty(e,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(){return{onProcessStyle:function(t,e){if(!t||"style"!==e.type)return t;if(Array.isArray(t)){for(var i=0;i<t.length;i++)t[i]=a(t[i],e);return t}return a(t,e)}}};var u=i(46)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.propArray={"background-size":!0,"background-position":!0,border:!0,"border-bottom":!0,"border-left":!0,"border-top":!0,"border-right":!0,"border-radius":!0,"border-image":!0,"border-width":!0,"border-style":!0,"border-color":!0,"box-shadow":!0,flex:!0,margin:!0,padding:!0,outline:!0,"transform-origin":!0,transform:!0,transition:!0},e.propArrayInObj={position:!0,size:!0},e.propObj={padding:{top:0,right:0,bottom:0,left:0},margin:{top:0,right:0,bottom:0,left:0},background:{attachment:null,color:null,image:null,position:null,repeat:null},border:{width:null,style:null,color:null},"border-top":{width:null,style:null,color:null},"border-right":{width:null,style:null,color:null},"border-bottom":{width:null,style:null,color:null},"border-left":{width:null,style:null,color:null},outline:{width:null,style:null,color:null},"list-style":{type:null,position:null,image:null},transition:{property:null,duration:null,"timing-function":null,timingFunction:null,delay:null},animation:{name:null,duration:null,"timing-function":null,timingFunction:null,delay:null,"iteration-count":null,iterationCount:null,direction:null,"fill-mode":null,fillMode:null,"play-state":null,playState:null},"box-shadow":{x:0,y:0,blur:0,spread:0,color:null,inset:null},"text-shadow":{x:0,y:0,blur:null,color:null}},e.customPropObj={border:{radius:"border-radius",image:"border-image",width:"border-width",style:"border-style",color:"border-color"},background:{size:"background-size",image:"background-image"},font:{style:"font-style",variant:"font-variant",weight:"font-weight",stretch:"font-stretch",size:"font-size",family:"font-family",lineHeight:"line-height","line-height":"line-height"},flex:{grow:"flex-grow",basis:"flex-basis",direction:"flex-direction",wrap:"flex-wrap",flow:"flex-flow",shrink:"flex-shrink"},align:{self:"align-self",items:"align-items",content:"align-content"},grid:{"template-columns":"grid-template-columns",templateColumns:"grid-template-columns","template-rows":"grid-template-rows",templateRows:"grid-template-rows","template-areas":"grid-template-areas",templateAreas:"grid-template-areas",template:"grid-template","auto-columns":"grid-auto-columns",autoColumns:"grid-auto-columns","auto-rows":"grid-auto-rows",autoRows:"grid-auto-rows","auto-flow":"grid-auto-flow",autoFlow:"grid-auto-flow",row:"grid-row",column:"grid-column","row-start":"grid-row-start",rowStart:"grid-row-start","row-end":"grid-row-end",rowEnd:"grid-row-end","column-start":"grid-column-start",columnStart:"grid-column-start","column-end":"grid-column-end",columnEnd:"grid-column-end",area:"grid-area",gap:"grid-gap","row-gap":"grid-row-gap",rowGap:"grid-row-gap","column-gap":"grid-column-gap",columnGap:"grid-column-gap"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return{onProcessRule:function(t){"keyframes"===t.type&&(t.key="@"+n.prefix.css+t.key.substr(1))},onProcessStyle:function(t,e){if("style"!==e.type)return t;for(var i in t){var s=t[i],r=!1,o=n.supportedProperty(i);o&&o!==i&&(r=!0);var a=!1,l=n.supportedValue(o,s);l&&l!==s&&(a=!0),(r||a)&&(r&&delete t[i],t[o||i]=l||s)}return t},onChangeValue:function(t,e){return n.supportedValue(e,t)}}};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(48))},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.supportedValue=e.supportedProperty=e.prefix=void 0;var s=n(i(49)),r=n(i(50)),o=n(i(52));e.default={prefix:s.default,supportedProperty:r.default,supportedValue:o.default},e.prefix=s.default,e.supportedProperty=r.default,e.supportedValue=o.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="",s="";if(function(t){return t&&t.__esModule?t:{default:t}}(i(26)).default){var r={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},o=document.createElement("p").style;for(var a in r)if(a+"Transform"in o){n=a,s=r[a];break}}e.default={js:n,css:s}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return a?null!=l[t]?l[t]:(l[t]=(0,o.default)(t)in a.style?t:r.default.js+(0,o.default)("-"+t)in a.style&&r.default.css+t,l[t]):t};var s=n(i(26)),r=n(i(49)),o=n(i(51)),a=void 0,l={};if(s.default){a=document.createElement("p");var u=window.getComputedStyle(document.documentElement,"");for(var h in u)isNaN(h)||(l[u[h]]=u[h])}},function(t,e){"use strict";function i(t,e){return e?e.toUpperCase():""}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.replace(n,i)};var n=/[-\s]+(.)?/g},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(!a)return e;if("string"!=typeof e||!isNaN(parseInt(e,10)))return e;var i=t+e;if(null!=o[i])return o[i];try{a.style[t]=e}catch(t){return o[i]=!1,!1}return""!==a.style[t]?o[i]=e:("-ms-flex"===(e=r.default.css+e)&&(e="-ms-flexbox"),a.style[t]=e,""!==a.style[t]&&(o[i]=e)),o[i]||(o[i]=!1),a.style[t]="",o[i]};var s=n(i(26)),r=n(i(49)),o={},a=void 0;s.default&&(a=document.createElement("p"))},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,e){return t.length-e.length}return{onProcessStyle:function(e,i){if("style"!==i.type)return e;var n={},s=Object.keys(e).sort(t);for(var r in s)n[s[r]]=e[s[r]];return n}}}}])});